<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ø¨Ø¯Ù„ ÙˆØ§Ø­Ø¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#0b1220;
      --surface:#0f1b33;
      --text:#e8eefc;
      --primary:#38bdf8;
      --secondary:#a78bfa;
      --gradA:#22c55e;
      --gradB:#38bdf8;
      --radius:18px;
      --fs:16px;
      --ff: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }
    html,body{height:100%}
    body{background:var(--bg); color:var(--text); font-family:var(--ff); font-size:var(--fs)}
    .card{
      background:color-mix(in srgb, var(--surface) 92%, black 8%);
      border:1px solid color-mix(in srgb, var(--text) 10%, transparent 90%);
      border-radius:var(--radius);
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .soft{
      border:1px solid color-mix(in srgb, var(--text) 12%, transparent 88%);
      background:color-mix(in srgb, var(--surface) 82%, black 18%);
      border-radius:14px;
    }
    .focusable:focus{outline:2px solid color-mix(in srgb, var(--primary) 80%, white 20%); outline-offset:2px}
    .btn{border-radius:14px; transition:.18s transform,.18s filter,.18s background,.18s box-shadow}
    .btn:active{transform:translateY(1px) scale(.99)}
    .glass{
      background:linear-gradient(135deg, color-mix(in srgb, var(--surface) 88%, transparent 12%), color-mix(in srgb, var(--surface) 72%, transparent 28%));
      backdrop-filter: blur(10px);
      border:1px solid color-mix(in srgb, var(--text) 12%, transparent 88%);
      border-radius:var(--radius);
    }
    .grad{background:linear-gradient(135deg, var(--gradA), var(--gradB));}
    .muted{color:color-mix(in srgb, var(--text) 72%, transparent 28%)}
    .tiny{font-size:.85em}
    .tabActive{background:color-mix(in srgb, var(--primary) 18%, transparent 82%); border:1px solid color-mix(in srgb, var(--primary) 45%, transparent 55%);}
    .tabIdle{background:color-mix(in srgb, var(--surface) 72%, transparent 28%); border:1px solid color-mix(in srgb, var(--text) 10%, transparent 90%);}
    input,select,textarea{
      background:color-mix(in srgb, var(--surface) 78%, black 22%);
      border:1px solid color-mix(in srgb, var(--text) 14%, transparent 86%);
      color:var(--text);
    }
    input::placeholder,textarea::placeholder{color:color-mix(in srgb, var(--text) 45%, transparent 55%)}
    option{background:#0b1220}
    .toast{animation:toastIn .22s ease-out}
    @keyframes toastIn{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}
    .calcDisplay{font-variant-numeric: tabular-nums; letter-spacing:.02em; word-break: break-word;}

    /* Calculator */
    .calcShell{
      background: radial-gradient(1200px 500px at 80% 0%, color-mix(in srgb, var(--primary) 18%, transparent 82%), transparent 60%),
                  radial-gradient(900px 400px at 15% 20%, color-mix(in srgb, var(--secondary) 14%, transparent 86%), transparent 55%),
                  linear-gradient(180deg, color-mix(in srgb, var(--surface) 85%, black 15%), color-mix(in srgb, var(--surface) 75%, black 25%));
      border:1px solid color-mix(in srgb, var(--text) 10%, transparent 90%);
      border-radius: calc(var(--radius) + 6px);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      position: relative;
      overflow: hidden;
    }
    .calcShell::before{
      content:"";
      position:absolute; inset:-2px;
      background:linear-gradient(135deg, color-mix(in srgb, var(--gradA) 55%, transparent 45%), color-mix(in srgb, var(--gradB) 55%, transparent 45%));
      opacity:.10;
      filter: blur(18px);
      pointer-events:none;
    }
    .calcTop{
      position:relative;
      background:linear-gradient(135deg, color-mix(in srgb, var(--surface) 85%, transparent 15%), color-mix(in srgb, var(--surface) 70%, transparent 30%));
      border:1px solid color-mix(in srgb, var(--text) 12%, transparent 88%);
      border-radius: 22px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    .calcKey{
      min-height:52px;
      border-radius: 18px;
      background: linear-gradient(180deg, color-mix(in srgb, var(--surface) 90%, transparent 10%), color-mix(in srgb, var(--surface) 75%, black 25%));
      border:1px solid color-mix(in srgb, var(--text) 10%, transparent 90%);
      box-shadow: 0 10px 18px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.06);
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
    }
    .calcKey:hover{filter:brightness(1.06)}
    .calcKey:active{
      transform: translateY(1px) scale(.99);
      box-shadow: 0 6px 12px rgba(0,0,0,.24), inset 0 1px 0 rgba(255,255,255,.04);
    }
    .calcKeyOp{
      background: linear-gradient(135deg, color-mix(in srgb, var(--gradA) 80%, white 20%), color-mix(in srgb, var(--gradB) 80%, white 20%));
      color:#06101f;
      border:none;
      box-shadow: 0 12px 22px rgba(0,0,0,.28), 0 0 24px color-mix(in srgb, var(--primary) 35%, transparent 65%);
    }
    .calcKeyDanger{
      background: linear-gradient(135deg, color-mix(in srgb, #fb7185 70%, white 30%), color-mix(in srgb, #f97316 70%, white 30%));
      color:#14070a;
      border:none;
    }
    .calcKeyUtil{
      background: linear-gradient(180deg, color-mix(in srgb, var(--surface) 92%, transparent 8%), color-mix(in srgb, var(--surface) 72%, black 28%));
    }
  </style>
</head>

<body class="min-h-screen">
  <div class="max-w-6xl mx-auto px-4 py-5 md:py-7">
    <!-- Header -->
    <header class="glass p-4 md:p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="flex items-center gap-3">
        <div id="logoBadge" class="grad w-12 h-12 rounded-2xl flex items-center justify-center text-xl shadow">ğŸ”„</div>
        <div>
          <h1 class="text-lg md:text-xl font-bold">Ù…Ø¨Ø¯Ù„ ÙˆØ§Ø­Ø¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h1>
          <p class="muted tiny">ØªØ¨Ø¯ÛŒÙ„ Ø¯Ù‚ÛŒÙ‚ ÙˆØ§Ø­Ø¯Ù‡Ø§ + Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ</p>
        </div>
      </div>

      <nav id="topNav" class="flex flex-wrap gap-2">
        <button type="button" data-nav="converter" class="navBtn btn px-3.5 py-2 tabActive focusable">ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯Ù‡Ø§</button>
        <button type="button" data-nav="health" class="navBtn btn px-3.5 py-2 tabIdle focusable">Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø³Ù„Ø§Ù…ØªÛŒ</button>
        <button type="button" data-nav="datetime" class="navBtn btn px-3.5 py-2 tabIdle focusable">ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª</button>
        <button type="button" data-nav="calculator" class="navBtn btn px-3.5 py-2 tabIdle focusable">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</button>
        <button type="button" data-nav="settings" class="navBtn btn px-3.5 py-2 tabIdle focusable">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
        <button type="button" data-nav="help" class="navBtn btn px-3.5 py-2 tabIdle focusable">Ø±Ø§Ù‡Ù†Ù…Ø§</button>
      </nav>
    </header>

    <!-- Main -->
    <main class="mt-5 md:mt-7">
      <!-- Converter Page -->
      <section id="page-converter" class="space-y-4 md:space-y-5">
        <div class="grid md:grid-cols-3 gap-4 md:gap-5">
          <div class="card p-4 md:p-5 md:col-span-2">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h2 class="text-base md:text-lg font-bold">ØªØ¨Ø¯ÛŒÙ„ ÙˆØ§Ø­Ø¯</h2>
                <p class="muted tiny mt-1">Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŒ ÙˆØ§Ø­Ø¯ Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ù†ØªÛŒØ¬Ù‡ ÙÙˆØ±ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
              </div>
              <button type="button" id="swapBtn" class="btn px-3 py-2 soft focusable" title="Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ ÙˆØ§Ø­Ø¯Ù‡Ø§">
                <span class="inline-flex items-center gap-2"><span>Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ</span> <span aria-hidden="true">â‡„</span></span>
              </button>
            </div>

            <div class="mt-4 grid sm:grid-cols-2 gap-3">
              <div class="space-y-2">
                <label class="tiny muted" for="categorySel">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                <select id="categorySel" class="w-full px-3 py-2.5 rounded-xl focusable"></select>
              </div>

              <div class="space-y-2">
                <label class="tiny muted" for="precisionRange">Ø¯Ù‚Øª Ù†Ù…Ø§ÛŒØ´ (Ø§Ø¹Ø´Ø§Ø±)</label>
                <div class="flex items-center gap-3">
                  <input id="precisionRange" type="range" min="0" max="8" step="1" class="w-full" />
                  <div id="precisionLabel" class="soft px-3 py-2 rounded-xl text-sm w-16 text-center">2</div>
                </div>
              </div>

              <div class="space-y-2">
                <label class="tiny muted" for="valueInput">Ù…Ù‚Ø¯Ø§Ø±</label>
                <input id="valueInput" inputmode="decimal" autocomplete="off" placeholder="Ù…Ø«Ù„Ø§Ù‹ 12.5" class="w-full px-3 py-2.5 rounded-xl focusable" />
                <div id="valueHint" class="muted tiny">Ù†Ú©ØªÙ‡: Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù†Ù‚Ø·Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ø´Ø§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</div>
              </div>

              <div class="space-y-2">
                <label class="tiny muted" for="fromUnitSel">Ø§Ø²</label>
                <select id="fromUnitSel" class="w-full px-3 py-2.5 rounded-xl focusable"></select>
              </div>

              <div class="space-y-2">
                <label class="tiny muted" for="toUnitSel">Ø¨Ù‡</label>
                <select id="toUnitSel" class="w-full px-3 py-2.5 rounded-xl focusable"></select>
              </div>

              <div class="space-y-2">
                <label class="tiny muted">Ù†ØªÛŒØ¬Ù‡</label>
                <div class="soft p-3 rounded-xl flex items-center justify-between gap-2">
                  <div>
                    <div id="resultValue" class="text-lg md:text-xl font-bold">â€”</div>
                    <div id="resultUnit" class="muted tiny mt-1">â€”</div>
                  </div>
                  <div class="flex gap-2">
                    <button type="button" id="copyResultBtn" class="btn px-3 py-2 soft focusable">Ú©Ù¾ÛŒ</button>
                  </div>
                </div>
                <div id="converterNote" class="muted tiny"></div>
              </div>
            </div>
          </div>

          <div class="card p-4 md:p-5">
            <h3 class="font-bold">ØªØ¨Ø¯ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒØ¬</h3>
            <p class="muted tiny mt-1">Ø¨Ø§ ÛŒÚ© Ú©Ù„ÛŒÚ©ØŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù†Ù…ÙˆÙ†Ù‡ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.</p>
            <div id="quickGrid" class="mt-3 grid gap-2"></div>

            <div class="mt-4 soft p-3">
              <div class="flex items-center justify-between gap-2">
                <span class="tiny muted">Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ</span>
                <label class="inline-flex items-center cursor-pointer">
                  <input id="uiPersianDigitsToggle" type="checkbox" class="sr-only">
                  <span class="w-12 h-7 rounded-full relative soft">
                    <span id="uiPersianDigitsDot" class="absolute top-1 right-1 w-5 h-5 rounded-full grad transition-all"></span>
                  </span>
                </label>
              </div>
              <div class="muted tiny mt-2">Ú©Ù¾ÛŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Health Page -->
      <section id="page-health" class="hidden space-y-4 md:space-y-5">
        <div class="grid lg:grid-cols-2 gap-4 md:gap-5">
          <div class="card p-4 md:p-5">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h2 class="text-base md:text-lg font-bold">Ø´Ø§Ø®Øµ ØªÙˆØ¯Ù‡ Ø¨Ø¯Ù†ÛŒ (BMI)</h2>
                <p class="muted tiny mt-1">BMI = ÙˆØ²Ù† / (Ù‚Ø¯ Ø¨Ù‡ Ù…ØªØ±)^Û²</p>
              </div>
              <button type="button" id="copyBmiBtn" class="btn px-3 py-2 soft focusable">Ú©Ù¾ÛŒ</button>
            </div>

            <div class="mt-4 grid sm:grid-cols-2 gap-3">
              <div class="space-y-2">
                <label class="tiny muted" for="bmiWeight">ÙˆØ²Ù† (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                <input id="bmiWeight" inputmode="decimal" placeholder="Ù…Ø«Ù„Ø§Ù‹ 72.5" class="w-full px-3 py-2.5 rounded-xl focusable" />
                <div class="muted tiny">ÙˆØ²Ù† ÙØ¹Ù„ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</div>
              </div>
              <div class="space-y-2">
                <label class="tiny muted" for="bmiHeight">Ù‚Ø¯ (Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±)</label>
                <input id="bmiHeight" inputmode="decimal" placeholder="Ù…Ø«Ù„Ø§Ù‹ 175" class="w-full px-3 py-2.5 rounded-xl focusable" />
                <div class="muted tiny">Ù‚Ø¯ Ø¨Ø¯ÙˆÙ† Ú©ÙØ´.</div>
              </div>
            </div>

            <div class="mt-3 soft p-3 rounded-xl">
              <div class="flex items-center justify-between gap-2">
                <div>
                  <div class="muted tiny">Ù†ØªÛŒØ¬Ù‡</div>
                  <div class="text-xl font-bold"><span id="bmiValue">â€”</span></div>
                  <div class="muted tiny mt-1">ÙˆØ¶Ø¹ÛŒØª: <span id="bmiCat" class="font-semibold">â€”</span></div>
                </div>
                <label class="inline-flex items-center gap-2 cursor-pointer">
                  <input id="idealWeightToggle" type="checkbox" class="w-4 h-4 rounded focusable">
                  <span class="tiny">Ù†Ù…Ø§ÛŒØ´ ÙˆØ²Ù† Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„</span>
                </label>
              </div>
              <div id="idealWeightBox" class="hidden mt-2 muted tiny">
                Ù…Ø­Ø¯ÙˆØ¯Ù‡ ÙˆØ²Ù† Ø³Ø§Ù„Ù…: <span id="idealWeightRange" class="font-semibold"></span> Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…
              </div>
              <div id="bmiWarn" class="mt-2 hidden tiny"></div>
            </div>
          </div>

          <div class="card p-4 md:p-5">
            <div class="flex items-start justify-between gap-3">
              <div>
                <h2 class="text-base md:text-lg font-bold">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ø§Ù„Ø±ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h2>
                <p class="muted tiny mt-1">BMR Ùˆ TDEE Ùˆ Ú©Ø§Ù„Ø±ÛŒ Ù‡Ø¯Ù Ø¨Ø± Ø§Ø³Ø§Ø³ Mifflinâ€“St Jeor</p>
              </div>
              <button type="button" id="copyGoalBtn" class="btn px-3 py-2 soft focusable">Ú©Ù¾ÛŒ Ú©Ø§Ù„Ø±ÛŒ Ù‡Ø¯Ù</button>
            </div>

            <div class="mt-4 grid sm:grid-cols-2 gap-3">
              <div class="space-y-2">
                <label class="tiny muted" for="sexSel">Ø¬Ù†Ø³ÛŒØª</label>
                <select id="sexSel" class="w-full px-3 py-2.5 rounded-xl focusable">
                  <option value="male">Ù…Ø±Ø¯</option>
                  <option value="female">Ø²Ù†</option>
                </select>
              </div>
              <div class="space-y-2">
                <label class="tiny muted" for="ageInput">Ø³Ù† (Ø³Ø§Ù„)</label>
                <input id="ageInput" inputmode="numeric" placeholder="Ù…Ø«Ù„Ø§Ù‹ 30" class="w-full px-3 py-2.5 rounded-xl focusable" />
              </div>
              <div class="space-y-2">
                <label class="tiny muted" for="calHeight">Ù‚Ø¯ (Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±)</label>
                <input id="calHeight" inputmode="decimal" placeholder="Ù…Ø«Ù„Ø§Ù‹ 175" class="w-full px-3 py-2.5 rounded-xl focusable" />
              </div>
              <div class="space-y-2">
                <label class="tiny muted" for="calWeight">ÙˆØ²Ù† (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                <input id="calWeight" inputmode="decimal" placeholder="Ù…Ø«Ù„Ø§Ù‹ 72.5" class="w-full px-3 py-2.5 rounded-xl focusable" />
              </div>

              <div class="space-y-2 sm:col-span-2">
                <label class="tiny muted" for="activitySel">Ø³Ø·Ø­ ÙØ¹Ø§Ù„ÛŒØª</label>
                <select id="activitySel" class="w-full px-3 py-2.5 rounded-xl focusable">
                  <option value="1.2">Ú©Ù…â€ŒØªØ­Ø±Ú© (1.2)</option>
                  <option value="1.375">ÙØ¹Ø§Ù„ÛŒØª Ø³Ø¨Ú© (1.375)</option>
                  <option value="1.55" selected>ÙØ¹Ø§Ù„ÛŒØª Ù…ØªÙˆØ³Ø· (1.55)</option>
                  <option value="1.725">ÙØ¹Ø§Ù„ÛŒØª Ø²ÛŒØ§Ø¯ (1.725)</option>
                  <option value="1.9">Ø®ÛŒÙ„ÛŒ Ø²ÛŒØ§Ø¯ (1.9)</option>
                </select>
              </div>

              <div class="space-y-2 sm:col-span-2">
                <label class="tiny muted" for="goalSel">Ù‡Ø¯Ù</label>
                <select id="goalSel" class="w-full px-3 py-2.5 rounded-xl focusable">
                  <option value="0" selected>Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ÙˆØ²Ù† (0)</option>
                  <option value="-250">Ú©Ø§Ù‡Ø´ ÙˆØ²Ù† Ù…Ù„Ø§ÛŒÙ… (âˆ’250)</option>
                  <option value="-500">Ú©Ø§Ù‡Ø´ ÙˆØ²Ù† (âˆ’500)</option>
                  <option value="250">Ø§ÙØ²Ø§ÛŒØ´ ÙˆØ²Ù† Ù…Ù„Ø§ÛŒÙ… (+250)</option>
                  <option value="500">Ø§ÙØ²Ø§ÛŒØ´ ÙˆØ²Ù† (+500)</option>
                </select>
              </div>
            </div>

            <div class="mt-3 soft p-3 rounded-xl">
              <div id="calError" class="hidden mb-2 text-sm font-semibold"></div>
              <div class="grid sm:grid-cols-3 gap-2">
                <div class="soft p-3">
                  <div class="muted tiny">BMR</div>
                  <div class="text-lg font-bold"><span id="bmrOut">â€”</span> <span class="muted tiny">Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ</span></div>
                </div>
                <div class="soft p-3">
                  <div class="muted tiny">Ú©Ø§Ù„Ø±ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ (TDEE)</div>
                  <div class="text-lg font-bold"><span id="tdeeOut">â€”</span></div>
                </div>
                <div class="soft p-3">
                  <div class="muted tiny">Ú©Ø§Ù„Ø±ÛŒ Ù‡Ø¯Ù</div>
                  <div class="text-lg font-bold"><span id="goalOut">â€”</span></div>
                </div>
              </div>
              <div id="calWarn" class="mt-2 hidden tiny"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- DateTime Page -->
      <section id="page-datetime" class="hidden space-y-4 md:space-y-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h2 class="text-base md:text-lg font-bold">ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª (TimeAPI.io)</h2>
              <p class="muted tiny mt-1">Ø§ÛŒÙ† Ø¨Ø®Ø´ ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª Ø±Ø§ Ø§Ø² Ø³Ø±ÙˆÛŒØ³ TimeAPI.io Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ù‡ Ø³Ø§Ø¹Øª Ø¯Ø³ØªÚ¯Ø§Ù‡).</p>
            </div>
            <div class="flex gap-2 flex-wrap">
              <button type="button" id="timeRefreshBtn" class="btn px-3 py-2 soft focusable">Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
              <button type="button" id="timeCopyBtn" class="btn px-3 py-2 soft focusable">Ú©Ù¾ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
            </div>
          </div>

          <div class="mt-4 grid lg:grid-cols-3 gap-3">
            <div class="soft p-3">
              <div class="font-bold">Ø§Ù…Ø±ÙˆØ² (Ø´Ù…Ø³ÛŒ)</div>
              <div class="calcDisplay text-2xl font-extrabold mt-2" id="todayJalali">â€”</div>
              <div class="muted tiny mt-2">Ù…Ù†Ø¨Ø¹: TimeAPI.io</div>
            </div>
            <div class="soft p-3">
              <div class="font-bold">Ø§Ù…Ø±ÙˆØ² (Ù…ÛŒÙ„Ø§Ø¯ÛŒ)</div>
              <div class="calcDisplay text-2xl font-extrabold mt-2" id="todayGreg">â€”</div>
              <div class="muted tiny mt-2">Ù…Ù†Ø¨Ø¹: TimeAPI.io</div>
            </div>
            <div class="soft p-3" id="hijriCard">
              <div class="font-bold">Ø§Ù…Ø±ÙˆØ² (Ù‚Ù…Ø±ÛŒ)</div>
              <div class="calcDisplay text-2xl font-extrabold mt-2" id="todayHijri">â€”</div>
              <div class="muted tiny mt-2">â€”</div>
            </div>
          </div>

          <div class="mt-3 grid lg:grid-cols-2 gap-3">
            <div class="soft p-3">
              <div class="flex items-center justify-between gap-2">
                <div class="font-bold">Ø³Ø§Ø¹Øª Ø§ÛŒØ±Ø§Ù†</div>
                <div class="muted tiny">Asia/Tehran</div>
              </div>
              <div class="calcDisplay text-4xl md:text-5xl font-extrabold mt-3" id="timeIR">â€”</div>
              <div class="muted tiny mt-2">Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØªÛŒ: <span id="timeUpdatedAt">â€”</span></div>
            </div>

            <div class="soft p-3">
              <div class="flex items-center justify-between gap-2">
                <div class="font-bold">Ø³Ø§Ø¹Øª Ø¬Ù‡Ø§Ù†ÛŒ</div>
                <div class="muted tiny">UTC</div>
              </div>
              <div class="calcDisplay text-4xl md:text-5xl font-extrabold mt-3" id="timeUTC">â€”</div>
              <div class="muted tiny mt-2">Ù…Ù†Ø¨Ø¹: TimeAPI.io</div>
            </div>
          </div>

          <div id="timeStatus" class="mt-3 soft p-3">
            <div class="flex items-center justify-between gap-2">
              <div class="tiny muted">ÙˆØ¶Ø¹ÛŒØª</div>
              <div id="timeStatusText" class="tiny text-amber-200">Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øªâ€¦</div>
            </div>
            <div class="muted tiny mt-2" id="timeStatusHint">Ø§Ú¯Ø± Ø§ÛŒÙ†ØªØ±Ù†Øª ÛŒØ§ Ø³Ø±ÙˆÛŒØ³ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒÙ† Ø¨Ø®Ø´ Â«â€”Â» Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</div>
          </div>
        </div>
      </section>

      <!-- Calculator Page -->
      <section id="page-calculator" class="hidden space-y-4 md:space-y-5">
        <div class="calcShell p-4 md:p-6">
          <div class="relative flex items-start justify-between gap-3">
            <div>
              <h2 class="text-base md:text-lg font-extrabold">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h2>
              <p class="muted tiny mt-1">Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ø·Ø¨Ù‚ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù…Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª: ÙØ§Ø±Ø³ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</p>
            </div>
            <div class="flex gap-2">
              <button type="button" id="calcCopyBtn" class="btn px-3 py-2 soft focusable">Ú©Ù¾ÛŒ</button>
              <button type="button" id="calcClearBtn" class="btn px-3 py-2 soft focusable">Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù†</button>
            </div>
          </div>

          <div class="mt-4 calcTop p-4 md:p-5">
            <div class="flex items-center justify-between gap-3">
              <div class="muted tiny">Ø¹Ø¨Ø§Ø±Øª</div>
              <div class="muted tiny">Ø­Ø§ÙØ¸Ù‡: <span id="memBadge" class="font-bold">0</span></div>
            </div>

            <div class="mt-2 soft p-3">
              <div id="calcExpr" class="calcDisplay text-base md:text-lg font-semibold min-h-[28px]">â€”</div>
              <div class="muted tiny mt-2">Ù†ØªÛŒØ¬Ù‡</div>
              <div id="calcResult" class="calcDisplay text-3xl md:text-5xl font-extrabold mt-1">0</div>
            </div>

            <div class="mt-3 text-xs muted text-left">
              <div class="soft inline-flex items-center gap-2 px-3 py-2">
                <span class="grad w-2.5 h-2.5 rounded-full"></span>
                <span>Enter = Ù…Ø­Ø§Ø³Ø¨Ù‡</span>
              </div>
            </div>
          </div>

          <div class="mt-4 grid grid-cols-4 gap-2 select-none" id="calcPad">
            <button type="button" class="calcKey calcKeyUtil focusable" data-k="MC">MC</button>
            <button type="button" class="calcKey calcKeyUtil focusable" data-k="MR">MR</button>
            <button type="button" class="calcKey calcKeyUtil focusable" data-k="M+">M+</button>
            <button type="button" class="calcKey calcKeyUtil focusable" data-k="M-">M-</button>

            <button type="button" class="calcKey calcKeyUtil focusable" data-k="(">(</button>
            <button type="button" class="calcKey calcKeyUtil focusable" data-k=")">)</button>
            <button type="button" class="calcKey calcKeyUtil focusable" data-k="%">Ùª</button>
            <button type="button" class="calcKey calcKeyDanger focusable" data-k="DEL">âŒ«</button>

            <button type="button" class="calcKey focusable calcDigit" data-k="7" data-fa="Û·" data-en="7">Û·</button>
            <button type="button" class="calcKey focusable calcDigit" data-k="8" data-fa="Û¸" data-en="8">Û¸</button>
            <button type="button" class="calcKey focusable calcDigit" data-k="9" data-fa="Û¹" data-en="9">Û¹</button>
            <button type="button" class="calcKey calcKeyOp focusable" data-k="/">Ã·</button>

            <button type="button" class="calcKey focusable calcDigit" data-k="4" data-fa="Û´" data-en="4">Û´</button>
            <button type="button" class="calcKey focusable calcDigit" data-k="5" data-fa="Ûµ" data-en="5">Ûµ</button>
            <button type="button" class="calcKey focusable calcDigit" data-k="6" data-fa="Û¶" data-en="6">Û¶</button>
            <button type="button" class="calcKey calcKeyOp focusable" data-k="*">Ã—</button>

            <button type="button" class="calcKey focusable calcDigit" data-k="1" data-fa="Û±" data-en="1">Û±</button>
            <button type="button" class="calcKey focusable calcDigit" data-k="2" data-fa="Û²" data-en="2">Û²</button>
            <button type="button" class="calcKey focusable calcDigit" data-k="3" data-fa="Û³" data-en="3">Û³</button>
            <button type="button" class="calcKey calcKeyOp focusable" data-k="-">âˆ’</button>

            <button type="button" class="calcKey focusable calcDigit" data-k="0" data-fa="Û°" data-en="0">Û°</button>
            <button type="button" class="calcKey focusable" data-k=".">.</button>
            <button type="button" class="calcKey calcKeyOp focusable" data-k="=">=</button>
            <button type="button" class="calcKey calcKeyOp focusable" data-k="+">+</button>
          </div>

          <div class="mt-4 soft p-3 rounded-xl">
            <div class="tiny muted">ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú©ÛŒØ¨ÙˆØ±Ø¯</div>
            <div class="muted tiny mt-1">Û°-Û¹ ÛŒØ§ 0-9ØŒ + - * / ( ) . Enter Backspace</div>
          </div>
        </div>
      </section>

      <!-- Settings Page -->
      <section id="page-settings" class="hidden space-y-4 md:space-y-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h2 class="text-base md:text-lg font-bold">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ</h2>
              <p class="muted tiny mt-1">Ø¸Ø§Ù‡Ø± Ùˆ Ø±ÙØªØ§Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø³Ù„ÛŒÙ‚Ù‡ Ø®ÙˆØ¯ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
            </div>
            <button type="button" id="resetBtn" class="btn px-3 py-2 soft focusable">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ</button>
          </div>

          <div class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 gap-3">
            <div class="soft p-3">
              <label class="tiny muted">Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="bgColor" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="bgColorText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#0b1220" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ø±Ù†Ú¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="surfaceColor" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="surfaceColorText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#0f1b33" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ø±Ù†Ú¯ Ù…ØªÙ†</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="textColor" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="textColorText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#e8eefc" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ø±Ù†Ú¯ Ø§Ù‚Ø¯Ø§Ù… Ø§ØµÙ„ÛŒ</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="primaryColor" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="primaryColorText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#38bdf8" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ø±Ù†Ú¯ Ø§Ù‚Ø¯Ø§Ù… Ø«Ø§Ù†ÙˆÛŒÙ‡</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="secondaryColor" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="secondaryColorText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#a78bfa" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">ÙÙˆÙ†Øª</label>
              <select id="fontFamily" class="mt-2 w-full px-3 py-2.5 rounded-xl focusable">
                <option value='ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans"'>Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø³ÛŒØ³ØªÙ…ÛŒ)</option>
                <option value='"Vazirmatn", ui-sans-serif, system-ui'>Vazirmatn (Ø§Ú¯Ø± Ù†ØµØ¨ Ø¨Ø§Ø´Ø¯)</option>
                <option value='"IRANSans", ui-sans-serif, system-ui'>IRANSans (Ø§Ú¯Ø± Ù†ØµØ¨ Ø¨Ø§Ø´Ø¯)</option>
                <option value='"Tahoma", ui-sans-serif, system-ui'>Tahoma</option>
              </select>
              <div class="muted tiny mt-2">Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯ ÙÙˆÙ†ØªØŒ Ø¨Ù‡ ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ±ÙˆØ¯.</div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù…ØªÙ†</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="fontSize" type="range" min="13" max="20" step="1" class="w-full" />
                <div id="fontSizeLabel" class="soft px-3 py-2 rounded-xl text-sm w-16 text-center">16</div>
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ú¯Ø±Ø§Ø¯ÛŒØ§Ù† Ø¨Ø±Ø¬Ø³ØªÙ‡ (Ø´Ø±ÙˆØ¹)</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="gradA" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="gradAText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#22c55e" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ú¯Ø±Ø§Ø¯ÛŒØ§Ù† Ø¨Ø±Ø¬Ø³ØªÙ‡ (Ù¾Ø§ÛŒØ§Ù†)</label>
              <div class="mt-2 flex items-center gap-3">
                <input id="gradB" type="color" class="w-12 h-10 rounded-xl focusable" />
                <input id="gradBText" class="flex-1 px-3 py-2 rounded-xl focusable" placeholder="#38bdf8" />
              </div>
            </div>

            <div class="soft p-3">
              <label class="tiny muted">Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ù„ÙˆÚ¯Ùˆ</label>
              <input id="logoEmoji" class="mt-2 w-full px-3 py-2.5 rounded-xl focusable" placeholder="Ù…Ø«Ù„Ø§Ù‹ ğŸ”„" />
              <div class="muted tiny mt-2">Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù‡Ø¯Ø±.</div>
            </div>

            <div class="soft p-3 md:col-span-2 lg:col-span-3">
              <div class="flex items-center justify-between gap-2">
                <div>
                  <div class="tiny muted">Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ (Ø¯Ø± Ú©Ù„ Ø¨Ø±Ù†Ø§Ù…Ù‡)</div>
                  <div class="muted tiny mt-1">Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¨ÛŒØ´ØªØ± Ù†Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§.</div>
                </div>
                <label class="inline-flex items-center cursor-pointer">
                  <input id="persianDigitsToggle" type="checkbox" class="sr-only">
                  <span class="w-12 h-7 rounded-full relative soft">
                    <span id="persianDigitsDot" class="absolute top-1 right-1 w-5 h-5 rounded-full grad transition-all"></span>
                  </span>
                </label>
              </div>

              <div class="mt-3 flex items-center justify-between gap-2">
                <div>
                  <div class="tiny muted">Ú©Ù¾ÛŒ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ</div>
                  <div class="muted tiny mt-1">Ø§Ú¯Ø± Ø±ÙˆØ´Ù† Ø¨Ø§Ø´Ø¯ØŒ Ù…ØªÙ† Ú©Ù¾ÛŒâ€ŒØ´Ø¯Ù‡ Ù‡Ù… ÙØ§Ø±Ø³ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
                </div>
                <label class="inline-flex items-center cursor-pointer">
                  <input id="copyPersianToggle" type="checkbox" class="sr-only">
                  <span class="w-12 h-7 rounded-full relative soft">
                    <span id="copyPersianDot" class="absolute top-1 right-1 w-5 h-5 rounded-full grad transition-all"></span>
                  </span>
                </label>
              </div>

              <div class="mt-3 flex items-center justify-between gap-2">
                <div>
                  <div class="tiny muted">Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</div>
                  <div class="muted tiny mt-1">Ø¹Ø¯Ø¯Ù‡Ø§ Ùˆ Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ ÙØ§Ø±Ø³ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ.</div>
                </div>
                <select id="calcDisplayLang" class="px-3 py-2 rounded-xl focusable">
                  <option value="fa">ÙØ§Ø±Ø³ÛŒ</option>
                  <option value="en">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</option>
                </select>
              </div>

              <div class="mt-3 flex items-center justify-between gap-2">
                <div>
                  <div class="tiny muted">ØµØ¯Ø§ÛŒ Ú©Ù„ÛŒÚ© Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</div>
                  <div class="muted tiny mt-1">ØµØ¯Ø§ÛŒ Ø±ÛŒØ² Ù‡Ù†Ú¯Ø§Ù… ÙØ´Ø±Ø¯Ù† Ú©Ù„ÛŒØ¯Ù‡Ø§.</div>
                </div>
                <label class="inline-flex items-center cursor-pointer">
                  <input id="soundToggle" type="checkbox" class="sr-only">
                  <span class="w-12 h-7 rounded-full relative soft">
                    <span id="soundDot" class="absolute top-1 right-1 w-5 h-5 rounded-full grad transition-all"></span>
                  </span>
                </label>
              </div>

              <div class="mt-3">
                <div class="tiny muted">Ø´Ø¯Øª ØµØ¯Ø§</div>
                <div class="mt-2 flex items-center gap-3">
                  <input id="soundVolume" type="range" min="0" max="100" step="1" class="w-full" />
                  <div id="soundVolumeLabel" class="soft px-3 py-2 rounded-xl text-sm w-16 text-center">30</div>
                </div>
              </div>

              <div class="mt-4 soft p-3">
                <div class="font-bold">Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ (Config)</div>
                <p class="muted tiny mt-1">Ú©Ù¾ÛŒ/ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ú©Ø§Ù¾ Ú¯Ø±ÙØªÙ† Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª.</p>
                <div class="mt-2 grid md:grid-cols-2 gap-2">
                  <button type="button" id="exportConfig" class="btn px-3 py-2 soft focusable">Ú©Ù¾ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ</button>
                  <button type="button" id="importConfig" class="btn px-3 py-2 soft focusable">ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ</button>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- Help Page -->
      <section id="page-help" class="hidden space-y-4 md:space-y-5">
        <div class="card p-4 md:p-5">
          <h2 class="text-base md:text-lg font-bold">Ø±Ø§Ù‡Ù†Ù…Ø§</h2>
          <div class="mt-3 space-y-3 leading-7">
            <div class="soft p-3">
              <div class="font-bold">ØµÙØ­Ù‡â€ŒÙ‡Ø§</div>
              <ul class="mt-2 list-disc pr-5 muted">
                <li>Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ø¨ÛŒÙ† Ø¨Ø®Ø´â€ŒÙ‡Ø§ Ø¬Ø§Ø¨Ø¬Ø§ Ø´ÙˆÛŒØ¯.</li>
                <li>Ø¢Ø¯Ø±Ø³ ØµÙØ­Ù‡ (Ù‡Ø´) Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù…Ø«Ù„: <span class="font-semibold">#calculator</span></li>
              </ul>
            </div>
            <div class="soft p-3">
              <div class="font-bold">ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª</div>
              <ul class="mt-2 list-disc pr-5 muted">
                <li>Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø³Ø§Ø¹Øª Ùˆ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ø² TimeAPI.io Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</li>
                <li>Ø§Ú¯Ø± Ø³Ø±ÙˆÛŒØ³ ÛŒØ§ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù…Ø´Ú©Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ù†ØªÛŒØ¬Ù‡ Â«â€”Â» Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
              </ul>
            </div>
            <div class="soft p-3">
              <div class="font-bold">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</div>
              <ul class="mt-2 list-disc pr-5 muted">
                <li>Ù†Ù…Ø§ÛŒØ´Ú¯Ø± ÙÙ‚Ø· ÛŒÚ© Ø­Ø§Ù„Øª Ø¯Ø§Ø±Ø¯ (ÙØ§Ø±Ø³ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ) Ùˆ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³Øª.</li>
                <li>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ú©ÛŒØ¨ÙˆØ±Ø¯ Ù‡Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="mt-6 md:mt-8 pb-6 text-center muted tiny">
      <div class="flex flex-col gap-2 items-center">
        <span id="footerOut">Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· FARHAD ğŸ¨</span>
        <a class="text-sky-300 underline underline-offset-4" href="https://t.me/ShadowPsychologist" target="_blank" rel="noopener">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø§Ø²Ù†Ø¯Ù‡</a>
      </div>
    </footer>
  </div>

  <!-- Toasts -->
  <div id="toastHost" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-6 md:bottom-6 z-50 space-y-2 w-auto max-w-md"></div>

<script>
/* ========================= Utilities ========================= */
const clamp=(n,min,max)=>Math.min(max,Math.max(min,n));
const escapeHtml=(s)=>String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));

const toLatinDigits = (str) => {
  const map = {
    'Û°':'0','Û±':'1','Û²':'2','Û³':'3','Û´':'4','Ûµ':'5','Û¶':'6','Û·':'7','Û¸':'8','Û¹':'9',
    'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9',
    'âˆ’':'-','â€“':'-','â€”':'-','Ù«':'.','Ù¬':'',',':''
  };
  return String(str ?? '').replace(/[Û°-Û¹Ù -Ù©âˆ’â€“â€”Ù«Ù¬,]/g, ch => map[ch] ?? ch);
};

const safeNum=(v)=> {
  if (typeof v === "number") return Number.isFinite(v) ? v : NaN;
  const s=toLatinDigits((v??"").toString().trim());
  if(!s) return NaN;
  const x=Number(s);
  return Number.isFinite(x) ? x : NaN;
};

const toPersianDigits=(str)=>{
  const map = {'0':'Û°','1':'Û±','2':'Û²','3':'Û³','4':'Û´','5':'Ûµ','6':'Û¶','7':'Û·','8':'Û¸','9':'Û¹','-':'âˆ’'};
  return String(str).replace(/[0-9-]/g, ch => map[ch] ?? ch);
};

const formatNumber=(n, precision)=>{
  if(!Number.isFinite(n)) return "â€”";
  const p=clamp(precision,0,12);
  const fixed = n.toFixed(p);
  const cleaned = (Math.abs(Number(fixed))===0) ? (0).toFixed(p) : fixed;
  if(p===0) return String(Number(cleaned));
  return cleaned.replace(/(\.\d*?)0+$/,'$1').replace(/\.$/,'');
};

const showToast=(msg,type="info")=>{
  const host=document.getElementById("toastHost");
  const el=document.createElement("div");
  const tone = {
    info: "border-sky-400/40 bg-sky-400/10",
    ok: "border-emerald-400/40 bg-emerald-400/10",
    warn: "border-amber-400/40 bg-amber-400/10",
    err: "border-rose-400/40 bg-rose-400/10"
  }[type] || "border-sky-400/40 bg-sky-400/10";
  el.className=`toast card p-3 ${tone}`;
  el.innerHTML = `<div class="flex items-start gap-3">
    <div class="grad w-9 h-9 rounded-xl flex items-center justify-center shrink-0">âœ¦</div>
    <div class="text-sm leading-6">${escapeHtml(msg)}</div>
  </div>`;
  host.appendChild(el);
  setTimeout(()=>{ el.style.opacity="0"; el.style.transform="translateY(6px)"; el.style.transition="250ms"; }, 2400);
  setTimeout(()=>el.remove(), 2750);
};

const copyText = async (text, okMsg="Ú©Ù¾ÛŒ Ø´Ø¯ âœ…") => {
  try{
    await navigator.clipboard.writeText(text);
    showToast(okMsg, "ok");
  }catch{
    showToast("Ø§Ù…Ú©Ø§Ù† Ú©Ù¾ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø¬ÙˆØ² Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", "err");
  }
};

/* ========================= Config System ========================= */
const FIXED_FOOTER_TEXT = "Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· FARHAD ğŸ¨";

const defaultConfig = {
  background_color:"#0b1220",
  surface_color:"#0f1b33",
  text_color:"#e8eefc",
  primary_action:"#38bdf8",
  secondary_action:"#a78bfa",
  font_family:'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"',
  font_size:16,
  accent_gradient_start:"#22c55e",
  accent_gradient_end:"#38bdf8",
  app_logo_emoji:"ğŸ”„",
  enable_persian_digits:true,
  copy_with_persian_digits:false,
  precision:2,
  enable_click_sound:true,
  click_volume:30,
  calculator_display_lang:"fa"
};

const elementSdk = (() => {
  const listeners = new Set();
  let config = loadConfig();
  function sanitize(partial){
    const p = {...(partial||{})};
    if ("footer_text" in p) delete p.footer_text;
    return p;
  }
  function loadConfig(){
    try{
      const raw=localStorage.getItem("proUnitConverter.config");
      if(!raw) return {...defaultConfig};
      const parsed=sanitize(JSON.parse(raw));
      return {...defaultConfig, ...(parsed||{})};
    }catch{ return {...defaultConfig}; }
  }
  function saveConfig(){ localStorage.setItem("proUnitConverter.config", JSON.stringify(config)); }
  function setConfig(partial){
    const clean = sanitize(partial);
    config = {...config, ...(clean||{})};
    saveConfig();
    listeners.forEach(fn=>fn(config));
  }
  function onConfigChange(fn){ listeners.add(fn); return ()=>listeners.delete(fn); }
  function mapToCapabilities(cfg){
    return {
      theme:{
        background: cfg.background_color,
        surface: cfg.surface_color,
        text: cfg.text_color,
        primary: cfg.primary_action,
        secondary: cfg.secondary_action,
        gradA: cfg.accent_gradient_start,
        gradB: cfg.accent_gradient_end
      },
      typography:{ fontFamily: cfg.font_family, fontSize: cfg.font_size },
      behavior:{
        enablePersianDigits: !!cfg.enable_persian_digits,
        copyWithPersianDigits: !!cfg.copy_with_persian_digits,
        precision: clamp(Number(cfg.precision ?? 2),0,8)
      },
      branding:{ logoEmoji: cfg.app_logo_emoji },
      sound:{ enabled: !!cfg.enable_click_sound, volume: clamp(Number(cfg.click_volume ?? 30),0,100) },
      calculator:{ displayLang: (cfg.calculator_display_lang==="en" ? "en" : "fa") }
    };
  }
  function attachExternal(){
    if (window.elementSdk && window.elementSdk !== api) return;
    window.elementSdk = api;
  }
  const api = { getConfig:()=>({...config}), setConfig, onConfigChange, mapToCapabilities, _attachExternal:attachExternal };
  attachExternal();
  return api;
})();

const displayNum = (x) => {
  const cfg = elementSdk.getConfig();
  const s = String(x);
  return cfg.enable_persian_digits ? toPersianDigits(s) : s;
};

const setToggleUI = (input, dot, on) => {
  input.checked = !!on;
  dot.style.right = on ? "1.75rem" : "0.25rem";
  dot.style.left = "auto";
};

const updateCalculatorDigitLabels = (lang) => {
  document.querySelectorAll(".calcDigit").forEach(btn=>{
    const fa = btn.getAttribute("data-fa");
    const en = btn.getAttribute("data-en");
    btn.textContent = (lang==="en") ? en : fa;
  });
};

const applyConfig = (cfg) => {
  const caps = elementSdk.mapToCapabilities(cfg);
  const r = document.documentElement.style;
  r.setProperty("--bg", caps.theme.background);
  r.setProperty("--surface", caps.theme.surface);
  r.setProperty("--text", caps.theme.text);
  r.setProperty("--primary", caps.theme.primary);
  r.setProperty("--secondary", caps.theme.secondary);
  r.setProperty("--gradA", caps.theme.gradA);
  r.setProperty("--gradB", caps.theme.gradB);
  r.setProperty("--ff", caps.typography.fontFamily);
  r.setProperty("--fs", `${caps.typography.fontSize}px`);

  document.getElementById("footerOut").textContent = FIXED_FOOTER_TEXT;
  document.getElementById("logoBadge").textContent = caps.branding.logoEmoji || defaultConfig.app_logo_emoji;

  setToggleUI(document.getElementById("persianDigitsToggle"), document.getElementById("persianDigitsDot"), caps.behavior.enablePersianDigits);
  setToggleUI(document.getElementById("uiPersianDigitsToggle"), document.getElementById("uiPersianDigitsDot"), caps.behavior.enablePersianDigits);
  setToggleUI(document.getElementById("copyPersianToggle"), document.getElementById("copyPersianDot"), caps.behavior.copyWithPersianDigits);

  setToggleUI(document.getElementById("soundToggle"), document.getElementById("soundDot"), caps.sound.enabled);
  document.getElementById("soundVolume").value = caps.sound.volume;
  document.getElementById("soundVolumeLabel").textContent = displayNum(caps.sound.volume);

  document.getElementById("precisionRange").value = caps.behavior.precision;
  document.getElementById("precisionLabel").textContent = displayNum(caps.behavior.precision);

  document.getElementById("calcDisplayLang").value = caps.calculator.displayLang;
  updateCalculatorDigitLabels(caps.calculator.displayLang);
};

/* ========================= Navigation ========================= */
const pages = ["converter","health","datetime","calculator","settings","help"];
const showPage = (id) => {
  const target = pages.includes(id) ? id : "converter";
  for(const p of pages){
    const el=document.getElementById(`page-${p}`);
    if(el) el.classList.toggle("hidden", p!==target);
  }
  document.querySelectorAll(".navBtn").forEach(btn=>{
    const active = btn.dataset.nav===target;
    btn.classList.toggle("tabActive", active);
    btn.classList.toggle("tabIdle", !active);
  });
  try{ history.replaceState(null,"",`#${target}`); }catch{}
};

const bindNav = () => {
  document.getElementById("topNav").addEventListener("click", (e)=>{
    const btn = e.target.closest(".navBtn");
    if(!btn) return;
    showPage(btn.dataset.nav);
  });
};

const maybePersianForCopy = (txt) => {
  const cfg=elementSdk.getConfig();
  return cfg.copy_with_persian_digits ? toPersianDigits(txt) : txt;
};

/* ========================= Unit Converter Data (10+ Ø¯Ø³ØªÙ‡) ========================= */
const UNIT = (label, symbol, toBase, fromBase) => ({label, symbol, toBase, fromBase});
const linearUnits = (units) => ({type:"linear", units});
const tempUnits = () => ({
  type:"temp",
  units:[
    {label:"Ø³Ù„Ø³ÛŒÙˆØ³", symbol:"Â°C", toBase:(c)=>c, fromBase:(c)=>c},
    {label:"ÙØ§Ø±Ù†Ù‡Ø§ÛŒØª", symbol:"Â°F", toBase:(f)=>(f-32)*5/9, fromBase:(c)=>c*9/5+32},
    {label:"Ú©Ù„ÙˆÛŒÙ†", symbol:"K", toBase:(k)=>k-273.15, fromBase:(c)=>c+273.15},
  ]
});

const CATEGORIES = [
  { id:"length", name:"Ø·ÙˆÙ„",
    def: linearUnits([
      UNIT("Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ±","mm", v=>v/1000, v=>v*1000),
      UNIT("Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±","cm", v=>v/100, v=>v*100),
      UNIT("Ù…ØªØ±","m", v=>v, v=>v),
      UNIT("Ú©ÛŒÙ„ÙˆÙ…ØªØ±","km", v=>v*1000, v=>v/1000),
      UNIT("Ø§ÛŒÙ†Ú†","in", v=>v*0.0254, v=>v/0.0254),
      UNIT("ÙÙˆØª","ft", v=>v*0.3048, v=>v/0.3048),
      UNIT("ÛŒØ§Ø±Ø¯","yd", v=>v*0.9144, v=>v/0.9144),
      UNIT("Ù…Ø§ÛŒÙ„","mi", v=>v*1609.344, v=>v/1609.344),
      UNIT("Ù…Ø§ÛŒÙ„ Ø¯Ø±ÛŒØ§ÛŒÛŒ","nmi", v=>v*1852, v=>v/1852),
    ]),
    quick:[
      {title:"Û± Ú©ÛŒÙ„ÙˆÙ…ØªØ± â†’ Ù…ØªØ±", value:1, from:"Ú©ÛŒÙ„ÙˆÙ…ØªØ±", to:"Ù…ØªØ±"},
      {title:"Û± Ù…Ø§ÛŒÙ„ â†’ Ú©ÛŒÙ„ÙˆÙ…ØªØ±", value:1, from:"Ù…Ø§ÛŒÙ„", to:"Ú©ÛŒÙ„ÙˆÙ…ØªØ±"},
      {title:"Û³Û° Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± â†’ Ø§ÛŒÙ†Ú†", value:30, from:"Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±", to:"Ø§ÛŒÙ†Ú†"},
      {title:"Û¶ ÙÙˆØª â†’ Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±", value:6, from:"ÙÙˆØª", to:"Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ±"},
    ]
  },
  { id:"mass", name:"Ø¬Ø±Ù…",
    def: linearUnits([
      UNIT("Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…","mg", v=>v/1e6, v=>v*1e6),
      UNIT("Ú¯Ø±Ù…","g", v=>v/1000, v=>v*1000),
      UNIT("Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…","kg", v=>v, v=>v),
      UNIT("ØªÙ†","t", v=>v*1000, v=>v/1000),
      UNIT("Ø§ÙˆÙ†Ø³","oz", v=>v*0.028349523125, v=>v/0.028349523125),
      UNIT("Ù¾ÙˆÙ†Ø¯","lb", v=>v*0.45359237, v=>v/0.45359237),
    ]),
    quick:[
      {title:"Û± Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù… â†’ Ú¯Ø±Ù…", value:1, from:"Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…", to:"Ú¯Ø±Ù…"},
      {title:"Û± Ù¾ÙˆÙ†Ø¯ â†’ Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…", value:1, from:"Ù¾ÙˆÙ†Ø¯", to:"Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…"},
      {title:"ÛµÛ°Û° Ú¯Ø±Ù… â†’ Ù¾ÙˆÙ†Ø¯", value:500, from:"Ú¯Ø±Ù…", to:"Ù¾ÙˆÙ†Ø¯"},
      {title:"Û² Ø§ÙˆÙ†Ø³ â†’ Ú¯Ø±Ù…", value:2, from:"Ø§ÙˆÙ†Ø³", to:"Ú¯Ø±Ù…"},
    ]
  },
  { id:"temp", name:"Ø¯Ù…Ø§", def: tempUnits(),
    quick:[
      {title:"Û°Â°C â†’ Â°F", value:0, from:"Ø³Ù„Ø³ÛŒÙˆØ³", to:"ÙØ§Ø±Ù†Ù‡Ø§ÛŒØª"},
      {title:"Û±Û°Û°Â°C â†’ Â°F", value:100, from:"Ø³Ù„Ø³ÛŒÙˆØ³", to:"ÙØ§Ø±Ù†Ù‡Ø§ÛŒØª"},
      {title:"Û³Û·Â°C â†’ Â°F", value:37, from:"Ø³Ù„Ø³ÛŒÙˆØ³", to:"ÙØ§Ø±Ù†Ù‡Ø§ÛŒØª"},
      {title:"Û²Û·Û³.Û±ÛµK â†’ Â°C", value:273.15, from:"Ú©Ù„ÙˆÛŒÙ†", to:"Ø³Ù„Ø³ÛŒÙˆØ³"},
    ]
  },
  { id:"area", name:"Ù…Ø³Ø§Ø­Øª",
    def: linearUnits([
      UNIT("Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ± Ù…Ø±Ø¨Ø¹","mmÂ²", v=>v/1e6, v=>v*1e6),
      UNIT("Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± Ù…Ø±Ø¨Ø¹","cmÂ²", v=>v/1e4, v=>v*1e4),
      UNIT("Ù…ØªØ± Ù…Ø±Ø¨Ø¹","mÂ²", v=>v, v=>v),
      UNIT("Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ù…Ø±Ø¨Ø¹","kmÂ²", v=>v*1e6, v=>v/1e6),
      UNIT("Ù‡Ú©ØªØ§Ø±","ha", v=>v*10000, v=>v/10000),
      UNIT("Ø§ÛŒÙ†Ú† Ù…Ø±Ø¨Ø¹","inÂ²", v=>v*0.00064516, v=>v/0.00064516),
      UNIT("ÙÙˆØª Ù…Ø±Ø¨Ø¹","ftÂ²", v=>v*0.09290304, v=>v/0.09290304),
      UNIT("ÛŒØ§Ø±Ø¯ Ù…Ø±Ø¨Ø¹","ydÂ²", v=>v*0.83612736, v=>v/0.83612736),
      UNIT("Ø§ÛŒÚ©Ø±","acre", v=>v*4046.8564224, v=>v/4046.8564224),
    ]),
    quick:[
      {title:"Û± Ù‡Ú©ØªØ§Ø± â†’ Ù…ØªØ± Ù…Ø±Ø¨Ø¹", value:1, from:"Ù‡Ú©ØªØ§Ø±", to:"Ù…ØªØ± Ù…Ø±Ø¨Ø¹"},
      {title:"Û± Ù…ØªØ± Ù…Ø±Ø¨Ø¹ â†’ ÙÙˆØª Ù…Ø±Ø¨Ø¹", value:1, from:"Ù…ØªØ± Ù…Ø±Ø¨Ø¹", to:"ÙÙˆØª Ù…Ø±Ø¨Ø¹"},
      {title:"Û± Ø§ÛŒÚ©Ø± â†’ Ù…ØªØ± Ù…Ø±Ø¨Ø¹", value:1, from:"Ø§ÛŒÚ©Ø±", to:"Ù…ØªØ± Ù…Ø±Ø¨Ø¹"},
      {title:"ÛµÛ° Ù…ØªØ± Ù…Ø±Ø¨Ø¹ â†’ Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± Ù…Ø±Ø¨Ø¹", value:50, from:"Ù…ØªØ± Ù…Ø±Ø¨Ø¹", to:"Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± Ù…Ø±Ø¨Ø¹"},
    ]
  },
  { id:"volume", name:"Ø­Ø¬Ù…",
    def: linearUnits([
      UNIT("Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±","mL", v=>v/1000, v=>v*1000),
      UNIT("Ù„ÛŒØªØ±","L", v=>v, v=>v),
      UNIT("Ù…ØªØ± Ù…Ú©Ø¹Ø¨","mÂ³", v=>v*1000, v=>v/1000),
      UNIT("Ø³Ø§Ù†ØªÛŒâ€ŒÙ…ØªØ± Ù…Ú©Ø¹Ø¨","cmÂ³", v=>v/1000, v=>v*1000),
      UNIT("Ú¯Ø§Ù„Ù† (Ø¢Ù…Ø±ÛŒÚ©Ø§)","gal", v=>v*3.785411784, v=>v/3.785411784),
      UNIT("Ú©ÙˆØ§Ø±Øª (Ø¢Ù…Ø±ÛŒÚ©Ø§)","qt", v=>v*0.946352946, v=>v/0.946352946),
      UNIT("Ù¾ÛŒÙ†Øª (Ø¢Ù…Ø±ÛŒÚ©Ø§)","pt", v=>v*0.473176473, v=>v/0.473176473),
      UNIT("ÙÙ†Ø¬Ø§Ù† (Ø¢Ù…Ø±ÛŒÚ©Ø§)","cup", v=>v*0.2365882365, v=>v/0.2365882365),
      UNIT("Ø§ÙˆÙ†Ø³ Ù…Ø§ÛŒØ¹ (Ø¢Ù…Ø±ÛŒÚ©Ø§)","fl oz", v=>v*0.0295735295625, v=>v/0.0295735295625),
    ]),
    quick:[
      {title:"Û± Ù„ÛŒØªØ± â†’ Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±", value:1, from:"Ù„ÛŒØªØ±", to:"Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±"},
      {title:"Û± Ú¯Ø§Ù„Ù† â†’ Ù„ÛŒØªØ±", value:1, from:"Ú¯Ø§Ù„Ù† (Ø¢Ù…Ø±ÛŒÚ©Ø§)", to:"Ù„ÛŒØªØ±"},
      {title:"Û²ÛµÛ° Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ± â†’ Ù„ÛŒØªØ±", value:250, from:"Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±", to:"Ù„ÛŒØªØ±"},
      {title:"Û± Ù…ØªØ± Ù…Ú©Ø¹Ø¨ â†’ Ù„ÛŒØªØ±", value:1, from:"Ù…ØªØ± Ù…Ú©Ø¹Ø¨", to:"Ù„ÛŒØªØ±"},
    ]
  },
  { id:"speed", name:"Ø³Ø±Ø¹Øª",
    def: linearUnits([
      UNIT("Ù…ØªØ± Ø¨Ø± Ø«Ø§Ù†ÛŒÙ‡","m/s", v=>v, v=>v),
      UNIT("Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª","km/h", v=>v/3.6, v=>v*3.6),
      UNIT("Ù…Ø§ÛŒÙ„ Ø¨Ø± Ø³Ø§Ø¹Øª","mph", v=>v*0.44704, v=>v/0.44704),
      UNIT("Ú¯Ø±Ù‡ (Ù†Ø§Øª)","kt", v=>v*0.514444, v=>v/0.514444),
      UNIT("ÙÙˆØª Ø¨Ø± Ø«Ø§Ù†ÛŒÙ‡","ft/s", v=>v*0.3048, v=>v/0.3048),
    ]),
    quick:[
      {title:"Û±Û°Û° km/h â†’ m/s", value:100, from:"Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª", to:"Ù…ØªØ± Ø¨Ø± Ø«Ø§Ù†ÛŒÙ‡"},
      {title:"Û±Û° m/s â†’ km/h", value:10, from:"Ù…ØªØ± Ø¨Ø± Ø«Ø§Ù†ÛŒÙ‡", to:"Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª"},
      {title:"Û¶Û° mph â†’ km/h", value:60, from:"Ù…Ø§ÛŒÙ„ Ø¨Ø± Ø³Ø§Ø¹Øª", to:"Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª"},
      {title:"Û²Û° kt â†’ km/h", value:20, from:"Ú¯Ø±Ù‡ (Ù†Ø§Øª)", to:"Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª"},
    ]
  },
  { id:"time", name:"Ø²Ù…Ø§Ù†",
    def: linearUnits([
      UNIT("Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡","ms", v=>v/1000, v=>v*1000),
      UNIT("Ø«Ø§Ù†ÛŒÙ‡","s", v=>v, v=>v),
      UNIT("Ø¯Ù‚ÛŒÙ‚Ù‡","min", v=>v*60, v=>v/60),
      UNIT("Ø³Ø§Ø¹Øª","h", v=>v*3600, v=>v/3600),
      UNIT("Ø±ÙˆØ²","day", v=>v*86400, v=>v/86400),
      UNIT("Ù‡ÙØªÙ‡","week", v=>v*604800, v=>v/604800),
    ]),
    quick:[
      {title:"Û¹Û° Ø¯Ù‚ÛŒÙ‚Ù‡ â†’ Ø³Ø§Ø¹Øª", value:90, from:"Ø¯Ù‚ÛŒÙ‚Ù‡", to:"Ø³Ø§Ø¹Øª"},
      {title:"Û± Ø±ÙˆØ² â†’ Ø³Ø§Ø¹Øª", value:1, from:"Ø±ÙˆØ²", to:"Ø³Ø§Ø¹Øª"},
      {title:"Û³Û¶Û°Û° Ø«Ø§Ù†ÛŒÙ‡ â†’ Ø³Ø§Ø¹Øª", value:3600, from:"Ø«Ø§Ù†ÛŒÙ‡", to:"Ø³Ø§Ø¹Øª"},
      {title:"Û² Ù‡ÙØªÙ‡ â†’ Ø±ÙˆØ²", value:2, from:"Ù‡ÙØªÙ‡", to:"Ø±ÙˆØ²"},
    ]
  },
  { id:"pressure", name:"ÙØ´Ø§Ø±",
    def: linearUnits([
      UNIT("Ù¾Ø§Ø³Ú©Ø§Ù„","Pa", v=>v, v=>v),
      UNIT("Ú©ÛŒÙ„ÙˆÙ¾Ø§Ø³Ú©Ø§Ù„","kPa", v=>v*1000, v=>v/1000),
      UNIT("Ø¨Ø§Ø±","bar", v=>v*100000, v=>v/100000),
      UNIT("Ø§ØªÙ…Ø³ÙØ±","atm", v=>v*101325, v=>v/101325),
      UNIT("Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ± Ø¬ÛŒÙˆÙ‡","mmHg", v=>v*133.322368421, v=>v/133.322368421),
      UNIT("psi","psi", v=>v*6894.757293168, v=>v/6894.757293168),
    ]),
    quick:[
      {title:"Û± atm â†’ kPa", value:1, from:"Ø§ØªÙ…Ø³ÙØ±", to:"Ú©ÛŒÙ„ÙˆÙ¾Ø§Ø³Ú©Ø§Ù„"},
      {title:"Û² bar â†’ psi", value:2, from:"Ø¨Ø§Ø±", to:"psi"},
      {title:"Û·Û¶Û° mmHg â†’ atm", value:760, from:"Ù…ÛŒÙ„ÛŒâ€ŒÙ…ØªØ± Ø¬ÛŒÙˆÙ‡", to:"Ø§ØªÙ…Ø³ÙØ±"},
      {title:"Û±Û°Û° kPa â†’ bar", value:100, from:"Ú©ÛŒÙ„ÙˆÙ¾Ø§Ø³Ú©Ø§Ù„", to:"Ø¨Ø§Ø±"},
    ]
  },
  { id:"energy", name:"Ø§Ù†Ø±Ú˜ÛŒ",
    def: linearUnits([
      UNIT("Ú˜ÙˆÙ„","J", v=>v, v=>v),
      UNIT("Ú©ÛŒÙ„ÙˆÚ˜ÙˆÙ„","kJ", v=>v*1000, v=>v/1000),
      UNIT("Ú©Ø§Ù„Ø±ÛŒ","cal", v=>v*4.184, v=>v/4.184),
      UNIT("Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ","kcal", v=>v*4184, v=>v/4184),
      UNIT("ÙˆØ§Øªâ€ŒØ³Ø§Ø¹Øª","Wh", v=>v*3600, v=>v/3600),
      UNIT("Ú©ÛŒÙ„ÙˆÙˆØ§Øªâ€ŒØ³Ø§Ø¹Øª","kWh", v=>v*3.6e6, v=>v/3.6e6),
      UNIT("Ø§Ù„Ú©ØªØ±ÙˆÙ†â€ŒÙˆÙ„Øª","eV", v=>v*1.602176634e-19, v=>v/1.602176634e-19),
    ]),
    quick:[
      {title:"Û±Û°Û°Û° J â†’ kJ", value:1000, from:"Ú˜ÙˆÙ„", to:"Ú©ÛŒÙ„ÙˆÚ˜ÙˆÙ„"},
      {title:"ÛµÛ°Û° kcal â†’ kJ", value:500, from:"Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ", to:"Ú©ÛŒÙ„ÙˆÚ˜ÙˆÙ„"},
      {title:"Û± kWh â†’ J", value:1, from:"Ú©ÛŒÙ„ÙˆÙˆØ§Øªâ€ŒØ³Ø§Ø¹Øª", to:"Ú˜ÙˆÙ„"},
      {title:"Û²ÛµÛ° Wh â†’ kWh", value:250, from:"ÙˆØ§Øªâ€ŒØ³Ø§Ø¹Øª", to:"Ú©ÛŒÙ„ÙˆÙˆØ§Øªâ€ŒØ³Ø§Ø¹Øª"},
    ]
  },
  { id:"data", name:"Ø¯Ø§Ø¯Ù‡ (Ø­Ø¬Ù… ÙØ§ÛŒÙ„)",
    def: linearUnits([
      UNIT("Ø¨ÛŒØª","b", v=>v/8, v=>v*8),
      UNIT("Ø¨Ø§ÛŒØª","B", v=>v, v=>v),
      UNIT("Ú©ÛŒÙ„ÙˆØ¨Ø§ÛŒØª","KB", v=>v*1000, v=>v/1000),
      UNIT("Ù…Ú¯Ø§Ø¨Ø§ÛŒØª","MB", v=>v*1e6, v=>v/1e6),
      UNIT("Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª","GB", v=>v*1e9, v=>v/1e9),
      UNIT("ØªØ±Ø§Ø¨Ø§ÛŒØª","TB", v=>v*1e12, v=>v/1e12),
      UNIT("Ú©ÛŒØ¨ÛŒâ€ŒØ¨Ø§ÛŒØª","KiB", v=>v*1024, v=>v/1024),
      UNIT("Ù…Ø¨ÛŒâ€ŒØ¨Ø§ÛŒØª","MiB", v=>v*1024*1024, v=>v/(1024*1024)),
      UNIT("Ú¯ÛŒØ¨ÛŒâ€ŒØ¨Ø§ÛŒØª","GiB", v=>v*1024*1024*1024, v=>v/(1024*1024*1024)),
    ]),
    quick:[
      {title:"Û±Û°Û²Û´ KiB â†’ MiB", value:1024, from:"Ú©ÛŒØ¨ÛŒâ€ŒØ¨Ø§ÛŒØª", to:"Ù…Ø¨ÛŒâ€ŒØ¨Ø§ÛŒØª"},
      {title:"Û± GB â†’ MB", value:1, from:"Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª", to:"Ù…Ú¯Ø§Ø¨Ø§ÛŒØª"},
      {title:"Û¸ Ø¨ÛŒØª â†’ Ø¨Ø§ÛŒØª", value:8, from:"Ø¨ÛŒØª", to:"Ø¨Ø§ÛŒØª"},
      {title:"ÛµÛ°Û° MB â†’ GB", value:500, from:"Ù…Ú¯Ø§Ø¨Ø§ÛŒØª", to:"Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª"},
    ]
  },
];

let state = { categoryId: CATEGORIES[0].id, fromLabel: null, toLabel: null };
const getCategory = (id)=>CATEGORIES.find(c=>c.id===id) || CATEGORIES[0];
const findUnitByLabel = (cat, label) => cat.def.units.find(u=>u.label===label) || cat.def.units[0];
const convertValue = (cat, value, fromUnit, toUnit) => {
  if(!Number.isFinite(value)) return NaN;
  const base = fromUnit.toBase(value);
  return toUnit.fromBase(base);
};

const renderQuick = (cat) => {
  const grid=document.getElementById("quickGrid");
  grid.innerHTML="";
  (cat.quick||[]).slice(0,8).forEach(q=>{
    const b=document.createElement("button");
    b.type="button";
    b.className="btn soft px-3 py-2 text-right focusable";
    b.innerHTML=`<div class="font-semibold text-sm">${escapeHtml(q.title)}</div>
                 <div class="muted tiny mt-0.5">ØªÙ†Ø¸ÛŒÙ… Ø³Ø±ÛŒØ¹</div>`;
    b.addEventListener("click", ()=>{
      document.getElementById("valueInput").value = q.value;
      const fromSel=document.getElementById("fromUnitSel");
      const toSel=document.getElementById("toUnitSel");
      if([...fromSel.options].some(o=>o.value===q.from)) fromSel.value=q.from;
      if([...toSel.options].some(o=>o.value===q.to)) toSel.value=q.to;
      state.fromLabel = fromSel.value;
      state.toLabel = toSel.value;
      computeConverter();
      showToast("ØªÙ†Ø¸ÛŒÙ… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ âœ…", "ok");
    });
    grid.appendChild(b);
  });
};

const setUnitsForCategory = (catId) => {
  const cat=getCategory(catId);
  const fromSel=document.getElementById("fromUnitSel");
  const toSel=document.getElementById("toUnitSel");
  fromSel.innerHTML=""; toSel.innerHTML="";
  cat.def.units.forEach(u=>{
    const o1=document.createElement("option"); o1.value=u.label; o1.textContent=`${u.label} (${u.symbol})`;
    const o2=document.createElement("option"); o2.value=u.label; o2.textContent=`${u.label} (${u.symbol})`;
    fromSel.appendChild(o1); toSel.appendChild(o2);
  });
  const fromKeep = state.fromLabel && cat.def.units.some(u=>u.label===state.fromLabel) ? state.fromLabel : cat.def.units[0].label;
  const toKeep   = state.toLabel   && cat.def.units.some(u=>u.label===state.toLabel)   ? state.toLabel   : cat.def.units[Math.min(1,cat.def.units.length-1)].label;
  fromSel.value = fromKeep;
  toSel.value = toKeep;
  state.fromLabel = fromKeep;
  state.toLabel = toKeep;
  renderQuick(cat);
  computeConverter();
};

const computeConverter = () => {
  const cfg = elementSdk.getConfig();
  const cat = getCategory(document.getElementById("categorySel").value);
  const fromUnit = findUnitByLabel(cat, document.getElementById("fromUnitSel").value);
  const toUnit = findUnitByLabel(cat, document.getElementById("toUnitSel").value);
  const inputVal = safeNum(document.getElementById("valueInput").value);
  const precision = clamp(Number(cfg.precision ?? 2),0,8);

  const result = convertValue(cat, inputVal, fromUnit, toUnit);
  const rawText = formatNumber(result, precision);
  const shown = cfg.enable_persian_digits ? toPersianDigits(rawText) : rawText;

  document.getElementById("resultValue").textContent = (Number.isFinite(result) ? shown : "â€”");
  document.getElementById("resultUnit").textContent = `${toUnit.label} (${toUnit.symbol})`;
  document.getElementById("converterNote").textContent = Number.isFinite(inputVal) ? "" : "Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù†ØªÛŒØ¬Ù‡ØŒ ÛŒÚ© Ù…Ù‚Ø¯Ø§Ø± Ø¹Ø¯Ø¯ÛŒ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.";
};

const swapUnits = () => {
  const fromSel=document.getElementById("fromUnitSel");
  const toSel=document.getElementById("toUnitSel");
  const a=fromSel.value, b=toSel.value;
  fromSel.value=b; toSel.value=a;
  state.fromLabel = fromSel.value;
  state.toLabel = toSel.value;
  computeConverter();
  showToast("ÙˆØ§Ø­Ø¯Ù‡Ø§ Ø¬Ø§Ø¨Ø¬Ø§ Ø´Ø¯Ù†Ø¯.", "info");
};

/* ========================= Health Logic ========================= */
const bmiCategory = (bmi) => {
  if(!Number.isFinite(bmi)) return "â€”";
  if(bmi < 18.5) return "Ú©Ù…â€ŒÙˆØ²Ù†";
  if(bmi < 25) return "Ù†Ø±Ù…Ø§Ù„";
  if(bmi < 30) return "Ø§Ø¶Ø§ÙÙ‡â€ŒÙˆØ²Ù†";
  if(bmi < 35) return "Ú†Ø§Ù‚ÛŒ Ø¯Ø±Ø¬Ù‡ Û±";
  if(bmi < 40) return "Ú†Ø§Ù‚ÛŒ Ø¯Ø±Ø¬Ù‡ Û²";
  return "Ú†Ø§Ù‚ÛŒ Ø¯Ø±Ø¬Ù‡ Û³";
};

const calculateBMI = (wKg, hCm) => {
  const h = hCm / 100;
  if(!(wKg>0) || !(h>0)) return NaN;
  return wKg / (h*h);
};

const healthyWeightRange = (hCm) => {
  const h = hCm/100;
  if(!(h>0)) return {min:NaN,max:NaN};
  return {min:18.5*h*h, max:24.9*h*h};
};

const calculateBMR = (sex, wKg, hCm, age) => {
  if(!(wKg>0) || !(hCm>0) || !(age>0)) return NaN;
  const base = 10*wKg + 6.25*hCm - 5*age;
  return sex==="male" ? base + 5 : base - 161;
};

const calculateTDEE = (bmr, activityFactor) => {
  if(!Number.isFinite(bmr) || !Number.isFinite(activityFactor)) return NaN;
  return bmr * activityFactor;
};

const computeBMIUI = () => {
  const cfg=elementSdk.getConfig();
  const p=clamp(Number(cfg.precision ?? 2),0,8);
  const w=safeNum(document.getElementById("bmiWeight").value);
  const h=safeNum(document.getElementById("bmiHeight").value);
  const bmi=calculateBMI(w,h);

  const valRaw = formatNumber(bmi, p);
  document.getElementById("bmiValue").textContent = (Number.isFinite(bmi) ? (cfg.enable_persian_digits ? toPersianDigits(valRaw) : valRaw) : "â€”");
  document.getElementById("bmiCat").textContent = (Number.isFinite(bmi) ? bmiCategory(bmi) : "â€”");

  const showIdeal = document.getElementById("idealWeightToggle").checked;
  const box = document.getElementById("idealWeightBox");
  box.classList.toggle("hidden", !showIdeal);
  if(showIdeal && Number.isFinite(h) && h>0){
    const r=healthyWeightRange(h);
    const minS = formatNumber(r.min, p);
    const maxS = formatNumber(r.max, p);
    const out = cfg.enable_persian_digits ? `${toPersianDigits(minS)} ØªØ§ ${toPersianDigits(maxS)}` : `${minS} ØªØ§ ${maxS}`;
    document.getElementById("idealWeightRange").textContent = out;
  }else if(showIdeal){
    document.getElementById("idealWeightRange").textContent = "â€”";
  }

  const warn=document.getElementById("bmiWarn");
  warn.classList.add("hidden");
  warn.className="mt-2 hidden tiny";
  if((w && w<25) || (w && w>300) || (h && h<100) || (h && h>230)){
    warn.classList.remove("hidden");
    warn.classList.add("text-amber-200");
    warn.textContent = "Ù‡Ø´Ø¯Ø§Ø±: Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ú©Ù…ÛŒ ØºÛŒØ±Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ù†Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.";
  }
};

const computeCaloriesUI = () => {
  const cfg=elementSdk.getConfig();
  const p=clamp(Number(cfg.precision ?? 2),0,8);
  const sex=document.getElementById("sexSel").value;
  const age=safeNum(document.getElementById("ageInput").value);
  const h=safeNum(document.getElementById("calHeight").value);
  const w=safeNum(document.getElementById("calWeight").value);
  const activity=safeNum(document.getElementById("activitySel").value);
  const goalAdj=safeNum(document.getElementById("goalSel").value);

  const err=document.getElementById("calError");
  err.classList.add("hidden");
  err.className="hidden mb-2 text-sm font-semibold";

  if((age && age<=0) || (h && h<=0) || (w && w<=0)){
    err.classList.remove("hidden");
    err.classList.add("text-rose-200");
    err.textContent="Ø®Ø·Ø§: Ø³Ù†ØŒ Ù‚Ø¯ Ùˆ ÙˆØ²Ù† Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² ØµÙØ± Ø¨Ø§Ø´Ù†Ø¯.";
  }

  const bmr=calculateBMR(sex,w,h,age);
  const tdee=calculateTDEE(bmr,activity);
  const goal = Number.isFinite(tdee) ? (tdee + (Number.isFinite(goalAdj)?goalAdj:0)) : NaN;

  const bmrS = Number.isFinite(bmr) ? formatNumber(bmr, p) : "â€”";
  const tdeeS = Number.isFinite(tdee) ? formatNumber(tdee, p) : "â€”";
  const goalS = Number.isFinite(goal) ? formatNumber(goal, p) : "â€”";

  document.getElementById("bmrOut").textContent = cfg.enable_persian_digits ? toPersianDigits(bmrS) : bmrS;
  document.getElementById("tdeeOut").textContent = cfg.enable_persian_digits ? toPersianDigits(tdeeS) : tdeeS;
  document.getElementById("goalOut").textContent = cfg.enable_persian_digits ? toPersianDigits(goalS) : goalS;

  const warn=document.getElementById("calWarn");
  warn.classList.add("hidden");
  warn.className="mt-2 hidden tiny";
  const odd = (age && (age<10 || age>90)) || (h && (h<120 || h>220)) || (w && (w<35 || w>250));
  if(odd){
    warn.classList.remove("hidden");
    warn.classList.add("text-amber-200");
    warn.textContent="Ù‡Ø´Ø¯Ø§Ø±: Ø§Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ø§Ø´Ù†Ø¯. Ù†ØªÛŒØ¬Ù‡ ØµØ±ÙØ§Ù‹ ØªØ®Ù…ÛŒÙ†ÛŒ Ø§Ø³Øª.";
  }
};

/* ========================= Sound ========================= */
let audioCtx = null;
const ensureAudio = () => {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});
};
const playClick = () => {
  const cfg = elementSdk.getConfig();
  if (!cfg.enable_click_sound) return;
  ensureAudio();
  const vol = clamp(Number(cfg.click_volume ?? 30),0,100) / 100;
  try{
    const t = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = "square";
    osc.frequency.setValueAtTime(1200, t);
    g.gain.setValueAtTime(0.0001, t);
    g.gain.exponentialRampToValueAtTime(Math.max(0.0001, vol*0.05), t + 0.005);
    g.gain.exponentialRampToValueAtTime(0.0001, t + 0.03);
    osc.connect(g);
    g.connect(audioCtx.destination);
    osc.start(t);
    osc.stop(t + 0.035);
  }catch{}
};

/* ========================= Calculator ========================= */
let calcExpr = "";
let calcMem = 0;

const normalizeCalcInput = (s) => {
  const latin = toLatinDigits(s)
    .replace(/Ã—/g,'*').replace(/Ã·/g,'/')
    .replace(/Ùª/g,'%');
  return latin;
};

const isOperator = (t) => ["+","-","*","/"].includes(t);
const precedence = (op) => (op==="+"||op==="-"?1:2);

const tokenize = (expr) => {
  const s = normalizeCalcInput(expr).replace(/\s+/g,'');
  const tokens = [];
  let i=0;
  while(i<s.length){
    const ch=s[i];
    if(/[0-9.]/.test(ch)){
      let j=i+1;
      while(j<s.length && /[0-9.]/.test(s[j])) j++;
      tokens.push({type:"num", value:s.slice(i,j)});
      i=j; continue;
    }
    if(ch==="("||ch===")"){ tokens.push({type:"paren", value:ch}); i++; continue; }
    if(isOperator(ch)){ tokens.push({type:"op", value:ch}); i++; continue; }
    if(ch==="%"){ tokens.push({type:"pct", value:"%"}); i++; continue; }
    i++;
  }
  return tokens;
};

const toRPN = (tokens) => {
  const out=[], st=[];
  for(let idx=0; idx<tokens.length; idx++){
    const t=tokens[idx];
    if(t.type==="num"){ out.push(t); continue; }
    if(t.type==="pct"){ out.push(t); continue; }

    if(t.type==="op"){
      if(t.value==="-" && (idx===0 || (tokens[idx-1].type==="op") || (tokens[idx-1].type==="paren" && tokens[idx-1].value==="("))){
        out.push({type:"num", value:"0"});
      }
      while(st.length){
        const top=st[st.length-1];
        if(top.type==="op" && precedence(top.value) >= precedence(t.value)){
          out.push(st.pop());
        }else break;
      }
      st.push(t);
      continue;
    }
    if(t.type==="paren" && t.value==="("){ st.push(t); continue; }
    if(t.type==="paren" && t.value===")"){
      while(st.length && !(st[st.length-1].type==="paren" && st[st.length-1].value==="(")){
        out.push(st.pop());
      }
      if(st.length && st[st.length-1].type==="paren") st.pop();
      continue;
    }
  }
  while(st.length) out.push(st.pop());
  return out;
};

const evalRPN = (rpn) => {
  const st=[];
  for(const t of rpn){
    if(t.type==="num"){
      const v=Number(t.value);
      if(!Number.isFinite(v)) return NaN;
      st.push(v);
      continue;
    }
    if(t.type==="pct"){
      if(st.length<1) return NaN;
      const a=st.pop();
      st.push(a/100);
      continue;
    }
    if(t.type==="op"){
      if(st.length<2) return NaN;
      const b=st.pop(), a=st.pop();
      let r=NaN;
      if(t.value==="+") r=a+b;
      else if(t.value==="-") r=a-b;
      else if(t.value==="*") r=a*b;
      else if(t.value==="/") r=b===0 ? NaN : a/b;
      st.push(r);
      continue;
    }
  }
  return st.length===1 ? st[0] : NaN;
};

const calcEvaluate = () => {
  const cfg=elementSdk.getConfig();
  const caps=elementSdk.mapToCapabilities(cfg);
  const p=clamp(Number(cfg.precision ?? 2),0,8);

  const lang = caps.calculator.displayLang;
  const exprShown = calcExpr.trim() ? calcExpr : "â€”";
  const memStr = formatNumber(calcMem, 2).replace(/\.0+$/,'');

  document.getElementById("calcExpr").textContent = (lang==="fa" ? toPersianDigits(exprShown) : toLatinDigits(exprShown));
  document.getElementById("memBadge").textContent = (lang==="fa" ? toPersianDigits(memStr) : toLatinDigits(memStr));

  if(!calcExpr.trim()){
    document.getElementById("calcResult").textContent = (lang==="fa" ? "Û°" : "0");
    return;
  }

  const val=evalRPN(toRPN(tokenize(calcExpr)));
  const out = Number.isFinite(val) ? formatNumber(val, p) : "â€”";
  document.getElementById("calcResult").textContent = (lang==="fa" ? toPersianDigits(out) : toLatinDigits(out));
};

const calcPush = (k) => {
  playClick();
  const mapped = (k==="Ã·")?"/":(k==="Ã—")?"*":(k==="Ùª")?"%":k;

  if(mapped==="="){
    const val=evalRPN(toRPN(tokenize(calcExpr)));
    if(!Number.isFinite(val)){
      showToast("Ø¹Ø¨Ø§Ø±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.", "warn");
      return;
    }
    const cfg=elementSdk.getConfig();
    const p=clamp(Number(cfg.precision ?? 2),0,8);
    calcExpr = formatNumber(val, p);
    calcEvaluate();
    return;
  }

  if(mapped==="DEL"){
    calcExpr = calcExpr.slice(0, -1);
    calcEvaluate();
    return;
  }

  if(mapped==="MC"){ calcMem=0; calcEvaluate(); showToast("Ø­Ø§ÙØ¸Ù‡ Ù¾Ø§Ú© Ø´Ø¯.", "info"); return; }
  if(mapped==="MR"){ calcExpr += String(calcMem); calcEvaluate(); return; }
  if(mapped==="M+" || mapped==="M-"){
    const val=evalRPN(toRPN(tokenize(calcExpr)));
    if(!Number.isFinite(val)){ showToast("Ø¨Ø±Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡ØŒ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¹Ø¨Ø§Ø±Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", "warn"); return; }
    calcMem += (mapped==="M+") ? val : -val;
    calcEvaluate();
    showToast("Ø­Ø§ÙØ¸Ù‡ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.", "ok");
    return;
  }

  const norm = toLatinDigits(mapped);
  const allowed = /[0-9+\-*/().%]/;
  if(norm.length===1 && allowed.test(norm)){
    calcExpr += norm;
    calcEvaluate();
  }
};
const calcClear = () => { playClick(); calcExpr=""; calcEvaluate(); };

/* ========================= DateTime via TimeAPI.io (FIX Ú©Ø§Ù…Ù„) =========================
   - ÙÙ‚Ø· ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ + Ø³Ø§Ø¹Øª Ø§ÛŒØ±Ø§Ù† + Ø³Ø§Ø¹Øª UTC
   - Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø®ØªÙ„Ø§Ù Û± Ø³Ø§Ø¹Øª: Ù‡ÛŒÚ† ØªØ¨Ø¯ÛŒÙ„ Date/Intl Ø±ÙˆÛŒ Ø²Ù…Ø§Ù† API Ø§Ù†Ø¬Ø§Ù… Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
   - Ø´Ù…Ø³ÛŒ Ø¨Ø§ ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø®Ù„ÛŒ Ø§Ø² ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø§ÛŒØ±Ø§Ù†
   - Ù‚Ù…Ø±ÛŒ Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
*/
const TIMEAPI_BASE = "https://timeapi.io/api/Time/current/zone";
const TZ_IR = "Asia/Tehran";
const TZ_UTC = "Etc/UTC";

let timeState = {
  lastOk:false,
  timeIR:"â€”",
  timeUTC:"â€”",
  jalali:"â€”",
  greg:"â€”",
  updatedAt:"â€”"
};

const pad2 = (n) => String(n).padStart(2,"0");

const setTimeStatus = (kind, hint="") => {
  const el = document.getElementById("timeStatusText");
  const h = document.getElementById("timeStatusHint");
  if(!el || !h) return;

  if(kind==="ok"){
    el.className="tiny text-emerald-200";
    el.textContent="Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ âœ…";
  }else if(kind==="warn"){
    el.className="tiny text-amber-200";
    el.textContent="Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øªâ€¦";
  }else{
    el.className="tiny text-rose-200";
    el.textContent="Ø®Ø·Ø§: Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯.";
  }
  h.textContent = hint || "";
};

const fmtMaybeFaDigits = (s) => {
  const cfg = elementSdk.getConfig();
  if(s==null || s==="â€”") return "â€”";
  return cfg.enable_persian_digits ? toPersianDigits(String(s)) : String(s);
};

const renderTime = () => {
  const elJ = document.getElementById("todayJalali");
  const elG = document.getElementById("todayGreg");
  const elIR = document.getElementById("timeIR");
  const elUTC = document.getElementById("timeUTC");
  const elU = document.getElementById("timeUpdatedAt");

  if(elJ) elJ.textContent = fmtMaybeFaDigits(timeState.jalali);
  if(elG) elG.textContent = fmtMaybeFaDigits(timeState.greg);
  if(elIR) elIR.textContent = fmtMaybeFaDigits(timeState.timeIR);
  if(elUTC) elUTC.textContent = fmtMaybeFaDigits(timeState.timeUTC);
  if(elU) elU.textContent = fmtMaybeFaDigits(timeState.updatedAt);

  const hijriCard = document.getElementById("hijriCard");
  if(hijriCard) hijriCard.style.display = "none";
};

const gregorianToJalali = (gy, gm, gd) => {
  const g_d_m = [0,31,59,90,120,151,181,212,243,273,304,334];
  let jy;
  if (gy > 1600) { jy = 979; gy -= 1600; } else { jy = 0; gy -= 621; }

  const gy2 = (gm > 2) ? (gy + 1) : gy;
  let days = 365*gy
    + Math.floor((gy2 + 3)/4)
    - Math.floor((gy2 + 99)/100)
    + Math.floor((gy2 + 399)/400)
    - 80
    + gd
    + g_d_m[gm-1];

  jy += 33 * Math.floor(days / 12053);
  days %= 12053;

  jy += 4 * Math.floor(days / 1461);
  days %= 1461;

  if (days > 365) {
    jy += Math.floor((days - 1) / 365);
    days = (days - 1) % 365;
  }

  const jm = (days < 186) ? (1 + Math.floor(days / 31)) : (7 + Math.floor((days - 186) / 30));
  const jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
  return { jy, jm, jd };
};

const fetchTimeApiZone = async (timeZone) => {
  const url = `${TIMEAPI_BASE}?timeZone=${encodeURIComponent(timeZone)}`;
  const res = await fetch(url, { cache:"no-store" });
  if(!res.ok) throw new Error("bad_status");
  const data = await res.json();
  if(!data || typeof data.year !== "number" || typeof data.hour !== "number") throw new Error("bad_payload");
  return data; // year, month, day, hour, minute, seconds, dateTime, timeZone, dstActive...
};

const buildTimeString = (d) => `${pad2(d.hour)}:${pad2(d.minute)}:${pad2(d.seconds ?? 0)}`;

const fetchTimeApi = async () => {
  try{
    setTimeStatus("warn","Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² TimeAPI.ioâ€¦");

    // Ù†Ú©ØªÙ‡ Ú©Ù„ÛŒØ¯ÛŒ: Ø²Ù…Ø§Ù† Ø±Ø§ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² hour/minute/seconds Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ… Ùˆ Ù‡ÛŒÚ† ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¶Ø§ÙÙ‡ Ø§Ù†Ø¬Ø§Ù… Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ….
    const [ir, utc] = await Promise.all([
      fetchTimeApiZone(TZ_IR),
      fetchTimeApiZone(TZ_UTC)
    ]);

    timeState.timeIR = buildTimeString(ir);
    timeState.timeUTC = buildTimeString(utc);

    timeState.greg = `${ir.year}-${pad2(ir.month)}-${pad2(ir.day)}`;

    const j = gregorianToJalali(ir.year, ir.month, ir.day);
    timeState.jalali = `${j.jy}/${pad2(j.jm)}/${pad2(j.jd)}`;

    timeState.updatedAt = `${timeState.timeIR} (Ø§ÛŒØ±Ø§Ù†)`;
    timeState.lastOk = true;

    setTimeStatus("ok","Ù‡Ø± Û³Û° Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ©â€ŒØ¨Ø§Ø± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.");
    renderTime();
  }catch{
    timeState.lastOk = false;
    setTimeStatus("err","Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² TimeAPI.io Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯. Ø§ÛŒÙ†ØªØ±Ù†Øª/Ø§Ø®ØªÙ„Ø§Ù„ Ø³Ø±ÙˆÛŒØ³ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
    renderTime();
  }
};

/* ========================= Settings helpers ========================= */
const bindColorPair = (colorInput, textInput, key) => {
  const syncFromColor = () => { textInput.value = colorInput.value; elementSdk.setConfig({[key]: colorInput.value}); };
  const syncFromText = () => {
    const v=textInput.value.trim();
    if(/^#([0-9a-fA-F]{6})$/.test(v)){ colorInput.value=v; elementSdk.setConfig({[key]: v}); }
    else showToast("Ú©Ø¯ Ø±Ù†Ú¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. Ù…Ø«Ù„: #0b1220", "warn");
  };
  colorInput.addEventListener("input", syncFromColor);
  textInput.addEventListener("change", syncFromText);
};

const syncSettingsForm = (cfg) => {
  const setPair=(cId,tId,val)=>{
    const c=document.getElementById(cId), t=document.getElementById(tId);
    c.value = val; t.value = val;
  };
  setPair("bgColor","bgColorText", cfg.background_color);
  setPair("surfaceColor","surfaceColorText", cfg.surface_color);
  setPair("textColor","textColorText", cfg.text_color);
  setPair("primaryColor","primaryColorText", cfg.primary_action);
  setPair("secondaryColor","secondaryColorText", cfg.secondary_action);
  setPair("gradA","gradAText", cfg.accent_gradient_start);
  setPair("gradB","gradBText", cfg.accent_gradient_end);

  document.getElementById("fontFamily").value = cfg.font_family;
  document.getElementById("fontSize").value = cfg.font_size;
  document.getElementById("fontSizeLabel").textContent = displayNum(cfg.font_size);
  document.getElementById("logoEmoji").value = cfg.app_logo_emoji;

  setToggleUI(document.getElementById("persianDigitsToggle"), document.getElementById("persianDigitsDot"), !!cfg.enable_persian_digits);
  setToggleUI(document.getElementById("copyPersianToggle"), document.getElementById("copyPersianDot"), !!cfg.copy_with_persian_digits);

  setToggleUI(document.getElementById("soundToggle"), document.getElementById("soundDot"), !!cfg.enable_click_sound);
  document.getElementById("soundVolume").value = clamp(Number(cfg.click_volume ?? 30),0,100);
  document.getElementById("soundVolumeLabel").textContent = displayNum(clamp(Number(cfg.click_volume ?? 30),0,100));

  document.getElementById("calcDisplayLang").value = (cfg.calculator_display_lang==="en" ? "en" : "fa");
  updateCalculatorDigitLabels(document.getElementById("calcDisplayLang").value);
};

/* ========================= INIT ========================= */
(function init(){
  const cfg=elementSdk.getConfig();
  applyConfig(cfg);
  bindNav();

  const hash=(location.hash||"").replace("#","");
  showPage(pages.includes(hash)?hash:"converter");

  // categories
  const catSel=document.getElementById("categorySel");
  CATEGORIES.forEach(c=>{
    const o=document.createElement("option");
    o.value=c.id; o.textContent=c.name;
    catSel.appendChild(o);
  });
  catSel.value = CATEGORIES[0].id;
  setUnitsForCategory(catSel.value);

  // converter events
  document.getElementById("valueInput").addEventListener("input", computeConverter);
  document.getElementById("fromUnitSel").addEventListener("change", ()=>{ state.fromLabel = document.getElementById("fromUnitSel").value; computeConverter(); });
  document.getElementById("toUnitSel").addEventListener("change", ()=>{ state.toLabel = document.getElementById("toUnitSel").value; computeConverter(); });
  document.getElementById("swapBtn").addEventListener("click", swapUnits);
  catSel.addEventListener("change", ()=>{
    state.categoryId=catSel.value;
    setUnitsForCategory(catSel.value);
    showToast("Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.", "info");
  });

  document.getElementById("precisionRange").addEventListener("input", (e)=>{
    const v=clamp(Number(e.target.value),0,8);
    document.getElementById("precisionLabel").textContent = displayNum(v);
    elementSdk.setConfig({precision:v});
  });

  document.getElementById("copyResultBtn").addEventListener("click", ()=>{
    const cfg=elementSdk.getConfig();
    const cat=getCategory(catSel.value);
    const toUnit=findUnitByLabel(cat, document.getElementById("toUnitSel").value);
    const inputVal=safeNum(document.getElementById("valueInput").value);
    const fromUnit=findUnitByLabel(cat, document.getElementById("fromUnitSel").value);
    const toVal=convertValue(cat, inputVal, fromUnit, toUnit);
    if(!Number.isFinite(toVal)){ showToast("Ú†ÛŒØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.", "warn"); return; }
    const txt = `${formatNumber(toVal, clamp(Number(cfg.precision??2),0,8))} ${toUnit.symbol}`;
    copyText(maybePersianForCopy(txt), "Ù†ØªÛŒØ¬Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
  });

  document.getElementById("uiPersianDigitsToggle").addEventListener("change", (e)=>{
    elementSdk.setConfig({enable_persian_digits: e.target.checked});
    showToast(e.target.checked ? "Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯." : "Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯.", "info");
  });

  // health live
  ["bmiWeight","bmiHeight","idealWeightToggle"].forEach(id=>document.getElementById(id).addEventListener("input", computeBMIUI));
  ["sexSel","ageInput","calHeight","calWeight","activitySel","goalSel"].forEach(id=>document.getElementById(id).addEventListener("input", computeCaloriesUI));

  document.getElementById("copyBmiBtn").addEventListener("click", ()=>{
    const cfg=elementSdk.getConfig();
    const w=safeNum(document.getElementById("bmiWeight").value);
    const h=safeNum(document.getElementById("bmiHeight").value);
    const bmi=calculateBMI(w,h);
    if(!Number.isFinite(bmi)){ showToast("Ø§Ø¨ØªØ¯Ø§ ÙˆØ²Ù† Ùˆ Ù‚Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", "warn"); return; }
    const txt = `BMI: ${formatNumber(bmi, clamp(Number(cfg.precision??2),0,8))}`;
    copyText(maybePersianForCopy(txt), "BMI Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
  });

  document.getElementById("copyGoalBtn").addEventListener("click", ()=>{
    const cfg=elementSdk.getConfig();
    const sex=document.getElementById("sexSel").value;
    const age=safeNum(document.getElementById("ageInput").value);
    const h=safeNum(document.getElementById("calHeight").value);
    const w=safeNum(document.getElementById("calWeight").value);
    const activity=safeNum(document.getElementById("activitySel").value);
    const goalAdj=safeNum(document.getElementById("goalSel").value);
    const bmr=calculateBMR(sex,w,h,age);
    const tdee=calculateTDEE(bmr,activity);
    const goal = Number.isFinite(tdee) ? tdee + (Number.isFinite(goalAdj)?goalAdj:0) : NaN;
    if(!Number.isFinite(goal)){ showToast("Ø§Ø¨ØªØ¯Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", "warn"); return; }
    const txt = `Ú©Ø§Ù„Ø±ÛŒ Ù‡Ø¯Ù: ${formatNumber(goal, clamp(Number(cfg.precision??2),0,8))} Ú©ÛŒÙ„ÙˆÚ©Ø§Ù„Ø±ÛŒ`;
    copyText(maybePersianForCopy(txt), "Ú©Ø§Ù„Ø±ÛŒ Ù‡Ø¯Ù Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
  });

  // datetime (TimeAPI.io)
  document.getElementById("timeRefreshBtn").addEventListener("click", ()=>{
    fetchTimeApi();
    showToast("Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.", "info");
  });
  document.getElementById("timeCopyBtn").addEventListener("click", ()=>{
    const j = toLatinDigits(document.getElementById("todayJalali").textContent);
    const g = toLatinDigits(document.getElementById("todayGreg").textContent);
    const ir = toLatinDigits(document.getElementById("timeIR").textContent);
    const utc = toLatinDigits(document.getElementById("timeUTC").textContent);
    const up = toLatinDigits(document.getElementById("timeUpdatedAt").textContent);
    const txt = `Ù…Ù†Ø¨Ø¹: TimeAPI.io\nØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ: ${j}\nØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ: ${g}\nØ³Ø§Ø¹Øª Ø§ÛŒØ±Ø§Ù†: ${ir}\nØ³Ø§Ø¹Øª UTC: ${utc}\nØ¢Ø®Ø±ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØªÛŒ: ${up}`;
    copyText(maybePersianForCopy(txt), "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
  });

  // calculator
  document.getElementById("calcPad").addEventListener("click", (e)=>{
    const btn=e.target.closest("[data-k]");
    if(!btn) return;
    calcPush(btn.dataset.k);
  });
  document.getElementById("calcClearBtn").addEventListener("click", calcClear);
  document.getElementById("calcCopyBtn").addEventListener("click", ()=>{
    const out = document.getElementById("calcResult").textContent;
    const raw = toLatinDigits(out);
    if(raw==="â€”"){ showToast("Ú†ÛŒØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.", "warn"); return; }
    copyText(maybePersianForCopy(raw), "Ù†ØªÛŒØ¬Ù‡ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
  });

  window.addEventListener("keydown", (e)=>{
    const onCalc = !document.getElementById("page-calculator").classList.contains("hidden");
    if(!onCalc) return;
    const key=e.key;
    if(key==="Enter"){ e.preventDefault(); calcPush("="); return; }
    if(key==="Backspace"){ calcPush("DEL"); return; }
    const allowed = "0123456789+-*/().%";
    if(allowed.includes(key)){ calcPush(key); return; }
  });

  // settings bindings
  bindColorPair(document.getElementById("bgColor"), document.getElementById("bgColorText"), "background_color");
  bindColorPair(document.getElementById("surfaceColor"), document.getElementById("surfaceColorText"), "surface_color");
  bindColorPair(document.getElementById("textColor"), document.getElementById("textColorText"), "text_color");
  bindColorPair(document.getElementById("primaryColor"), document.getElementById("primaryColorText"), "primary_action");
  bindColorPair(document.getElementById("secondaryColor"), document.getElementById("secondaryColorText"), "secondary_action");
  bindColorPair(document.getElementById("gradA"), document.getElementById("gradAText"), "accent_gradient_start");
  bindColorPair(document.getElementById("gradB"), document.getElementById("gradBText"), "accent_gradient_end");

  document.getElementById("fontFamily").addEventListener("change", (e)=>elementSdk.setConfig({font_family: e.target.value}));
  document.getElementById("fontSize").addEventListener("input", (e)=>{
    const v=clamp(Number(e.target.value),13,20);
    document.getElementById("fontSizeLabel").textContent = displayNum(v);
    elementSdk.setConfig({font_size:v});
  });

  document.getElementById("logoEmoji").addEventListener("input", (e)=>elementSdk.setConfig({app_logo_emoji:e.target.value || "ğŸ”„"}));

  document.getElementById("persianDigitsToggle").addEventListener("change", (e)=>{
    elementSdk.setConfig({enable_persian_digits: e.target.checked});
    showToast(e.target.checked ? "Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯." : "Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯.", "info");
  });

  document.getElementById("copyPersianToggle").addEventListener("change", (e)=>{
    elementSdk.setConfig({copy_with_persian_digits: e.target.checked});
    showToast(e.target.checked ? "Ú©Ù¾ÛŒ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯." : "Ú©Ù¾ÛŒ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯.", "info");
  });

  document.getElementById("soundToggle").addEventListener("change", (e)=>{
    elementSdk.setConfig({enable_click_sound: e.target.checked});
    showToast(e.target.checked ? "ØµØ¯Ø§ÛŒ Ú©Ù„ÛŒÚ© ÙØ¹Ø§Ù„ Ø´Ø¯." : "ØµØ¯Ø§ÛŒ Ú©Ù„ÛŒÚ© ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯.", "info");
    if(e.target.checked){ ensureAudio(); playClick(); }
  });

  document.getElementById("soundVolume").addEventListener("input", (e)=>{
    const v=clamp(Number(e.target.value),0,100);
    document.getElementById("soundVolumeLabel").textContent = displayNum(v);
    elementSdk.setConfig({click_volume:v});
  });

  document.getElementById("calcDisplayLang").addEventListener("change", (e)=>{
    elementSdk.setConfig({calculator_display_lang: e.target.value});
    showToast(e.target.value==="en" ? "Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨: Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ" : "Ù†Ù…Ø§ÛŒØ´Ú¯Ø± Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨: ÙØ§Ø±Ø³ÛŒ", "info");
  });

  document.getElementById("resetBtn").addEventListener("click", ()=>{
    localStorage.removeItem("proUnitConverter.config");
    elementSdk.setConfig({...defaultConfig});
    showToast("ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯.", "ok");
  });

  document.getElementById("exportConfig").addEventListener("click", ()=>{
    const cfg = elementSdk.getConfig();
    copyText(JSON.stringify(cfg, null, 2), "Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯ âœ…");
  });

  document.getElementById("importConfig").addEventListener("click", ()=>{
    const raw = prompt("Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (JSON):");
    if(!raw) return;
    try{
      const parsed = JSON.parse(raw);
      elementSdk.setConfig(parsed);
      showToast("Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯ âœ…", "ok");
    }catch{
      showToast("ÙØ±Ù…Øª JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.", "err");
    }
  });

  elementSdk.onConfigChange((newCfg)=>{
    applyConfig(newCfg);
    syncSettingsForm(newCfg);
    computeConverter();
    computeBMIUI();
    computeCaloriesUI();
    calcEvaluate();
    renderTime();
  });

  // initial renders
  syncSettingsForm(cfg);
  computeConverter();
  computeBMIUI();
  computeCaloriesUI();
  calcEvaluate();
  renderTime();

  // fetch time (TimeAPI.io)
  fetchTimeApi();
  setInterval(fetchTimeApi, 30 * 1000);

  showToast("Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Øª! âœ…", "ok");
})();
</script>
</body>
</html>
