<!doctype html>
<html lang="fa" dir="rtl" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Codeisa</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>โก</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    * { font-family: 'Vazirmatn', sans-serif; }
    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
    .glass-dark { background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
    @keyframes blink { 0%,50%{opacity:1} 51%,100%{opacity:.3} }
    .blink { animation: blink 1.5s infinite; }
    @keyframes float { 0%,100%{transform:translateY(0) translateX(0)} 25%{transform:translateY(-10px) translateX(5px)} 50%{transform:translateY(-5px) translateX(-5px)} 75%{transform:translateY(-15px) translateX(3px)} }
    .cloud { animation: float 8s ease-in-out infinite; }
    @keyframes rain-fall { 0%{transform:translateY(-100%);opacity:0} 10%{opacity:1} 90%{opacity:1} 100%{transform:translateY(400px);opacity:0} }
    .rain-drop { animation: rain-fall 1s linear infinite; }
    @keyframes snow-fall { 0%{transform:translateY(-100%) rotate(0deg);opacity:0} 10%{opacity:1} 90%{opacity:.8} 100%{transform:translateY(400px) rotate(360deg);opacity:0} }
    .snow-flake { animation: snow-fall 3s linear infinite; }
    @keyframes sun-pulse { 0%,100%{transform:scale(1);filter:drop-shadow(0 0 20px rgba(255,200,0,.5))} 50%{transform:scale(1.05);filter:drop-shadow(0 0 30px rgba(255,200,0,.7))} }
    .sun-glow { animation: sun-pulse 3s ease-in-out infinite; }
    @keyframes twinkle { 0%,100%{opacity:.3} 50%{opacity:1} }
    .star { animation: twinkle 2s ease-in-out infinite; }
    .nav-btn { transition: all .2s ease; }
    .nav-btn:active { transform: scale(.95); }
    .nav-btn.active { background: linear-gradient(135deg, rgba(99,102,241,.4), rgba(168,85,247,.4)); border-color: rgba(139,92,246,.5); }
    .calc-btn { transition: all .15s ease; }
    .calc-btn:active { transform: scale(.92); }
    input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance:none; margin:0; }
    input[type="number"] { -moz-appearance:textfield; }
    .chart-container { position: relative; height: 120px; }
    .scrollbar-hide::-webkit-scrollbar { display:none; }
    .scrollbar-hide { -ms-overflow-style:none; scrollbar-width:none; }
    @keyframes gradient-shift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .animated-gradient { background-size: 200% 200%; animation: gradient-shift 15s ease infinite; }
    .pill { transition: all .2s ease; }
    .pill.active { background: linear-gradient(135deg, rgba(99,102,241,.5), rgba(168,85,247,.5)); border-color: rgba(139,92,246,.55); }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>

<body class="h-full bg-gradient-to-br from-slate-900 via-purple-950 to-slate-900 animated-gradient text-white overflow-auto text-[15px] md:text-[16px] lg:text-[17px]">
<div id="app" class="min-h-full w-full">

  <!-- Header -->
  <header class="glass-dark sticky top-0 z-50 px-4 py-3">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-xl font-bold shadow-lg shadow-purple-500/30">โก</div>
        <h1 id="site-title" class="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">Codeisa</h1>
      </div>
      <!-- ุชุบุฑ: ุงูุฒูุฏู ูุชู ูุงุฒููุฏ VPN -->
      <div id="online-status" class="flex items-center gap-2 text-xs">
        <span class="w-2 h-2 rounded-full bg-green-500 blink"></span>
        <span class="text-green-400">ุขููุงู</span>
        
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="px-4 py-3 overflow-x-auto scrollbar-hide">
    <div class="max-w-5xl mx-auto flex gap-2 min-w-max">
      <button onclick="showSection('crypto')" class="nav-btn active glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="crypto">๐ฐ ุงุฑุฒ ุฏุฌุชุงู</button>
      <button onclick="showSection('weather')" class="nav-btn glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="weather">๐ค๏ธ ุขุจ ู ููุง</button>
      <button onclick="showSection('datetime')" class="nav-btn glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="datetime">๐ ุชุงุฑุฎ ู ุณุงุนุช</button>
      <button onclick="showSection('converter')" class="nav-btn glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="converter">๐ ุชุจุฏู ูุงุญุฏ</button>
      <button onclick="showSection('calculator')" class="nav-btn glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="calculator">๐งฎ ูุงุดูโุญุณุงุจ</button>
      <button onclick="showSection('health')" class="nav-btn glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="health">โค๏ธ ุณูุงูุช</button>
      <button onclick="showSection('guide')" class="nav-btn glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-section="guide">๐ ุฑุงูููุง</button>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="px-4 pb-8">
    <div class="max-w-5xl mx-auto">

      <!-- Crypto Section -->
      <section id="crypto-section" class="space-y-4">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold">ููุช ุงุฑุฒูุง ุฏุฌุชุงู</h2>
          <div id="crypto-status" class="flex items-center gap-2 text-xs">
            <span class="status-dot w-2 h-2 rounded-full bg-yellow-500 blink"></span>
            <span class="status-text text-yellow-400">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</span>
          </div>
        </div>
        <div id="crypto-cards" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        <div class="text-xs text-gray-400">ููุจุน ููุช: ููุจุชฺฉุณ (ุชูุฑุจ/ููุงุด ุจุฑุง ูููุฏุงุฑ ฒด ุณุงุนุชู)</div>
      </section>

      <!-- Weather Section -->
      <section id="weather-section" class="hidden space-y-4">
        <div class="flex flex-col gap-3 mb-4">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
            <div class="flex items-center gap-2"><h2 class="text-lg font-bold">ุขุจ ู ููุง</h2><span class="text-xs px-2 py-1 rounded-lg bg-white/10 border border-white/10 text-amber-200">ูุงุฒููุฏ VPN</span></div>
            <!-- ุชุบุฑ: ุงูุฒูุฏู ุฌุณุชุฌู ุดูุฑูุง ุงุฑุงู (ุจุง ุฌุณุชุฌู ุขููุงู) -->
            <div class="flex gap-2 w-full sm:w-auto">
              <div class="glass px-3 py-2 rounded-xl text-sm bg-transparent outline-none w-full sm:w-80 flex items-center gap-2">
                <span class="text-gray-300">๐</span>
                <input id="city-search" class="bg-transparent outline-none w-full" placeholder="ูุงู ุดูุฑ ุฑุง ุฌุณุชุฌู ฺฉูุฏ (ุชูุงู ุดูุฑูุง ุงุฑุงู)..." oninput="searchIranCities()">
              </div>
            </div>
          </div>
          <div id="city-results" class="hidden glass rounded-2xl p-3 text-sm">
            <div class="text-gray-300 mb-2">ูุชุงุฌ:</div>
            <div id="city-results-list" class="space-y-2"></div>
          </div>
        </div>

        <div id="weather-card" class="glass rounded-2xl p-6 relative overflow-hidden min-h-[320px]">
          <div id="weather-animation" class="absolute inset-0 pointer-events-none"></div>
          <div id="weather-content" class="relative z-10">
            <div class="text-center text-gray-400">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</div>
          </div>
        </div>
      </section>

      <!-- DateTime Section -->
      <section id="datetime-section" class="hidden space-y-4">
        <h2 class="text-lg font-bold mb-4">ุชุงุฑุฎ ู ุณุงุนุช</h2>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="glass rounded-2xl p-4 text-center">
            <div class="text-xs text-gray-400 mb-1">ุณุงุนุช ุงุฑุงู</div>
            <div id="iran-time" class="text-3xl font-bold tabular-nums">--:--:--</div>
            <div id="iran-date" class="text-sm text-gray-400 mt-1"></div>
          </div>
          <div class="glass rounded-2xl p-4 text-center">
            <div class="text-xs text-gray-400 mb-1">ุณุงุนุช ุฌูุงู (UTC)</div>
            <div id="utc-time" class="text-3xl font-bold tabular-nums">--:--:--</div>
            <div id="utc-date" class="text-sm text-gray-400 mt-1"></div>
          </div>
          <div class="glass rounded-2xl p-4 flex flex-col items-center justify-center">
            <div class="text-xs text-gray-400 mb-2">ุณุงุนุช ุขูุงููฺฏ</div>
            <svg id="analog-clock" width="100" height="100" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2" />
              <circle cx="50" cy="50" r="3" fill="white" />
              <g stroke="rgba(255,255,255,0.5)" stroke-width="2">
                <line x1="50" y1="10" x2="50" y2="15" />
                <line x1="90" y1="50" x2="85" y2="50" />
                <line x1="50" y1="90" x2="50" y2="85" />
                <line x1="10" y1="50" x2="15" y2="50" />
              </g>
              <line id="hour-hand" x1="50" y1="50" x2="50" y2="28" stroke="white" stroke-width="3" stroke-linecap="round" />
              <line id="minute-hand" x1="50" y1="50" x2="50" y2="18" stroke="white" stroke-width="2" stroke-linecap="round" />
              <line id="second-hand" x1="50" y1="50" x2="50" y2="15" stroke="#a855f7" stroke-width="1" stroke-linecap="round" />
            </svg>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="glass rounded-2xl p-4 text-center">
            <div class="text-xs text-gray-400 mb-1">ุชุงุฑุฎ ูุฌุฑ ููุฑ</div>
            <div id="hijri-date" class="text-xl font-bold">--</div>
          </div>
          <div class="glass rounded-2xl p-4 text-center">
            <div class="text-xs text-gray-400 mb-1">ุชุงุฑุฎ ููุงุฏ</div>
            <div id="gregorian-date" class="text-xl font-bold">--</div>
          </div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between mb-4">
            <button onclick="changeMonth(-1)" class="p-2 hover:bg-white/10 rounded-lg transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
            <div id="calendar-title" class="font-bold"></div>
            <button onclick="changeMonth(1)" class="p-2 hover:bg-white/10 rounded-lg transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
          </div>
          <div class="grid grid-cols-7 gap-1 text-center text-xs mb-2">
            <div class="text-gray-400 py-1">ุด</div><div class="text-gray-400 py-1"></div><div class="text-gray-400 py-1">ุฏ</div>
            <div class="text-gray-400 py-1">ุณ</div><div class="text-gray-400 py-1">ฺ</div><div class="text-gray-400 py-1">ูพ</div>
            <div class="text-red-400 py-1">ุฌ</div>
          </div>
          <div id="calendar-days" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="text-sm font-bold mb-2">ููุงุณุจุชโูุง ุงูุฑูุฒ</div>
          <div id="today-events" class="text-sm text-gray-300">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="text-sm font-bold mb-4">ุชุจุฏู ุชุงุฑุฎ</div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุดูุณ</label>
              <div class="flex gap-1">
                <input type="number" id="jalali-year" placeholder="ุณุงู" class="glass w-full px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1300" max="1500">
                <input type="number" id="jalali-month" placeholder="ูุงู" class="glass w-16 px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1" max="12">
                <input type="number" id="jalali-day" placeholder="ุฑูุฒ" class="glass w-16 px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1" max="31">
              </div>
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ููุงุฏ</label>
              <div class="flex gap-1">
                <input type="number" id="gregorian-year" placeholder="ุณุงู" class="glass w-full px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1900" max="2100">
                <input type="number" id="gregorian-month" placeholder="ูุงู" class="glass w-16 px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1" max="12">
                <input type="number" id="gregorian-day" placeholder="ุฑูุฒ" class="glass w-16 px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1" max="31">
              </div>
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฌุฑ ููุฑ</label>
              <div class="flex gap-1">
                <input type="number" id="hijri-year" placeholder="ุณุงู" class="glass w-full px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1400" max="1600">
                <input type="number" id="hijri-month" placeholder="ูุงู" class="glass w-16 px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1" max="12">
                <input type="number" id="hijri-day" placeholder="ุฑูุฒ" class="glass w-16 px-2 py-2 rounded-lg text-sm bg-transparent outline-none text-center" min="1" max="30">
              </div>
            </div>
          </div>
          <div class="flex gap-2 flex-wrap">
            <button onclick="convertFromJalali()" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium">ุงุฒ ุดูุณ</button>
            <button onclick="convertFromGregorian()" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium">ุงุฒ ููุงุฏ</button>
            <button onclick="convertFromHijri()" class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium">ุงุฒ ููุฑ</button>
          </div>
        </div>
      </section>

      <!-- Unit Converter Section -->
      <section id="converter-section" class="hidden space-y-4">
        <h2 class="text-lg font-bold mb-4">ุชุจุฏู ูุงุญุฏ</h2>

        <!-- ุชุบุฑ: ุงูุฒุงุด ุจู ฑฒ ุฏุณุชู -->
        <div class="glass rounded-2xl p-3 overflow-x-auto scrollbar-hide">
          <div class="flex gap-2 min-w-max" id="converter-types">
            <!-- buttons injected -->
          </div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุงุฒ</label>
              
              <div class="relative">
                <button type="button" id="from-unit-btn" onclick="toggleUnitMenu('from-unit')" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer flex items-center justify-between">
                  <span id="from-unit-label">ุงูุชุฎุงุจ ูุงุญุฏ</span>
                  <span class="text-gray-300">โพ</span>
                </button>
                <div id="from-unit-menu" class="hidden absolute z-20 mt-2 w-full max-h-56 overflow-auto scrollbar-hide glass-dark rounded-xl p-2">
                  <!-- options injected -->
                </div>
                <input type="hidden" id="from-unit-value" value="">
              </div>
    
              <input type="number" id="from-value" oninput="convertUnit()" placeholder="ููุฏุงุฑ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุจู</label>
              
              <div class="relative">
                <button type="button" id="to-unit-btn" onclick="toggleUnitMenu('to-unit')" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer flex items-center justify-between">
                  <span id="to-unit-label">ุงูุชุฎุงุจ ูุงุญุฏ</span>
                  <span class="text-gray-300">โพ</span>
                </button>
                <div id="to-unit-menu" class="hidden absolute z-20 mt-2 w-full max-h-56 overflow-auto scrollbar-hide glass-dark rounded-xl p-2">
                  <!-- options injected -->
                </div>
                <input type="hidden" id="to-unit-value" value="">
              </div>
    
              <div id="to-value" class="glass w-full px-3 py-2 rounded-xl text-sm bg-white/5 min-h-[40px] flex items-center">-</div>
            </div>
          </div>
          <div class="text-xs text-gray-400">ูฺฉุชู: ุจุฑุง ุชุจุฏูโูุง ูููุฏุณ ุฏููุ ุงุฒ ูุงุญุฏูุง ููโุฎุงููุงุฏู ุงุณุชูุงุฏู ฺฉูุฏ.</div>
        </div>
      </section>

      <!-- Calculator Section -->
      <section id="calculator-section" class="hidden">
        <h2 class="text-lg font-bold mb-4">ูุงุดูโุญุณุงุจ</h2>

        <!-- ุชุบุฑ: ุฏู ุญุงูุช ุณุงุฏู ู ูููุฏุณ -->
        <div class="glass rounded-2xl p-4 max-w-md mx-auto">
          <div class="flex gap-2 mb-3">
            <button id="mode-simple" onclick="setCalcMode('simple')" class="pill active glass px-4 py-2 rounded-xl text-sm font-medium flex-1">ุณุงุฏู</button>
            <button id="mode-sci" onclick="setCalcMode('sci')" class="pill glass px-4 py-2 rounded-xl text-sm font-medium flex-1">ูููุฏุณ</button>
          </div>

          <div id="calc-display" class="glass-dark rounded-xl p-4 mb-4 text-left" dir="ltr">
            <div id="calc-expression" class="text-gray-400 text-sm h-5 overflow-hidden"></div>
            <div id="calc-result" class="text-3xl font-bold tabular-nums overflow-x-auto scrollbar-hide">0</div>
          </div>

          <!-- Scientific row -->
          <div id="sci-pad" class="hidden grid grid-cols-4 gap-2 mb-2">
            <button onclick="calcFunc('sin')" class="calc-btn glass hover:bg-white/20 p-3 rounded-xl text-sm font-bold">sin</button>
            <button onclick="calcFunc('cos')" class="calc-btn glass hover:bg-white/20 p-3 rounded-xl text-sm font-bold">cos</button>
            <button onclick="calcFunc('tan')" class="calc-btn glass hover:bg-white/20 p-3 rounded-xl text-sm font-bold">tan</button>
            <button onclick="calcConst('pi')" class="calc-btn glass hover:bg-white/20 p-3 rounded-xl text-sm font-bold">ฯ</button>

            <button onclick="calcFunc('sqrt')" class="calc-btn glass hover:bg-white/20 p-3 rounded-xl text-sm font-bold">โ</button>
            <button onclick="calcFunc('ln')" class="calc-btn glass hover:bg-white/20 p-3 rounded-xl text-sm font-bold">ln</button>
            <button onclick="calcFunc('log')" class="calc-btn glass hover:bgwhite/20 p-3 rounded-xl text-sm font-bold">log</button>
            <button onclick="calcPow()" class="calc-btn bg-purple-500/30 hover:bg-purple-500/50 p-3 rounded-xl text-sm font-bold">^</button>
          </div>

          <div class="grid grid-cols-4 gap-2">
            <button onclick="calcClear()" class="calc-btn bg-red-500/30 hover:bg-red-500/50 p-4 rounded-xl text-lg font-bold">C</button>
            <button onclick="calcBackspace()" class="calc-btn bg-orange-500/30 hover:bg-orange-500/50 p-4 rounded-xl text-lg font-bold">โซ</button>
            <button onclick="calcPercent()" class="calc-btn bg-purple-500/30 hover:bg-purple-500/50 p-4 rounded-xl text-lg font-bold">%</button>
            <button onclick="calcOp('/')" class="calc-btn bg-indigo-500/30 hover:bg-indigo-500/50 p-4 rounded-xl text-lg font-bold">รท</button>

            <button onclick="calcNum('7')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ท</button>
            <button onclick="calcNum('8')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ธ</button>
            <button onclick="calcNum('9')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">น</button>
            <button onclick="calcOp('*')" class="calc-btn bg-indigo-500/30 hover:bg-indigo-500/50 p-4 rounded-xl text-lg font-bold">ร</button>

            <button onclick="calcNum('4')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ด</button>
            <button onclick="calcNum('5')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ต</button>
            <button onclick="calcNum('6')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ถ</button>
            <button onclick="calcOp('-')" class="calc-btn bg-indigo-500/30 hover:bg-indigo-500/50 p-4 rounded-xl text-lg font-bold">โ</button>

            <button onclick="calcNum('1')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ฑ</button>
            <button onclick="calcNum('2')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ฒ</button>
            <button onclick="calcNum('3')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">ณ</button>
            <button onclick="calcOp('+')" class="calc-btn bg-indigo-500/30 hover:bg-indigo-500/50 p-4 rounded-xl text-lg font-bold">+</button>

            <button onclick="calcNum('0')" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold col-span-2">ฐ</button>
            <button onclick="calcDot()" class="calc-btn glass hover:bg-white/20 p-4 rounded-xl text-lg font-bold">.</button>
            <button onclick="calcEquals()" class="calc-btn bg-gradient-to-r from-indigo-600 to-purple-600 p-4 rounded-xl text-lg font-bold">=</button>
          </div>
        </div>
      </section>

      <!-- Health Section -->
      <section id="health-section" class="hidden space-y-4">
        <h2 class="text-lg font-bold mb-4">ูุญุงุณุจุงุช ุณูุงูุช</h2>

        <!-- BMI -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐</span>
            <div>
              <div class="font-bold">ุดุงุฎุต ุชูุฏู ุจุฏู (BMI)</div>
              <div class="text-xs text-gray-400">Body Mass Index</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฏ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="bmi-height" placeholder="ฑทต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฒู (ฺฉููฺฏุฑู)</label>
              <input type="number" id="bmi-weight" placeholder="ทฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
          </div>
          <button onclick="calculateBMI()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="bmi-result" class="text-center hidden">
            <div class="text-3xl font-bold" id="bmi-value">-</div>
            <div class="text-sm text-gray-400" id="bmi-status">-</div>
            <div class="mt-2 h-2 rounded-full bg-gradient-to-r from-blue-500 via-green-500 via-yellow-500 to-red-500 relative">
              <div id="bmi-marker" class="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-lg transition-all" style="right: 50%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-400 mt-1"><span>ูุงุบุฑ</span><span>ูุฑูุงู</span><span>ุงุถุงูู</span><span>ฺุงู</span></div>
          </div>
        </div>

        <!-- BMR -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐ฅ</span>
            <div>
              <div class="font-bold">ูุชุงุจููุณู ูพุงู (BMR)</div>
              <div class="text-xs text-gray-400">Basal Metabolic Rate</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุฌูุณุช</label>
              <select id="bmr-gender" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer">
                <option value="male">ูุฑุฏ</option>
                <option value="female">ุฒู</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุณู (ุณุงู)</label>
              <input type="number" id="bmr-age" placeholder="ณฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฏ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="bmr-height" placeholder="ฑทต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฒู (ฺฉููฺฏุฑู)</label>
              <input type="number" id="bmr-weight" placeholder="ทฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
          </div>
          <button onclick="calculateBMR()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="bmr-result" class="text-center hidden">
            <div class="text-3xl font-bold" id="bmr-value">-</div>
            <div class="text-sm text-gray-400">ฺฉุงูุฑ ุฏุฑ ุฑูุฒ (ุฏุฑ ุญุงูุช ุงุณุชุฑุงุญุช)</div>
          </div>
        </div>

        <!-- Daily Calories -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐</span>
            <div>
              <div class="font-bold">ูุงุฒ ฺฉุงูุฑ ุฑูุฒุงูู</div>
              <div class="text-xs text-gray-400">Total Daily Energy Expenditure</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุฌูุณุช</label>
              <select id="tdee-gender" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer">
                <option value="male">ูุฑุฏ</option>
                <option value="female">ุฒู</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุณู (ุณุงู)</label>
              <input type="number" id="tdee-age" placeholder="ณฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฏ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="tdee-height" placeholder="ฑทต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฒู (ฺฉููฺฏุฑู)</label>
              <input type="number" id="tdee-weight" placeholder="ทฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
          </div>
          <div class="mb-4">
            <label class="text-xs text-gray-400 block mb-1">ุณุทุญ ูุนุงูุช</label>
            <select id="tdee-activity" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer">
              <option value="1.2">ฺฉูโุชุญุฑฺฉ (ุจุฏูู ูุฑุฒุด)</option>
              <option value="1.375">ฺฉู ูุนุงู (ฑ-ณ ุฑูุฒ ูุฑุฒุด)</option>
              <option value="1.55">ูุชูุณุท (ณ-ต ุฑูุฒ ูุฑุฒุด)</option>
              <option value="1.725">ูุนุงู (ถ-ท ุฑูุฒ ูุฑุฒุด)</option>
              <option value="1.9">ุจุณุงุฑ ูุนุงู (ูุฑุฒุดฺฉุงุฑ ุญุฑููโุง)</option>
            </select>
          </div>
          <button onclick="calculateTDEE()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="tdee-result" class="hidden">
            <div class="text-center mb-4">
              <div class="text-3xl font-bold" id="tdee-value">-</div>
              <div class="text-sm text-gray-400">ฺฉุงูุฑ ุฏุฑ ุฑูุฒ (ุญูุธ ูุฒู)</div>
            </div>
            <div class="grid grid-cols-2 gap-3 text-sm">
              <div class="glass-dark rounded-xl p-3 text-center">
                <div class="text-green-400 font-bold" id="tdee-lose">-</div>
                <div class="text-xs text-gray-400">ฺฉุงูุด ูุฒู</div>
              </div>
              <div class="glass-dark rounded-xl p-3 text-center">
                <div class="text-blue-400 font-bold" id="tdee-gain">-</div>
                <div class="text-xs text-gray-400">ุงูุฒุงุด ูุฒู</div>
              </div>
            </div>
          </div>
        </div>


        <!-- ุงูฺฉุงูุงุช ุฌุฏุฏ ุณูุงูุช -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐ง</span>
            <div>
              <div class="font-bold">ูุญุงุณุจู ุขุจ ููุฑุฏ ูุงุฒ ุฑูุฒุงูู</div>
              <div class="text-xs text-gray-400">ุจุฑ ุงุณุงุณ ูุฒู ู ุณุทุญ ูุนุงูุช (ุชูุฑุจ)</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฒู (ฺฉููฺฏุฑู)</label>
              <input type="number" id="water-weight" placeholder="ทฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุนุงูุช ุฑูุฒุงูู</label>
              <select id="water-activity" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer">
                <option value="low">ฺฉูโุชุญุฑฺฉ</option>
                <option value="mid">ูุชูุณุท</option>
                <option value="high">ุฒุงุฏ</option>
              </select>
            </div>
          </div>
          <button onclick="calculateWater()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="water-result" class="glass-dark rounded-xl p-3 text-sm text-gray-200 hidden"></div>
          <div class="text-xs text-gray-500 mt-2">โ๏ธ ุฏุฑ ุจูุงุฑโูุง ฺฉูู/ููุจ ุง ุจุงุฑุฏุงุฑุ ููุฏุงุฑ ุขุจ ุจุงุฏ ุจุง ูุธุฑ ูพุฒุดฺฉ ุชูุธู ุดูุฏ.</div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐</span>
            <div>
              <div class="font-bold">ูุณุจุช ุฏูุฑ ฺฉูุฑ ุจู ูุฏ (WHtR)</div>
              <div class="text-xs text-gray-400">ุดุงุฎุต ุณุงุฏู ุจุฑุง ุฑุณฺฉ ูุชุงุจููฺฉ (ุชูุฑุจ)</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฏ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="whr-height" placeholder="ฑทต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุฏูุฑ ฺฉูุฑ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="whr-waist" placeholder="ธต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
          </div>
          <button onclick="calculateWHtR()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="whr-result" class="glass-dark rounded-xl p-3 text-sm text-gray-200 hidden"></div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐๏ธ</span>
            <div>
              <div class="font-bold">ุฏุฑุตุฏ ฺุฑุจ ุจุฏู (US Navy)</div>
              <div class="text-xs text-gray-400">ุจุฑ ุงุณุงุณ ุงูุฏุงุฒูโฺฏุฑ ุฏูุฑ ฺฏุฑุฏู/ฺฉูุฑ/ูุฏ (ุชูุฑุจ)</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุฌูุณุช</label>
              <select id="bf-gender" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none cursor-pointer">
                <option value="male">ูุฑุฏ</option>
                <option value="female">ุฒู</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุฏ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="bf-height" placeholder="ฑทต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุฏูุฑ ฺฏุฑุฏู (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="bf-neck" placeholder="ณธ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุฏูุฑ ฺฉูุฑ (ุณุงูุชโูุชุฑ)</label>
              <input type="number" id="bf-waist" placeholder="ธต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div id="bf-hip-wrap" class="hidden col-span-2">
              <label class="text-xs text-gray-400 block mb-1">ุฏูุฑ ุจุงุณู (ุณุงูุชโูุชุฑ) (ุจุฑุง ุฎุงููโูุง)</label>
              <input type="number" id="bf-hip" placeholder="นต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
          </div>
          <button onclick="calculateBodyFat()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="bf-result" class="glass-dark rounded-xl p-3 text-sm text-gray-200 hidden"></div>
          <div class="text-xs text-gray-500 mt-2">ุฑุงูููุง: ุงูุฏุงุฒูโูุง ุฑุง ุฏุฑ ุญุงูุช ุงุณุชุงุฏู ู ุจุฏูู ูุดุงุฑ ุฒุงุฏ ูุชุฑ ุซุจุช ฺฉูุฏ.</div>
        </div>

        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">โค๏ธโ๐ฅ</span>
            <div>
              <div class="font-bold">ุฒููโูุง ุถุฑุจุงู ููุจ ุชูุฑู</div>
              <div class="text-xs text-gray-400">ุจุฑ ุงุณุงุณ ุณู (ุชูุฑุจ)</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุณู (ุณุงู)</label>
              <input type="number" id="hr-age" placeholder="ณฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">HR Rest (ุงุฎุชุงุฑ)</label>
              <input type="number" id="hr-rest" placeholder="ถต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
          </div>
          <button onclick="calculateHRZones()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ูุญุงุณุจู</button>
          <div id="hr-result" class="glass-dark rounded-xl p-3 text-sm text-gray-200 hidden"></div>
        </div>

        <!-- ุชุบุฑ: ุชูุณุฑ ุขุฒูุงุด ู ุฑุงูููุง -->
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-4"><span class="text-2xl">๐งช</span>
            <div>
              <div class="font-bold">ุชูุณุฑ ุขุฒูุงุด ู ุฑุงูููุง</div>
              <div class="text-xs text-gray-400">ูุฑูุฏ ููุงุฏุฑ ุฑุงุฌ ุจุฑุง ุฏุฑุงูุช ุชูุถุญ ฺฉู</div>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="text-xs text-gray-400 block mb-1">ููุฏ ูุงุดุชุง (FBS) mg/dL</label>
              <input type="number" id="lab-fbs" placeholder="นฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ฺฉูุณุชุฑูู ฺฉู (TC) mg/dL</label>
              <input type="number" id="lab-tc" placeholder="ฑธฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ุชุฑโฺฏูุณุฑุฏ (TG) mg/dL</label>
              <input type="number" id="lab-tg" placeholder="ฑฒฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">HDL mg/dL</label>
              <input type="number" id="lab-hdl" placeholder="ดต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">LDL mg/dL</label>
              <input type="number" id="lab-ldl" placeholder="ฑฐฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุดุงุฑ ุฎูู (Sys/Dia)</label>
              <div class="flex gap-2">
                <input type="number" id="lab-sys" placeholder="ฑฒฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none text-center">
                <input type="number" id="lab-dia" placeholder="ธฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none text-center">
              
            <div>
              <label class="text-xs text-gray-400 block mb-1">HbA1c (%)</label>
              <input type="number" id="lab-a1c" placeholder="ต.ด" step="0.1" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ฺฉุฑุงุชูู (Cr) mg/dL</label>
              <input type="number" id="lab-cr" placeholder="ฑ.ฐ" step="0.01" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ALT (IU/L)</label>
              <input type="number" id="lab-alt" placeholder="ฒต" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">AST (IU/L)</label>
              <input type="number" id="lab-ast" placeholder="ฒฒ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">TSH (ยตIU/mL)</label>
              <input type="number" id="lab-tsh" placeholder="ฒ.ฐ" step="0.01" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>
            <div>
              <label class="text-xs text-gray-400 block mb-1">ูุชุงูู D (ng/mL)</label>
              <input type="number" id="lab-vitd" placeholder="ณฐ" class="glass w-full px-3 py-2 rounded-xl text-sm bg-transparent outline-none">
            </div>

</div>
            </div>
          </div>

          <button onclick="interpretLabs()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 px-4 py-2 rounded-xl text-sm font-medium mb-3">ุชูุณุฑ</button>
          <div id="lab-result" class="glass-dark rounded-xl p-3 text-sm text-gray-200 hidden leading-relaxed"></div>
          <div class="text-xs text-gray-500 mt-2">โ๏ธ ุงู ุชูุณุฑ ุนููู ุงุณุช ู ุฌุงฺฏุฒู ูุธุฑ ูพุฒุดฺฉ ูุณุช.</div>
        </div>
      </section>

      <!-- Guide Section (unchanged) -->
      <section id="guide-section" class="hidden space-y-4">
        <h2 class="text-lg font-bold mb-4">ุฑุงูููุง</h2>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-3"><span class="text-xl">๐ฐ</span><div class="font-bold">ุงุฑุฒ ุฏุฌุชุงู</div></div>
          <p class="text-sm text-gray-300 leading-relaxed">ููุช ูุญุธูโุง ุงุฒ ููุจุชฺฉุณ (BTC/ETH/USDT/TON/TRX/PAXG) ุจู ุชููุงู. ููุงุด ุชุบุฑุงุช ฒดุณุงุนุชู ู ุฌุฒุฆุงุช.</p>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-3"><span class="text-xl">๐ค๏ธ</span><div class="font-bold">ุขุจ ู ููุง</div></div>
          <p class="text-sm text-gray-300 leading-relaxed">ุจุง ุฌุณุชุฌู ูโุชูุงูุฏ ูุฑ ุดูุฑ ุงุฑุงู ุฑุง ูพุฏุง ฺฉูุฏ ู ุงุทูุงุนุงุช ฺฉุงููโุชุฑ (ุจุงุฏุ ุฑุทูุจุชุ ูุดุงุฑุ ุฏุฏุ ุทููุน/ุบุฑูุจุ ุญุฏุงูู/ุญุฏุงฺฉุซุฑ ุฑูุฒ) ุจุจูุฏ.</p>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-3"><span class="text-xl">๐</span><div class="font-bold">ุชุงุฑุฎ ู ุณุงุนุช</div></div>
          <p class="text-sm text-gray-300 leading-relaxed">ุณุงุนุช ุฏูู ุงุฑุงู ู ุฌูุงูุ ุชููู ุดูุณุ ุชุงุฑุฎ ููุงุฏ ู ูุฌุฑ ููุฑ (ุงุตูุงุญ ุดุฏู) ู ููุงุณุจุชโูุง ุฑูุฒ. ุชุจุฏู ุชุงุฑุฎ ุจู ุณู ุชููู.</p>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-3"><span class="text-xl">๐</span><div class="font-bold">ุชุจุฏู ูุงุญุฏ</div></div>
          <p class="text-sm text-gray-300 leading-relaxed">ฑฒ ุฏุณุชู ุชุจุฏู: ุทููุ ูุฒูุ ุฏูุงุ ุญุฌูุ ุณุฑุนุชุ ุฒูุงูุ ูุดุงุฑุ ุงูุฑฺุ ุชูุงูุ ูุณุงุญุชุ ุฏุงุฏู ุฏุฌุชุงูุ ุฒุงูู.</p>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-3"><span class="text-xl">๐งฎ</span><div class="font-bold">ูุงุดูโุญุณุงุจ</div></div>
          <p class="text-sm text-gray-300 leading-relaxed">ูุงุดูโุญุณุงุจ ุณุงุฏู ู ูููุฏุณ (sin/cos/tan/log/ln/โ/^/ฯ).</p>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-2 mb-3"><span class="text-xl">โค๏ธ</span><div class="font-bold">ุณูุงูุช</div></div>
          <p class="text-sm text-gray-300 leading-relaxed">BMIุ BMRุ ูุงุฒ ฺฉุงูุฑ ู ููฺูู ุชูุณุฑ ุนููู ุขุฒูุงุดโูุง ุฑุงุฌ ู ุฑุงูููุง.</p>
        </div>
        <div class="glass rounded-2xl p-4 border-indigo-500/30">
          <div class="text-center text-sm text-gray-400">
            <div class="text-2xl mb-2">โก</div>
            <div>Codeisa - ุงุจุฒุงุฑูุง ฺฉุงุฑุจุฑุฏ ูุงุฑุณ</div>
            <div class="text-xs mt-1">ุณุงุฎุชู ุดุฏู ุจุง โค๏ธ</div>
          </div>
        </div>
      </section>

    </div>
  </main>
</div>

<script>
  // Persian number converter
  function toPersianNum(num) {
    const persianDigits = ['ฐ','ฑ','ฒ','ณ','ด','ต','ถ','ท','ธ','น'];
    return String(num).replace(/[0-9]/g, d => persianDigits[parseInt(d)]);
  }
  function toEnglishNum(str) {
    const persianDigits = ['ฐ','ฑ','ฒ','ณ','ด','ต','ถ','ท','ธ','น'];
    return String(str).replace(/[ฐ-น]/g, d => persianDigits.indexOf(d));
  }
  function formatNumber(num, decimals = 0) {
    if (num === null || num === undefined || isNaN(num)) return '-';
    return toPersianNum(Number(num).toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals }));
  }

  // Section navigation
  function showSection(section) {
    document.querySelectorAll('main > div > section').forEach(s => s.classList.add('hidden'));
    document.getElementById(`${section}-section`).classList.remove('hidden');

    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.classList.remove('active');
      if (btn.dataset.section === section) btn.classList.add('active');
    });

    if (section === 'weather') {
      if (!selectedCity) {
        // default: Tehran
        setSelectedCity({ name: 'ุชูุฑุงู', province: 'ุชูุฑุงู', lat: 35.6892, lon: 51.3890 });
      } else {
        loadWeather();
      }
    }
    if (section === 'datetime') {
      updateDateTime();
      renderCalendar();
      fetchEvents();
    }
    if (section === 'converter') {
      initConverterTypes();
      setConverterType('length');
    }
  }

  // ===================== CRYPTO (Nobitex - robust) =====================
  // ูฺฉุชู: ููุจุชฺฉุณ ูุนูููุงู ููุช ุฑุง ุจู ุฑุงู (RLS) ุจุฑูโฺฏุฑุฏุงูุฏ. ุจุฑุง ููุงุด ุชููุงูุ ุชูุณู ุจุฑ ฑฐ ูโฺฉูู.
  // ูุดฺฉู ุฑุงุฌู ยซููุชโูุง ููุงุด ุฏุงุฏู ููโุดูุฏยป ูุนูููุงู ุจู ุฎุงุทุฑ ุชุบุฑ ุฏุงููู API (apiv2) ุง ุชูุงูุช ููุฏูุงุณุช.
  const NOBITEX_STATS_URLS = [
    'https://apiv2.nobitex.ir/market/stats',   // ุฌุฏุฏุชุฑ/ูพุงุฏุงุฑุชุฑ
    'https://api.nobitex.ir/market/stats'      // ูุฏูโุชุฑ (fallback)
  ];

  const cryptoList = [
    { key:'btc', symbol:'BTC', name:'ุจุชโฺฉูู' },
    { key:'eth', symbol:'ETH', name:'ุงุชุฑูู' },
    { key:'usdt', symbol:'USDT', name:'ุชุชุฑ' },
    { key:'ton', symbol:'TON', name:'ุชููโฺฉูู' },
    { key:'trx', symbol:'TRX', name:'ุชุฑูู' },
    { key:'paxg', symbol:'PAXG', name:'ุทูุง ุฏุฌุชุงู' }
  ];

  function synthChartFromStats(last, low, high) {
    // 24 points: smooth curve between low->high->last (ููุงุด)
    const points = [];
    const a = low, b = high, c = last;
    for (let i=0;i<24;i++){
      const t = i/23;
      const wave = Math.sin(t*Math.PI)*0.15;
      const base = a + (b-a)*t;
      const towardLast = base*(1-t) + c*t;
      points.push(towardLast*(1+wave*(Math.random()*0.5+0.5)));
    }
    return points;
  }

  async function fetchNobitexStats() {
    for (const url of NOBITEX_STATS_URLS) {
      try {
        const res = await fetch(url);
        if (!res.ok) continue;
        const j = await res.json();

        // apiv2: {status:"ok", stats:{...}}
        if (j && j.stats) return j.stats;

        // ุจุนุถ ูพุงุฏูโุณุงุฒโูุง: {data:{stats:{...}}}
        if (j && j.data && j.data.stats) return j.data.stats;

        // ูุณุฎู ูุฏู ูพุงุฑุงูุชุฑ (ุงฺฏุฑ ููุท ููู ฺฉุงุฑ ฺฉุฑุฏ)
        // ุฏุฑ ุงู ุญุงูุชุ loadCrypto ุจู ุงุฒุง ูุฑ ฺฉูู ุฌุฏุงฺฏุงูู ุฏุฑุฎูุงุณุช ูโุฏูุฏ.
      } catch (_) {}
    }
    return null;
  }

  function pickPair(stats, key) {
    // ุชูุงุด ุจุฑุง ูพุฏุง ฺฉุฑุฏู ุฌูุช ุงุฑุฒูุง ุฑุงุฌ
    const candidates = [
      `${key}-rls`,
      `${key}-irt`,
      `${key.toUpperCase()}-rls`,
      `${key.toUpperCase()}-irt`
    ];
    for (const c of candidates) {
      if (stats && stats[c]) return stats[c];
    }
    return null;
  }

  function parseNum(x) {
    const n = typeof x === 'string' ? parseFloat(x) : (typeof x === 'number' ? x : NaN);
    return Number.isFinite(n) ? n : NaN;
  }

  function computeChangePercent(s) {
    // ุงูููุช: dayChange (ุงฺฏุฑ ุฏุฑุตุฏ ุจูุฏ)
    const dc = parseNum(s?.dayChange);
    if (Number.isFinite(dc)) {
      // ุงฺฏุฑ ุฏุฑ ุจุงุฒู ููุทู ุฏุฑุตุฏ ุจูุฏุ ูููู ุฑู ูโฺฏุฑู.
      if (Math.abs(dc) <= 100) return dc;
    }

    // fallback: (latest - dayOpen)/dayOpen * 100
    const latest = parseNum(s?.latest);
    const dayOpen = parseNum(s?.dayOpen);
    if (Number.isFinite(latest) && Number.isFinite(dayOpen) && dayOpen !== 0) {
      return ((latest - dayOpen) / dayOpen) * 100;
    }
    return 0;
  }

  function getHighLow(s) {
    // apiv2: dayHigh/dayLow | ูุฏู: max/min
    const high = parseNum(s?.dayHigh);
    const low  = parseNum(s?.dayLow);

    const max = parseNum(s?.max);
    const min = parseNum(s?.min);

    const outHigh = Number.isFinite(high) ? high : (Number.isFinite(max) ? max : NaN);
    const outLow  = Number.isFinite(low)  ? low  : (Number.isFinite(min) ? min : NaN);
    return { high: outHigh, low: outLow };
  }

  function getVolumeSrc(s) {
    // apiv2: volumeSrc | ูุฏู: volume
    const v1 = parseNum(s?.volumeSrc);
    const v2 = parseNum(s?.volume);
    return Number.isFinite(v1) ? v1 : (Number.isFinite(v2) ? v2 : NaN);
  }

  async function loadCrypto() {
    const statusEl = document.getElementById('crypto-status');
    const cardsEl = document.getElementById('crypto-cards');

    try {
      statusEl.innerHTML = '<span class="status-dot w-2 h-2 rounded-full bg-yellow-500 blink"></span><span class="status-text text-yellow-400">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</span>';

      // 1) ุชูุงุด: ฺฉ ุฏุฑุฎูุงุณุช ุจุฑุง ฺฉู ุจุงุฒุงุฑ (ุณุฑุนโุชุฑ ู ูพุงุฏุงุฑุชุฑ)
      const allStats = await fetchNobitexStats();

      cardsEl.innerHTML = '';

      // 2) ุงฺฏุฑ ฺฉู ุจุงุฒุงุฑ ูุงูุฏุ fallback: ุฏุฑุฎูุงุณุช ุชฺฉโุจูโุชฺฉ
      const perCoinFallback = async (coinKey) => {
        // ุจุฑุฎ ูุณุฎูโูุง ูพุงุฑุงูุชุฑ ูุณุชูุฏ
        const url = `https://api.nobitex.ir/market/stats?srcCurrency=${coinKey}&dstCurrency=rls`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('coin stats failed');
        const j = await res.json();
        return j?.stats?.[`${coinKey}-rls`] || j?.stats?.[`${coinKey}-irt`] || null;
      };

      for (const meta of cryptoList) {
        let s = allStats ? pickPair(allStats, meta.key) : null;

        if (!s && !allStats) {
          try { s = await perCoinFallback(meta.key); } catch (_) {}
        }

        if (!s) {
          const card = document.createElement('div');
          card.className = 'glass rounded-2xl p-4';
          card.innerHTML = `<div class="font-bold mb-2">${meta.name}</div><div class="text-sm text-gray-400">ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุงุทูุงุนุงุช</div>`;
          cardsEl.appendChild(card);
          continue;
        }

        // values are strings in rials; convert to number (toman)
        const latestRls = parseNum(s?.latest);
        const last = Number.isFinite(latestRls) ? (latestRls / 10) : NaN;

        const { high: highRls, low: lowRls } = getHighLow(s);
        const high = Number.isFinite(highRls) ? (highRls / 10) : NaN;
        const low  = Number.isFinite(lowRls)  ? (lowRls / 10)  : NaN;

        const vol  = getVolumeSrc(s);
        const change = computeChangePercent(s);
        const isUp = change >= 0;

        const safeLast = Number.isFinite(last) ? last : 0;
        const safeLow = Number.isFinite(low) ? low : safeLast*0.98;
        const safeHigh = Number.isFinite(high) ? high : safeLast*1.02;

        const chartData = synthChartFromStats(safeLast, safeLow, safeHigh);

        const card = document.createElement('div');
        card.className = 'glass rounded-2xl p-4';
        card.innerHTML = `
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center font-bold">${meta.symbol[0]}</div>
              <div>
                <div class="font-bold">${meta.name}</div>
                <div class="text-xs text-gray-400">${meta.symbol}/IRT</div>
              </div>
            </div>
            <div class="text-left" dir="ltr">
              <div class="flex items-center gap-1 ${isUp ? 'text-green-400' : 'text-red-400'}">
                <span>${isUp ? 'โฒ' : 'โผ'}</span>
                <span>${toPersianNum(Math.abs(change).toFixed(2))}%</span>
              </div>
            </div>
          </div>

          <div class="text-2xl font-bold mb-3">${formatNumber(last, 0)} <span class="text-sm text-gray-300">ุชููุงู</span></div>

          <div class="chart-container mb-3">${createMiniChart(chartData, isUp)}</div>

          <div class="grid grid-cols-2 gap-2 text-xs">
            <div class="glass-dark rounded-lg p-2">
              <div class="text-gray-300">ุจุงูุงุชุฑู ฒดุณ</div>
              <div class="text-green-300">${formatNumber(high, 0)}</div>
            </div>
            <div class="glass-dark rounded-lg p-2">
              <div class="text-gray-300">ูพุงูโุชุฑู ฒดุณ</div>
              <div class="text-red-300">${formatNumber(low, 0)}</div>
            </div>
            <div class="glass-dark rounded-lg p-2">
              <div class="text-gray-300">ุญุฌู (Coin)</div>
              <div>${Number.isFinite(vol) ? formatNumber(vol, 4) : '-'}</div>
            </div>
            <div class="glass-dark rounded-lg p-2">
              <div class="text-gray-300">ุจูโุฑูุฒุฑุณุงู</div>
              <div>${toPersianNum(new Date().toTimeString().slice(0,5))}</div>
            </div>
          </div>
        `;
        cardsEl.appendChild(card);
      }

      statusEl.innerHTML = '<span class="status-dot w-2 h-2 rounded-full bg-green-500 blink"></span><span class="status-text text-green-400">ุขููุงู</span>';
    } catch (e) {
      console.error(e);
      document.getElementById('crypto-status').innerHTML = '<span class="status-dot w-2 h-2 rounded-full bg-red-500 blink"></span><span class="status-text text-red-400">ุขููุงู</span>';
      document.getElementById('crypto-cards').innerHTML = '<div class="col-span-full text-center text-gray-300 py-8">ุฎุทุง ุฏุฑ ุฏุฑุงูุช ููุชโูุง. ุงุชุตุงู ุงูุชุฑูุช/ููุชุฑุดฺฉู ุฑุง ุจุฑุฑุณ ฺฉูุฏ.</div>';
    }
  }

  function createMiniChart(data, isUp) {
    if (!data || data.length === 0) return '<div class="h-full flex items-center justify-center text-gray-500 text-xs">ุฏุงุฏูโุง ููุฌูุฏ ูุณุช</div>';

    const min = Math.min(...data);
    const max = Math.max(...data);
    const range = max - min || 1;
    const height = 100, width = 280, padding = 10;

    const points = data.map((val, i) => {
      const x = padding + (i / (data.length - 1)) * (width - 2 * padding);
      const y = height - padding - ((val - min) / range) * (height - 2 * padding);
      return `${x},${y}`;
    }).join(' ');

    const lastPoint = points.split(' ').pop();
    const color = isUp ? '#22c55e' : '#ef4444';

    return `
      <svg viewBox="0 0 ${width} ${height}" class="w-full h-full">
        <defs>
          <linearGradient id="grad-${isUp ? 'up' : 'down'}" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="${color}" stop-opacity="0.3"/>
            <stop offset="100%" stop-color="${color}" stop-opacity="0"/>
          </linearGradient>
        </defs>
        <polyline fill="none" stroke="${color}" stroke-width="2" points="${points}"/>
        <polygon fill="url(#grad-${isUp ? 'up' : 'down'})" points="${padding},${height - padding} ${points} ${width - padding},${height - padding}"/>
        <circle cx="${lastPoint.split(',')[0]}" cy="${lastPoint.split(',')[1]}" r="4" fill="${color}"/>
        <circle cx="${lastPoint.split(',')[0]}" cy="${lastPoint.split(',')[1]}" r="6" fill="${color}" opacity="0.3"/>
      </svg>
    `;
  }

  // ===================== WEATHER (Search all Iran cities via Nominatim) =====================
  const weatherConditions = {
    0: { fa:'ุขุณูุงู ุตุงู', icon:'sunny', night:'clear-night' },
    1: { fa:'ุนูุฏุชุงู ุตุงู', icon:'sunny', night:'clear-night' },
    2: { fa:'ููู ุงุจุฑ', icon:'cloudy', night:'cloudy' },
    3: { fa:'ุงุจุฑ', icon:'cloudy', night:'cloudy' },
    45:{ fa:'ูู', icon:'cloudy', night:'cloudy' },
    48:{ fa:'ูู ุฎโุฒุฏู', icon:'cloudy', night:'cloudy' },
    51:{ fa:'ููโูู ุจุงุฑุงู', icon:'rain', night:'rain' },
    53:{ fa:'ุจุงุฑุงู ูุชูุณุท', icon:'rain', night:'rain' },
    55:{ fa:'ุจุงุฑุงู ุดุฏุฏ', icon:'rain', night:'rain' },
    61:{ fa:'ุจุงุฑุงู ุฎูู', icon:'rain', night:'rain' },
    63:{ fa:'ุจุงุฑุงู ูุชูุณุท', icon:'rain', night:'rain' },
    65:{ fa:'ุจุงุฑุงู ุดุฏุฏ', icon:'rain', night:'rain' },
    71:{ fa:'ุจุฑู ุฎูู', icon:'snow', night:'snow' },
    73:{ fa:'ุจุฑู ูุชูุณุท', icon:'snow', night:'snow' },
    75:{ fa:'ุจุฑู ุดุฏุฏ', icon:'snow', night:'snow' },
    77:{ fa:'ุฏุงูู ุจุฑู', icon:'snow', night:'snow' },
    80:{ fa:'ุฑฺฏุจุงุฑ ุฎูู', icon:'rain', night:'rain' },
    81:{ fa:'ุฑฺฏุจุงุฑ ูุชูุณุท', icon:'rain', night:'rain' },
    82:{ fa:'ุฑฺฏุจุงุฑ ุดุฏุฏ', icon:'rain', night:'rain' },
    85:{ fa:'ุจุงุฑุด ุจุฑู', icon:'snow', night:'snow' },
    86:{ fa:'ุจุฑู ุณูฺฏู', icon:'snow', night:'snow' },
    95:{ fa:'ุฑุนุฏ ู ุจุฑู', icon:'rain', night:'rain' },
    96:{ fa:'ุชฺฏุฑฺฏ ุฎูู', icon:'rain-snow', night:'rain-snow' },
    99:{ fa:'ุชฺฏุฑฺฏ ุณูฺฏู', icon:'rain-snow', night:'rain-snow' }
  };

  let selectedCity = null;
  let citySearchTimer = null;

  async function searchIranCities() {
    const q = document.getElementById('city-search').value.trim();
    const box = document.getElementById('city-results');
    const list = document.getElementById('city-results-list');

    if (citySearchTimer) clearTimeout(citySearchTimer);

    if (q.length < 2) {
      box.classList.add('hidden');
      return;
    }

    citySearchTimer = setTimeout(async () => {
      list.innerHTML = '<div class="text-gray-400">ุฏุฑ ุญุงู ุฌุณุชุฌู...</div>';
      box.classList.remove('hidden');

      try {
        const url = `https://nominatim.openstreetmap.org/search?format=json&limit=8&countrycodes=ir&q=${encodeURIComponent(q)}`;
        const res = await fetch(url, { headers: { 'Accept-Language': 'fa' } });
        const data = await res.json();

        if (!data || data.length === 0) {
          list.innerHTML = '<div class="text-gray-400">ูุชุฌูโุง ุงูุช ูุดุฏ.</div>';
          return;
        }

        list.innerHTML = data.map((it) => {
          const name = (it.display_name || '').split(',')[0] || q;
          const province = (it.display_name || '').split(',')[1]?.trim() || 'ุงุฑุงู';
          const lat = parseFloat(it.lat);
          const lon = parseFloat(it.lon);
          const safeName = String(name).replace(/</g,'&lt;').replace(/>/g,'&gt;');
          const safeProv = String(province).replace(/</g,'&lt;').replace(/>/g,'&gt;');

          return `
            <button class="w-full text-right glass-dark rounded-xl p-3 hover:bg-white/10 transition"
              onclick="setSelectedCity({name:'${safeName}', province:'${safeProv}', lat:${lat}, lon:${lon}})">
              <div class="font-bold">${safeName}</div>
              <div class="text-xs text-gray-400">${safeProv}</div>
            </button>
          `;
        }).join('');
      } catch (e) {
        console.error(e);
        list.innerHTML = '<div class="text-red-400">ุฎุทุง ุฏุฑ ุฌุณุชุฌู (ุงุญุชูุงูุงู ูุงุฒููุฏ VPN).</div>';
      }
    }, 350);
  }

  function setSelectedCity(city) {
    selectedCity = city;
    document.getElementById('city-search').value = city.name;
    document.getElementById('city-results').classList.add('hidden');
    loadWeather();
  }

  async function loadWeather() {
    const contentEl = document.getElementById('weather-content');
    const animEl = document.getElementById('weather-animation');
    const cardEl = document.getElementById('weather-card');

    if (!selectedCity) return;

    contentEl.innerHTML = '<div class="text-center text-gray-400 py-8">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</div>';
    animEl.innerHTML = '';

    try {
      const lat = selectedCity.lat;
      const lon = selectedCity.lon;

      // ุชุบุฑ: ุฌุฒุฆุงุช ุจุดุชุฑ (pressure, visibility, daily max/min, sunrise/sunset)
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,wind_speed_10m,pressure_msl,visibility&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset&forecast_days=7&timezone=Asia/Tehran`;
      const res = await fetch(url);

      if (!res.ok) throw new Error('Weather API Error');

      const data = await res.json();
      const current = data.current;

      const weatherInfo = weatherConditions[current.weather_code] || { fa:'ูุงูุดุฎุต', icon:'cloudy', night:'cloudy' };
      const isDay = current.is_day === 1;
      const iconType = isDay ? weatherInfo.icon : weatherInfo.night;

      // Update background (same logic)
      if (isDay) {
        if (iconType === 'sunny') cardEl.style.background = 'linear-gradient(135deg, #87CEEB 0%, #FFE4B5 100%)';
        else if (iconType === 'rain' || iconType === 'rain-snow') cardEl.style.background = 'linear-gradient(135deg, #4A5568 0%, #2D3748 100%)';
        else if (iconType === 'snow') cardEl.style.background = 'linear-gradient(135deg, #CBD5E0 0%, #E2E8F0 100%)';
        else cardEl.style.background = 'linear-gradient(135deg, #718096 0%, #A0AEC0 100%)';
      } else {
        cardEl.style.background = 'linear-gradient(135deg, #1A202C 0%, #2D3748 100%)';
      }

      animEl.innerHTML = createWeatherAnimation(iconType, isDay);

      const dailyMax = data.daily?.temperature_2m_max?.[0];
      const dailyMin = data.daily?.temperature_2m_min?.[0];
      const sunrise = data.daily?.sunrise?.[0];
      const sunset  = data.daily?.sunset?.[0];

      const pressure = current.pressure_msl;
      const visibility = current.visibility; // meters
      const visKm = visibility ? (visibility/1000) : null;

      const weeklyHtml = renderWeeklyForecast(data.daily);


      contentEl.innerHTML = `
        <div class="text-center">
          <div class="text-sm text-gray-200 mb-1">${selectedCity.name}ุ ${selectedCity.province}</div>
          <div class="text-6xl font-bold mb-2">${toPersianNum(Math.round(current.temperature_2m))}ยฐ</div>
          <div class="text-lg mb-4">${weatherInfo.fa}</div>

          <div class="grid grid-cols-3 gap-4 text-sm mb-4">
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 text-xs mb-1">ุงุญุณุงุณ ุฏูุง</div>
              <div class="font-bold">${toPersianNum(Math.round(current.apparent_temperature))}ยฐ</div>
            </div>
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 text-xs mb-1">ุฑุทูุจุช</div>
              <div class="font-bold">${toPersianNum(current.relative_humidity_2m)}%</div>
            </div>
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 text-xs mb-1">ุจุงุฏ</div>
              <div class="font-bold">${toPersianNum(Math.round(current.wind_speed_10m))} km/h</div>
            </div>
          </div>

          <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 text-xs">
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 mb-1">ูุดุงุฑ ููุง</div>
              <div class="font-bold">${pressure ? toPersianNum(Math.round(pressure)) : '-'} hPa</div>
            </div>
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 mb-1">ุฏุฏ ุงูู</div>
              <div class="font-bold">${visKm ? toPersianNum(visKm.toFixed(1)) : '-'} km</div>
            </div>
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 mb-1">ฺฉููู/ุจุดูู</div>
              <div class="font-bold">${dailyMin!=null ? toPersianNum(Math.round(dailyMin)) : '-'}ยฐ / ${dailyMax!=null ? toPersianNum(Math.round(dailyMax)) : '-'}ยฐ</div>
            </div>
            <div class="glass-dark rounded-xl p-3">
              <div class="text-gray-200 mb-1">ุทููุน/ุบุฑูุจ</div>
              <div class="font-bold">${sunrise ? toPersianNum(new Date(sunrise).toTimeString().slice(0,5)) : '--'} / ${sunset ? toPersianNum(new Date(sunset).toTimeString().slice(0,5)) : '--'}</div>
            </div>
          </div>
        </div>

        ${weeklyHtml}
      `;
    } catch (e) {
      console.error(e);
      contentEl.innerHTML = '<div class="text-center text-red-200 py-8">ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุงุทูุงุนุงุช ุขุจ ู ููุง (ุงุญุชูุงูุงู ูุงุฒููุฏ VPN)</div>';
    }
  }

  function createWeatherAnimation(type, isDay) {
    let html = '';
    if (type === 'sunny' && isDay) {
      html = `
        <div class="absolute top-4 left-4 sun-glow">
          <svg width="80" height="80" viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="20" fill="#FFD700"/>
            ${[...Array(8)].map((_, i) => `<line x1="40" y1="8" x2="40" y2="16" stroke="#FFD700" stroke-width="3" stroke-linecap="round" transform="rotate(${i*45} 40 40)"/>`).join('')}
          </svg>
        </div>
      `;
    } else if (type === 'clear-night') {
      html = `
        <svg class="absolute top-4 left-4" width="60" height="60" viewBox="0 0 60 60">
          <path d="M35 10 C20 10 10 25 15 40 C20 55 40 55 50 45 C35 50 25 35 35 20 C40 15 35 10 35 10" fill="#F0E68C"/>
        </svg>
        ${[...Array(20)].map(() => `<div class="star absolute w-1 h-1 bg-white rounded-full" style="top:${Math.random()*100}%; left:${Math.random()*100}%; animation-delay:${Math.random()*2}s;"></div>`).join('')}
      `;
    } else if (type === 'cloudy') {
      html = `${[...Array(3)].map((_,i)=>`
        <div class="cloud absolute" style="top:${10+i*20}%; right:${10+i*15}%; animation-delay:${i*2}s;">
          <svg width="${80-i*10}" height="${50-i*5}" viewBox="0 0 100 60">
            <ellipse cx="30" cy="40" rx="25" ry="15" fill="rgba(255,255,255,${0.6-i*0.1})"/>
            <ellipse cx="55" cy="35" rx="30" ry="20" fill="rgba(255,255,255,${0.6-i*0.1})"/>
            <ellipse cx="80" cy="40" rx="20" ry="12" fill="rgba(255,255,255,${0.6-i*0.1})"/>
          </svg>
        </div>`).join('')}`;
    } else if (type === 'rain') {
      html = `
        ${[...Array(20)].map(()=>`<div class="rain-drop absolute w-0.5 h-4 bg-blue-300 rounded-full opacity-60" style="right:${Math.random()*100}%; animation-delay:${Math.random()*1}s; animation-duration:${0.8+Math.random()*0.4}s;"></div>`).join('')}
        <div class="cloud absolute top-2 right-4">
          <svg width="100" height="60" viewBox="0 0 100 60">
            <ellipse cx="30" cy="40" rx="25" ry="15" fill="rgba(100,100,100,0.8)"/>
            <ellipse cx="55" cy="35" rx="30" ry="20" fill="rgba(100,100,100,0.8)"/>
            <ellipse cx="80" cy="40" rx="20" ry="12" fill="rgba(100,100,100,0.8)"/>
          </svg>
        </div>
      `;
    } else if (type === 'snow') {
      html = `${[...Array(15)].map(()=>`<div class="snow-flake absolute text-white opacity-80" style="right:${Math.random()*100}%; animation-delay:${Math.random()*3}s; animation-duration:${2+Math.random()*2}s;">โ</div>`).join('')}`;
    } else if (type === 'rain-snow') {
      html = `
        ${[...Array(10)].map(()=>`<div class="rain-drop absolute w-0.5 h-3 bg-blue-300 rounded-full opacity-60" style="right:${Math.random()*50}%; animation-delay:${Math.random()*1}s;"></div>`).join('')}
        ${[...Array(8)].map(()=>`<div class="snow-flake absolute text-white opacity-80 text-xs" style="right:${50+Math.random()*50}%; animation-delay:${Math.random()*3}s;">โ</div>`).join('')}
      `;
    }
    return html;
  }


  function renderWeeklyForecast(daily) {
    try {
      if (!daily || !daily.time || daily.time.length === 0) return '';
      const dayNames = ['ฺฉุดูุจู','ุฏูุดูุจู','ุณูโุดูุจู','ฺูุงุฑุดูุจู','ูพูุฌุดูุจู','ุฌูุนู','ุดูุจู'];
      const items = daily.time.map((t, i) => {
        const d = new Date(t);
        const name = dayNames[d.getDay()];
        const code = daily.weather_code?.[i];
        const info = weatherConditions[code] || { fa:'-', icon:'cloudy', night:'cloudy' };
        const max = daily.temperature_2m_max?.[i];
        const min = daily.temperature_2m_min?.[i];
        const pop = daily.precipitation_probability_max?.[i]; // %
        return `
          <div class="glass-dark rounded-xl p-3 min-w-[140px]">
            <div class="text-xs text-gray-200 mb-1">${name}</div>
            <div class="text-[11px] text-gray-300 mb-2">${toPersianNum(d.getDate())}/${toPersianNum(d.getMonth()+1)}</div>
            <div class="text-sm font-bold mb-1">${info.fa}</div>
            <div class="text-xs text-gray-300 mb-2">ฺฉููู/ุจุดูู: ${min!=null ? toPersianNum(Math.round(min)) : '-'}ยฐ / ${max!=null ? toPersianNum(Math.round(max)) : '-'}ยฐ</div>
            <div class="text-xs text-gray-300">ุงุญุชูุงู ุจุงุฑุด: ${pop!=null ? toPersianNum(pop) : '-'}%</div>
          </div>
        `;
      }).join('');

      return `
        <div class="mt-5">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm font-bold text-gray-100">ูพุดโุจู ท ุฑูุฒ ุขูุฏู</div>
            <div class="text-[11px] text-gray-300">ุจุฑุง ุงุณฺฉุฑููุ ุจฺฉุดุฏ โตโถ</div>
          </div>
          <div class="flex gap-3 overflow-x-auto scrollbar-hide pb-2">
            ${items}
          </div>
        </div>
      `;
    } catch {
      return '';
    }
  }


  // ===================== DATE & TIME (Hijri fixed -1 day) =====================
  let currentCalendarMonth = 0;
  let currentCalendarYear = 0;

  function updateDateTime() {
    const now = new Date();

    const iranTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Tehran' }));
    document.getElementById('iran-time').textContent = toPersianNum(iranTime.toTimeString().slice(0,8));

    const utcTime = new Date(now.toLocaleString('en-US', { timeZone: 'UTC' }));
    document.getElementById('utc-time').textContent = toPersianNum(utcTime.toTimeString().slice(0,8));

    const jalali = gregorianToJalali(now.getFullYear(), now.getMonth()+1, now.getDate());
    const jalaliMonths = ['ูุฑูุฑุฏู','ุงุฑุฏุจูุดุช','ุฎุฑุฏุงุฏ','ุชุฑ','ูุฑุฏุงุฏ','ุดูุฑูุฑ','ููุฑ','ุขุจุงู','ุขุฐุฑ','ุฏ','ุจููู','ุงุณููุฏ'];
    document.getElementById('iran-date').textContent = `${toPersianNum(jalali.day)} ${jalaliMonths[jalali.month-1]} ${toPersianNum(jalali.year)}`;

    document.getElementById('utc-date').textContent = utcTime.toLocaleDateString('en-US', { year:'numeric', month:'short', day:'numeric' });

    const gregorianMonths = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    document.getElementById('gregorian-date').textContent = `${now.getDate()} ${gregorianMonths[now.getMonth()]} ${now.getFullYear()}`;

    // ุชุงุฑุฎ ููุฑ (ุงุตูุงุญ ุดุฏ: ุฏฺฏุฑ ฺฉ ุฑูุฒ ุนูุจ/ุฌูู ููโุดูุฏ)
    const hijri = gregorianToHijri(now.getFullYear(), now.getMonth()+1, now.getDate());
    const hijriMonths = ['ูุญุฑู','ุตูุฑ','ุฑุจุนโุงูุงูู','ุฑุจุนโุงูุซุงู','ุฌูุงุฏโุงูุงูู','ุฌูุงุฏโุงูุซุงู','ุฑุฌุจ','ุดุนุจุงู','ุฑูุถุงู','ุดูุงู','ุฐโุงููุนุฏู','ุฐโุงูุญุฌู'];
    document.getElementById('hijri-date').textContent = `${toPersianNum(hijri.day)} ${hijriMonths[hijri.month-1]} ${toPersianNum(hijri.year)}`;

    const hours = iranTime.getHours()%12;
    const minutes = iranTime.getMinutes();
    const seconds = iranTime.getSeconds();

    const hourAngle = (hours*30)+(minutes*0.5);
    const minuteAngle = minutes*6;
    const secondAngle = seconds*6;

    document.getElementById('hour-hand').setAttribute('transform', `rotate(${hourAngle} 50 50)`);
    document.getElementById('minute-hand').setAttribute('transform', `rotate(${minuteAngle} 50 50)`);
    document.getElementById('second-hand').setAttribute('transform', `rotate(${secondAngle} 50 50)`);

    if (currentCalendarYear === 0) {
      currentCalendarYear = jalali.year;
      currentCalendarMonth = jalali.month;
    }
  }

  function adjustHijriByDays(hijriObj, deltaDays) {
    // Convert hijri -> gregorian date, shift, back to hijri
    const g = hijriToGregorian(hijriObj.year, hijriObj.month, hijriObj.day);
    const d = new Date(g.year, g.month-1, g.day);
    d.setDate(d.getDate() + deltaDays);
    return gregorianToHijri(d.getFullYear(), d.getMonth()+1, d.getDate());
  }

  function renderCalendar() {
    const jalaliMonths = ['ูุฑูุฑุฏู','ุงุฑุฏุจูุดุช','ุฎุฑุฏุงุฏ','ุชุฑ','ูุฑุฏุงุฏ','ุดูุฑูุฑ','ููุฑ','ุขุจุงู','ุขุฐุฑ','ุฏ','ุจููู','ุงุณููุฏ'];
    document.getElementById('calendar-title').textContent = `${jalaliMonths[currentCalendarMonth-1]} ${toPersianNum(currentCalendarYear)}`;

    const daysInMonth = currentCalendarMonth <= 6 ? 31 : (currentCalendarMonth <= 11 ? 30 : (isJalaliLeapYear(currentCalendarYear) ? 30 : 29));

    const firstDayGregorian = jalaliToGregorian(currentCalendarYear, currentCalendarMonth, 1);
    const firstDate = new Date(firstDayGregorian.year, firstDayGregorian.month-1, firstDayGregorian.day);
    let firstDayOfWeek = firstDate.getDay();
    firstDayOfWeek = (firstDayOfWeek + 1) % 7;

    const today = new Date();
    const todayJalali = gregorianToJalali(today.getFullYear(), today.getMonth()+1, today.getDate());

    const daysEl = document.getElementById('calendar-days');
    daysEl.innerHTML = '';

    for (let i=0;i<firstDayOfWeek;i++) daysEl.innerHTML += '<div class="py-2"></div>';

    for (let day=1; day<=daysInMonth; day++) {
      const isToday = currentCalendarYear===todayJalali.year && currentCalendarMonth===todayJalali.month && day===todayJalali.day;
      const isFriday = (firstDayOfWeek + day - 1) % 7 === 6;

      daysEl.innerHTML += `
        <div class="py-2 rounded-lg cursor-pointer transition hover:bg-white/10 ${isToday ? 'bg-gradient-to-r from-indigo-600 to-purple-600 font-bold' : ''} ${isFriday && !isToday ? 'text-red-400' : ''}">
          ${toPersianNum(day)}
        </div>
      `;
    }
  }

  function changeMonth(delta) {
    currentCalendarMonth += delta;
    if (currentCalendarMonth > 12) { currentCalendarMonth = 1; currentCalendarYear++; }
    else if (currentCalendarMonth < 1) { currentCalendarMonth = 12; currentCalendarYear--; }
    renderCalendar();
  }

  async function fetchEvents() {
    const eventsEl = document.getElementById('today-events');
    try {
      const today = new Date();
      const jalali = gregorianToJalali(today.getFullYear(), today.getMonth()+1, today.getDate());
      const events = getStaticEvents(jalali.month, jalali.day);
      eventsEl.innerHTML = events.length ? events.map(e=>`<div class="py-1">โข ${e}</div>`).join('') : '<div class="text-gray-500">ููุงุณุจุช ุจุฑุง ุงูุฑูุฒ ุซุจุช ูุดุฏู ุงุณุช</div>';
    } catch {
      eventsEl.innerHTML = '<div class="text-gray-500">ููุงุณุจุช ุจุฑุง ุงูุฑูุฒ ุซุจุช ูุดุฏู ุงุณุช</div>';
    }
  }

  function getStaticEvents(month, day) {
    const events = {
      '1-1':['ุนุฏ ููุฑูุฒ'],
      '1-2':['ุนุฏ ููุฑูุฒ'],
      '1-3':['ุนุฏ ููุฑูุฒ'],
      '1-4':['ุนุฏ ููุฑูุฒ'],
      '1-12':['ุฑูุฒ ุฌูููุฑ ุงุณูุงู ุงุฑุงู'],
      '1-13':['ุฑูุฒ ุทุจุนุช (ุณุฒุฏูโุจุฏุฑ)'],
      '3-14':['ุฑุญูุช ุงูุงู ุฎูู (ุฑู)'],
      '3-15':['ูุงู ฑต ุฎุฑุฏุงุฏ'],
      '11-22':['ูพุฑูุฒ ุงูููุงุจ ุงุณูุงู'],
      '12-29':['ุฑูุฒ ูู ุดุฏู ุตูุนุช ููุช']
    };
    return events[`${month}-${day}`] || [];
  }

  // Date conversion functions (original)
  function gregorianToJalali(gy, gm, gd) {
    const g_d_m = [0,31,59,90,120,151,181,212,243,273,304,334];
    let jy = (gy <= 1600) ? 0 : 979;
    gy -= (gy <= 1600) ? 621 : 1600;
    const gy2 = (gm > 2) ? (gy + 1) : gy;
    let days = (365 * gy) + (parseInt((gy2 + 3) / 4)) - (parseInt((gy2 + 99) / 100)) + (parseInt((gy2 + 399) / 400)) - 80 + gd + g_d_m[gm - 1];
    jy += 33 * (parseInt(days / 12053));
    days %= 12053;
    jy += 4 * (parseInt(days / 1461));
    days %= 1461;
    jy += parseInt((days - 1) / 365);
    if (days > 365) days = (days - 1) % 365;
    const jm = (days < 186) ? 1 + parseInt(days / 31) : 7 + parseInt((days - 186) / 30);
    const jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
    return { year: jy, month: jm, day: jd };
  }

  function jalaliToGregorian(jy, jm, jd) {
    let gy = (jy <= 979) ? 621 : 1600;
    jy -= (jy <= 979) ? 0 : 979;
    let days = (365 * jy) + ((parseInt(jy / 33)) * 8) + (parseInt(((jy % 33) + 3) / 4)) + 78 + jd + ((jm < 7) ? (jm - 1) * 31 : ((jm - 7) * 30) + 186);
    gy += 400 * (parseInt(days / 146097));
    days %= 146097;
    if (days > 36524) {
      gy += 100 * (parseInt(--days / 36524));
      days %= 36524;
      if (days >= 365) days++;
    }
    gy += 4 * (parseInt(days / 1461));
    days %= 1461;
    gy += parseInt((days - 1) / 365);
    if (days > 365) days = (days - 1) % 365;
    const gd = days + 1;
    const sal_a = [0,31,((gy%4===0 && gy%100!==0) || (gy%400===0)) ? 29 : 28,31,30,31,30,31,31,30,31,30,31];
    let gm = 0;
    let v = gd;
    for (gm = 0; gm < 13 && v > sal_a[gm]; gm++) v -= sal_a[gm];
    return { year: gy, month: gm, day: v };
  }

  function gregorianToHijri(gy, gm, gd) {
    const d = new Date(gy, gm - 1, gd);
    const jd = Math.floor((d.getTime() / 86400000) + 2440587.5);
    const l = jd - 1948439 + 10632;
    const n = Math.floor((l - 1) / 10631);
    const l2 = l - 10631 * n + 354;
    const j = Math.floor((10985 - l2) / 5316) * Math.floor((50 * l2) / 17719) + Math.floor(l2 / 5670) * Math.floor((43 * l2) / 15238);
    const l3 = l2 - Math.floor((30 - j) / 15) * Math.floor((17719 * j) / 50) - Math.floor(j / 16) * Math.floor((15238 * j) / 43) + 29;
    const hm = Math.floor((24 * l3) / 709);
    const hd = l3 - Math.floor((709 * hm) / 24);
    const hy = 30 * n + j - 30;
    return { year: hy, month: hm, day: hd };
  }

  function hijriToGregorian(hy, hm, hd) {
    const jd = Math.floor((11 * hy + 3) / 30) + 354 * hy + 30 * hm - Math.floor((hm - 1) / 2) + hd + 1948439 - 385;
    const l = jd + 68569;
    const n = Math.floor(4 * l / 146097);
    const l2 = l - Math.floor((146097 * n + 3) / 4);
    const i = Math.floor(4000 * (l2 + 1) / 1461001);
    const l3 = l2 - Math.floor(1461 * i / 4) + 31;
    const j = Math.floor(80 * l3 / 2447);
    const gd = l3 - Math.floor(2447 * j / 80);
    const l4 = Math.floor(j / 11);
    const gm = j + 2 - 12 * l4;
    const gy = 100 * (n - 49) + i + l4;
    return { year: gy, month: gm, day: gd };
  }

  function isJalaliLeapYear(jy) {
    return [1,5,9,13,17,22,26,30].indexOf(jy % 33) !== -1;
  }

  function convertFromJalali() {
    const y = parseInt(document.getElementById('jalali-year').value);
    const m = parseInt(document.getElementById('jalali-month').value);
    const d = parseInt(document.getElementById('jalali-day').value);
    if (!y || !m || !d) return;

    const gregorian = jalaliToGregorian(y, m, d);
    document.getElementById('gregorian-year').value = gregorian.year;
    document.getElementById('gregorian-month').value = gregorian.month;
    document.getElementById('gregorian-day').value = gregorian.day;

    const hijri = gregorianToHijri(gregorian.year, gregorian.month, gregorian.day);
    document.getElementById('hijri-year').value = hijri.year;
    document.getElementById('hijri-month').value = hijri.month;
    document.getElementById('hijri-day').value = hijri.day;
  }

  function convertFromGregorian() {
    const y = parseInt(document.getElementById('gregorian-year').value);
    const m = parseInt(document.getElementById('gregorian-month').value);
    const d = parseInt(document.getElementById('gregorian-day').value);
    if (!y || !m || !d) return;

    const jalali = gregorianToJalali(y, m, d);
    document.getElementById('jalali-year').value = jalali.year;
    document.getElementById('jalali-month').value = jalali.month;
    document.getElementById('jalali-day').value = jalali.day;

    const hijri = gregorianToHijri(y, m, d);
    document.getElementById('hijri-year').value = hijri.year;
    document.getElementById('hijri-month').value = hijri.month;
    document.getElementById('hijri-day').value = hijri.day;
  }

  function convertFromHijri() {
    const y = parseInt(document.getElementById('hijri-year').value);
    const m = parseInt(document.getElementById('hijri-month').value);
    const d = parseInt(document.getElementById('hijri-day').value);
    if (!y || !m || !d) return;

    const gregorian = hijriToGregorian(y, m, d);
    document.getElementById('gregorian-year').value = gregorian.year;
    document.getElementById('gregorian-month').value = gregorian.month;
    document.getElementById('gregorian-day').value = gregorian.day;

    const jalali = gregorianToJalali(gregorian.year, gregorian.month, gregorian.day);
    document.getElementById('jalali-year').value = jalali.year;
    document.getElementById('jalali-month').value = jalali.month;
    document.getElementById('jalali-day').value = jalali.day;
  }

  // ===================== UNIT CONVERTER (12 types) =====================
  const unitData = {
    length: { label:'๐ ุทูู', units:[
      { id:'meter', name:'ูุชุฑ', factor:1 },
      { id:'kilometer', name:'ฺฉูููุชุฑ', factor:1000 },
      { id:'centimeter', name:'ุณุงูุชโูุชุฑ', factor:0.01 },
      { id:'millimeter', name:'ููโูุชุฑ', factor:0.001 },
      { id:'micrometer', name:'ูฺฉุฑููุชุฑ', factor:1e-6 },
      { id:'nanometer', name:'ูุงูููุชุฑ', factor:1e-9 },
      { id:'mile', name:'ูุงู', factor:1609.344 },
      { id:'yard', name:'ุงุฑุฏ', factor:0.9144 },
      { id:'foot', name:'ููุช', factor:0.3048 },
      { id:'inch', name:'ุงูฺ', factor:0.0254 },
      { id:'nautical_mile', name:'ูุงู ุฏุฑุง', factor:1852 },
      { id:'angstrom', name:'ุขูฺฏุณุชุฑูู', factor:1e-10 }
    ]},
    weight: { label:'โ๏ธ ูุฒู', units:[
      { id:'kilogram', name:'ฺฉููฺฏุฑู', factor:1 },
      { id:'gram', name:'ฺฏุฑู', factor:0.001 },
      { id:'milligram', name:'ููโฺฏุฑู', factor:1e-6 },
      { id:'microgram', name:'ูฺฉุฑูฺฏุฑู', factor:1e-9 },
      { id:'ton', name:'ุชู', factor:1000 },
      { id:'pound', name:'ูพููุฏ', factor:0.45359237 },
      { id:'ounce', name:'ุงููุณ', factor:0.028349523125 },
      { id:'stone', name:'ุงุณุชูู', factor:6.35029318 },
      { id:'carat', name:'ูุฑุงุท', factor:0.0002 },
      { id:'grain', name:'ฺฏุฑู', factor:0.00006479891 },
      { id:'slug', name:'ุงุณูุงฺฏ', factor:14.59390294 },
      { id:'atomic_mass', name:'ุฌุฑู ุงุชู (u)', factor:1.66053906660e-27 } // symbolic: won't be practical
    ]},
    temperature: { label:'๐ก๏ธ ุฏูุง', units:[
      { id:'celsius', name:'ุณูุณูุณ (ยฐC)' },
      { id:'fahrenheit', name:'ูุงุฑููุงุช (ยฐF)' },
      { id:'kelvin', name:'ฺฉููู (K)' },
      { id:'rankine', name:'ุฑุงูฺฉู (ยฐR)' }
    ]},
    volume: { label:'๐งช ุญุฌู', units:[
      { id:'liter', name:'ูุชุฑ', factor:1 },
      { id:'milliliter', name:'ููโูุชุฑ', factor:0.001 },
      { id:'cubic_meter', name:'ูุชุฑ ูฺฉุนุจ', factor:1000 },
      { id:'cubic_centimeter', name:'ุณุงูุชโูุชุฑ ูฺฉุนุจ', factor:0.001 },
      { id:'gallon_us', name:'ฺฏุงูู (US)', factor:3.78541 },
      { id:'gallon_uk', name:'ฺฏุงูู (UK)', factor:4.54609 },
      { id:'quart', name:'ฺฉูุงุฑุช', factor:0.946353 },
      { id:'pint', name:'ูพุงูุช', factor:0.473176 },
      { id:'cup', name:'ููุฌุงู', factor:0.236588 },
      { id:'tablespoon', name:'ูุงุดู ุบุฐุงุฎูุฑ', factor:0.0147868 },
      { id:'teaspoon', name:'ูุงุดู ฺุงุฎูุฑ', factor:0.00492892 },
      { id:'barrel', name:'ุจุดฺฉู ููุช', factor:158.987 }
    ]},
    speed: { label:'๐ ุณุฑุนุช', units:[
      { id:'mps', name:'ูุชุฑ ุจุฑ ุซุงูู', factor:1 },
      { id:'kmph', name:'ฺฉูููุชุฑ ุจุฑ ุณุงุนุช', factor:0.2777777778 },
      { id:'mph', name:'ูุงู ุจุฑ ุณุงุนุช', factor:0.44704 },
      { id:'knot', name:'ูุงุช (ุฏุฑุง)', factor:0.514444 },
      { id:'fps', name:'ููุช ุจุฑ ุซุงูู', factor:0.3048 },
      { id:'mach', name:'ูุงุฎ (ุชูุฑุจ)', factor:340.29 }
    ]},
    time: { label:'โฑ๏ธ ุฒูุงู', units:[
      { id:'second', name:'ุซุงูู', factor:1 },
      { id:'minute', name:'ุฏููู', factor:60 },
      { id:'hour', name:'ุณุงุนุช', factor:3600 },
      { id:'day', name:'ุฑูุฒ', factor:86400 },
      { id:'week', name:'ููุชู', factor:604800 },
      { id:'month', name:'ูุงู (ณฐ ุฑูุฒ)', factor:2592000 },
      { id:'year', name:'ุณุงู (ณถต ุฑูุฒ)', factor:31536000 }
    ]},
    pressure: { label:'๐งฏ ูุดุงุฑ', units:[
      { id:'pascal', name:'ูพุงุณฺฉุงู (Pa)', factor:1 },
      { id:'kpa', name:'ฺฉูููพุงุณฺฉุงู (kPa)', factor:1000 },
      { id:'bar', name:'ุจุงุฑ (bar)', factor:100000 },
      { id:'atm', name:'ุงุชูุณูุฑ (atm)', factor:101325 },
      { id:'mmhg', name:'ููโูุชุฑ ุฌูู (mmHg)', factor:133.322 },
      { id:'psi', name:'PSI', factor:6894.757 }
    ]},
    energy: { label:'โก ุงูุฑฺ', units:[
      { id:'joule', name:'ฺูู (J)', factor:1 },
      { id:'kj', name:'ฺฉููฺูู', factor:1000 },
      { id:'cal', name:'ฺฉุงูุฑ', factor:4.184 },
      { id:'kcal', name:'ฺฉููฺฉุงูุฑ', factor:4184 },
      { id:'wh', name:'ูุงุชโุณุงุนุช', factor:3600 },
      { id:'kwh', name:'ฺฉูููุงุชโุณุงุนุช', factor:3.6e6 },
      { id:'btu', name:'BTU', factor:1055.06 }
    ]},
    power: { label:'๐ ุชูุงู', units:[
      { id:'watt', name:'ูุงุช (W)', factor:1 },
      { id:'kw', name:'ฺฉูููุงุช', factor:1000 },
      { id:'mw', name:'ูฺฏุงูุงุช', factor:1e6 },
      { id:'hp', name:'ุงุณุจโุจุฎุงุฑ', factor:745.699872 }
    ]},
    area: { label:'๐บ๏ธ ูุณุงุญุช', units:[
      { id:'sqm', name:'ูุชุฑ ูุฑุจุน', factor:1 },
      { id:'sqkm', name:'ฺฉูููุชุฑ ูุฑุจุน', factor:1e6 },
      { id:'sqcm', name:'ุณุงูุชโูุชุฑ ูุฑุจุน', factor:0.0001 },
      { id:'hectare', name:'ูฺฉุชุงุฑ', factor:10000 },
      { id:'acre', name:'ุงฺฉุฑ', factor:4046.8564224 },
      { id:'sqft', name:'ููุช ูุฑุจุน', factor:0.09290304 }
    ]},
    data: { label:'๐พ ุฏุงุฏู', units:[
      { id:'byte', name:'ุจุงุช', factor:1 },
      { id:'kb', name:'ฺฉููุจุงุช', factor:1024 },
      { id:'mb', name:'ูฺฏุงุจุงุช', factor:1024**2 },
      { id:'gb', name:'ฺฏฺฏุงุจุงุช', factor:1024**3 },
      { id:'tb', name:'ุชุฑุงุจุงุช', factor:1024**4 },
      { id:'bit', name:'ุจุช', factor:1/8 }
    ]},
    angle: { label:'๐ ุฒุงูู', units:[
      { id:'degree', name:'ุฏุฑุฌู', factor:1 },
      { id:'radian', name:'ุฑุงุฏุงู', factor:57.2957795131 },
      { id:'grad', name:'ฺฏุฑุงุฏ', factor:0.9 },
      { id:'minute', name:'ุฏููู ููุณ', factor:1/60 },
      { id:'second', name:'ุซุงูู ููุณ', factor:1/3600 }
    ]}
  };


  // ---- Unit dropdown helpers (compact UI) ----
  function closeAllUnitMenus() {
    ['from-unit','to-unit'].forEach(id => {
      const m = document.getElementById(id+'-menu');
      if (m) m.classList.add('hidden');
    });
  }

  document.addEventListener('click', (e) => {
    const inside = e.target.closest('#from-unit-btn, #from-unit-menu, #to-unit-btn, #to-unit-menu');
    if (!inside) closeAllUnitMenus();
  });

  function toggleUnitMenu(id) {
    const menu = document.getElementById(id+'-menu');
    if (!menu) return;
    const isHidden = menu.classList.contains('hidden');
    closeAllUnitMenus();
    if (isHidden) menu.classList.remove('hidden');
  }

  function setUnitDropdownOptions(id, units) {
    const menu = document.getElementById(id+'-menu');
    if (!menu) return;
    menu.innerHTML = units.map(u => `
      <button type="button" class="w-full text-right px-3 py-2 rounded-lg hover:bg-white/10 transition text-sm"
        onclick="selectUnit('${id}','${u.id}','${u.name.replace(/'/g, '&#39;')}')">
        ${u.name}
      </button>
    `).join('');
  }

  function selectUnit(id, value, label) {
    document.getElementById(id+'-value').value = value;
    document.getElementById(id+'-label').innerHTML = label;
    const menu = document.getElementById(id+'-menu');
    if (menu) menu.classList.add('hidden');
    convertUnit();
  }

  function getSelectedUnit(id) {
    return document.getElementById(id+'-value')?.value || '';
  }

  let currentConverterType = 'length';

  function initConverterTypes() {
    const el = document.getElementById('converter-types');
    if (!el || el.dataset.inited === '1') return;
    el.dataset.inited = '1';
    const keys = Object.keys(unitData);
    el.innerHTML = keys.map((k, idx) => `
      <button onclick="setConverterType('${k}')" class="converter-type-btn ${idx===0?'active':''} glass px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap" data-type="${k}">
        ${unitData[k].label}
      </button>
    `).join('');
  }

  
  function setConverterType(type) {
    currentConverterType = type;

    document.querySelectorAll('.converter-type-btn').forEach(btn => {
      btn.classList.remove('active');
      if (btn.dataset.type === type) btn.classList.add('active');
    });

    const units = unitData[type].units;

    // populate compact dropdowns
    setUnitDropdownOptions('from-unit', units);
    setUnitDropdownOptions('to-unit', units);

    // default selections
    const fromDefault = units[0]?.id || '';
    const toDefault = units[1]?.id || units[0]?.id || '';

    selectUnit('from-unit', fromDefault, units.find(u=>u.id===fromDefault)?.name || 'ุงูุชุฎุงุจ ูุงุญุฏ');
    selectUnit('to-unit', toDefault, units.find(u=>u.id===toDefault)?.name || 'ุงูุชุฎุงุจ ูุงุญุฏ');

    document.getElementById('from-value').value = '';
    document.getElementById('to-value').textContent = '-';
  }


  
  function convertUnit() {
    const fromValue = parseFloat(document.getElementById('from-value').value);
    const fromUnit = getSelectedUnit('from-unit');
    const toUnit = getSelectedUnit('to-unit');

    if (isNaN(fromValue)) { document.getElementById('to-value').textContent = '-'; return; }
    if (!fromUnit || !toUnit) { document.getElementById('to-value').textContent = '-'; return; }

    let result;

    if (currentConverterType === 'temperature') {
      result = convertTemperature(fromValue, fromUnit, toUnit);
    } else {
      const units = unitData[currentConverterType].units;
      const fromFactor = units.find(u => u.id === fromUnit)?.factor;
      const toFactor = units.find(u => u.id === toUnit)?.factor;

      if (!fromFactor || !toFactor) { document.getElementById('to-value').textContent='-'; return; }
      result = (fromValue * fromFactor) / toFactor;
    }

    const pretty = Number.isFinite(result) ? result.toFixed(8).replace(/\.0+$/,'').replace(/(\.\d*?)0+$/,'$1') : '-';
    document.getElementById('to-value').textContent = toPersianNum(pretty);
  }


  function convertTemperature(value, from, to) {
    let c;
    switch(from){
      case 'celsius': c=value; break;
      case 'fahrenheit': c=(value-32)*5/9; break;
      case 'kelvin': c=value-273.15; break;
      case 'rankine': c=(value-491.67)*5/9; break;
      default: c=value;
    }
    switch(to){
      case 'celsius': return c;
      case 'fahrenheit': return (c*9/5)+32;
      case 'kelvin': return c+273.15;
      case 'rankine': return (c+273.15)*9/5;
      default: return c;
    }
  }

  // ===================== CALCULATOR (simple + scientific) =====================
  let calcExpression = '';
  let calcCurrentValue = '0';
  let calcLastOperator = null;
  let calcNewNumber = true;
  let calcMode = 'simple';

  function setCalcMode(mode) {
    calcMode = mode;
    document.getElementById('mode-simple').classList.toggle('active', mode==='simple');
    document.getElementById('mode-sci').classList.toggle('active', mode==='sci');
    document.getElementById('sci-pad').classList.toggle('hidden', mode!=='sci');
  }

  function updateCalcDisplay() {
    document.getElementById('calc-expression').textContent = calcExpression;
    document.getElementById('calc-result').textContent = toPersianNum(calcCurrentValue);
  }

  function calcNum(num) {
    if (calcNewNumber) { calcCurrentValue = num; calcNewNumber = false; }
    else { calcCurrentValue = calcCurrentValue === '0' ? num : calcCurrentValue + num; }
    updateCalcDisplay();
  }

  function calcDot() {
    if (calcNewNumber) { calcCurrentValue = '0.'; calcNewNumber = false; }
    else if (!calcCurrentValue.includes('.')) { calcCurrentValue += '.'; }
    updateCalcDisplay();
  }

  function calcOp(op) {
    calcExpression = calcCurrentValue + ' ' + getOpSymbol(op) + ' ';
    calcLastOperator = op;
    calcNewNumber = true;
    updateCalcDisplay();
  }

  function getOpSymbol(op) {
    const symbols = { '+':'+', '-':'โ', '*':'ร', '/':'รท' };
    return symbols[op] || op;
  }

  function calcEquals() {
    if (calcLastOperator && calcExpression) {
      const parts = calcExpression.trim().split(' ');
      const a = parseFloat(parts[0]);
      const b = parseFloat(calcCurrentValue);
      let result;

      switch (calcLastOperator) {
        case '+': result = a + b; break;
        case '-': result = a - b; break;
        case '*': result = a * b; break;
        case '/': result = b !== 0 ? a / b : 'Error'; break;
        case '^': result = Math.pow(a, b); break;
      }

      calcExpression = '';
      calcCurrentValue = String(result);
      calcLastOperator = null;
      calcNewNumber = true;
      updateCalcDisplay();
    }
  }

  function calcPow() {
    calcExpression = calcCurrentValue + ' ^ ';
    calcLastOperator = '^';
    calcNewNumber = true;
    updateCalcDisplay();
  }

  function calcClear() {
    calcExpression = '';
    calcCurrentValue = '0';
    calcLastOperator = null;
    calcNewNumber = true;
    updateCalcDisplay();
  }

  function calcBackspace() {
    if (calcCurrentValue.length > 1) calcCurrentValue = calcCurrentValue.slice(0, -1);
    else { calcCurrentValue = '0'; calcNewNumber = true; }
    updateCalcDisplay();
  }

  function calcPercent() {
    calcCurrentValue = String(parseFloat(calcCurrentValue) / 100);
    updateCalcDisplay();
  }

  function calcConst(name) {
    if (name === 'pi') {
      calcCurrentValue = String(Math.PI);
      calcNewNumber = true;
      updateCalcDisplay();
    }
  }

  function calcFunc(fn) {
    const x = parseFloat(calcCurrentValue);
    if (isNaN(x)) return;

    let out = x;
    // Trig in degrees for user friendliness
    const degToRad = (d) => d * Math.PI / 180;

    switch(fn){
      case 'sin': out = Math.sin(degToRad(x)); break;
      case 'cos': out = Math.cos(degToRad(x)); break;
      case 'tan': out = Math.tan(degToRad(x)); break;
      case 'sqrt': out = x >= 0 ? Math.sqrt(x) : 'Error'; break;
      case 'ln': out = x > 0 ? Math.log(x) : 'Error'; break;
      case 'log': out = x > 0 ? Math.log10(x) : 'Error'; break;
    }

    calcCurrentValue = String(out);
    calcNewNumber = true;
    updateCalcDisplay();
  }

  
  // ===================== HEALTH: Extra tools =====================
  function calculateWater() {
    const w = parseFloat(document.getElementById('water-weight').value);
    const activity = document.getElementById('water-activity').value;
    const out = document.getElementById('water-result');

    if (!Number.isFinite(w) || w <= 0) {
      out.innerHTML = 'ูุทูุงู ูุฒู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ.';
      out.classList.remove('hidden');
      return;
    }

    // baseline: 30-35 ml/kg
    let mlPerKg = 32;
    if (activity === 'mid') mlPerKg = 35;
    if (activity === 'high') mlPerKg = 40;

    const liters = (w * mlPerKg) / 1000;

    const msg = `
      <div class="mb-1"><span class="font-bold">ููุฏุงุฑ ูพุดููุงุฏ:</span> ุญุฏูุฏ <span class="font-bold">${toPersianNum(liters.toFixed(1))}</span> ูุชุฑ ุฏุฑ ุฑูุฒ</div>
      <div class="text-xs text-gray-300">ูฺฉุชู: ุฏุฑ ููุง ฺฏุฑู/ูุฑุฒุดุ ููุฏุงุฑ ุจุดุชุฑ ูุงุฒู ุงุณุช. ุฑูฺฏ ุงุฏุฑุงุฑ ุฎู ุชุฑู ูุนูููุงู ูุดุงูู ฺฉูโุขุจ ุงุณุช.</div>
    `;
    out.innerHTML = msg;
    out.classList.remove('hidden');
  }

  function calculateWHtR() {
    const h = parseFloat(document.getElementById('whr-height').value);
    const w = parseFloat(document.getElementById('whr-waist').value);
    const out = document.getElementById('whr-result');

    if (!Number.isFinite(h) || !Number.isFinite(w) || h<=0 || w<=0) {
      out.innerHTML = 'ูุทูุงู ูุฏ ู ุฏูุฑ ฺฉูุฑ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ.';
      out.classList.remove('hidden');
      return;
    }

    const ratio = w / h; // both cm
    let label = 'ฺฉูโุฎุทุฑ';
    let tip = 'ูุถุนุช ฺฉู ุฎูุจ ุงุณุชุ ูุนุงูุช ุจุฏู ู ุชุบุฐู ูุชุนุงุฏู ุฑุง ุงุฏุงูู ุฏูุฏ.';

    if (ratio >= 0.5 && ratio < 0.6) { label = 'ูุฑุฒ'; tip = 'ุจูุชุฑ ุงุณุช ูุฒู/ุฏูุฑ ฺฉูุฑ ุฑุง ฺฉูุชุฑู ฺฉูุฏ ู ูุนุงูุช ุจุฏู ุฑุง ุงูุฒุงุด ุฏูุฏ.'; }
    if (ratio >= 0.6) { label = 'ูพุฑุฎุทุฑ'; tip = 'ุฑุณฺฉ ูุชุงุจููฺฉ ุจุงูุงุชุฑ ุงุณุชุ ูพฺฏุฑ ูพุฒุดฺฉ ู ุงุตูุงุญ ุณุจฺฉ ุฒูุฏฺฏ ุชูุตู ูโุดูุฏ.'; }

    out.innerHTML = `
      <div class="mb-1"><span class="font-bold">WHtR:</span> ${toPersianNum(ratio.toFixed(2))} (${label})</div>
      <div class="text-xs text-gray-300">${tip}</div>
    `;
    out.classList.remove('hidden');
  }

  function calculateBodyFat() {
    const gender = document.getElementById('bf-gender').value;
    const height = parseFloat(document.getElementById('bf-height').value);
    const neck = parseFloat(document.getElementById('bf-neck').value);
    const waist = parseFloat(document.getElementById('bf-waist').value);
    const hip = parseFloat(document.getElementById('bf-hip')?.value);
    const out = document.getElementById('bf-result');

    if (!Number.isFinite(height) || !Number.isFinite(neck) || !Number.isFinite(waist) || height<=0 || neck<=0 || waist<=0) {
      out.innerHTML = 'ูุทูุงู ูุฏุ ุฏูุฑ ฺฏุฑุฏู ู ุฏูุฑ ฺฉูุฑ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ.';
      out.classList.remove('hidden');
      return;
    }

    // US Navy (cm): convert to inches? we'll use log10 with cm formula variants:
    // Male: %BF = 495/(1.0324 - 0.19077*log10(waist-neck) + 0.15456*log10(height)) - 450
    // Female: %BF = 495/(1.29579 - 0.35004*log10(waist+hip-neck) + 0.22100*log10(height)) - 450
    const log10 = (x) => Math.log(x) / Math.LN10;

    let bf;
    if (gender === 'male') {
      const x = waist - neck;
      if (x <= 0) {
        out.innerHTML = 'ููุงุฏุฑ ูุงุฑุฏ ุดุฏู ููุทู ูุณุช (ุฏูุฑ ฺฉูุฑ ุจุงุฏ ุจุฒุฑฺฏโุชุฑ ุงุฒ ุฏูุฑ ฺฏุฑุฏู ุจุงุดุฏ).';
        out.classList.remove('hidden');
        return;
      }
      bf = 495 / (1.0324 - 0.19077 * log10(x) + 0.15456 * log10(height)) - 450;
    } else {
      if (!Number.isFinite(hip) || hip<=0) {
        out.innerHTML = 'ุจุฑุง ุฎุงููโูุงุ ูุทูุงู ุฏูุฑ ุจุงุณู ุฑุง ูู ูุงุฑุฏ ฺฉูุฏ.';
        out.classList.remove('hidden');
        return;
      }
      const x = waist + hip - neck;
      if (x <= 0) {
        out.innerHTML = 'ููุงุฏุฑ ูุงุฑุฏ ุดุฏู ููุทู ูุณุช (waist+hip ุจุงุฏ ุจุฒุฑฺฏโุชุฑ ุงุฒ neck ุจุงุดุฏ).';
        out.classList.remove('hidden');
        return;
      }
      bf = 495 / (1.29579 - 0.35004 * log10(x) + 0.22100 * log10(height)) - 450;
    }

    if (!Number.isFinite(bf)) {
      out.innerHTML = 'ุฎุทุง ุฏุฑ ูุญุงุณุจู. ูุฑูุฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ.';
      out.classList.remove('hidden');
      return;
    }

    const bfRounded = Math.max(0, Math.min(70, bf));
    out.innerHTML = `<div><span class="font-bold">ุฏุฑุตุฏ ฺุฑุจ ุจุฏู:</span> ${toPersianNum(bfRounded.toFixed(1))}%</div>
      <div class="text-xs text-gray-300 mt-1">ุงู ุนุฏุฏ ุชูุฑุจ ุงุณุช ู ุจุง ุฑูุดโูุง ุฏูู (DEXA/ฺฉุงููพุฑ) ููฺฉู ุงุณุช ูุชูุงูุช ุจุงุดุฏ.</div>`;
    out.classList.remove('hidden');
  }

  function calculateHRZones() {
    const age = parseFloat(document.getElementById('hr-age').value);
    const rest = parseFloat(document.getElementById('hr-rest').value);
    const out = document.getElementById('hr-result');

    if (!Number.isFinite(age) || age<=0) {
      out.innerHTML = 'ูุทูุงู ุณู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ.';
      out.classList.remove('hidden');
      return;
    }

    // Max HR approximations: 220 - age
    const max = 220 - age;

    // If rest given, also show Karvonen (heart rate reserve)
    const hasRest = Number.isFinite(rest) && rest > 0 && rest < max;

    const zones = [
      { n:'ุฒูู ฑ (ุฑฺฉุงูุฑ)', a:0.50, b:0.60 },
      { n:'ุฒูู ฒ (ฺุฑุจโุณูุฒ)', a:0.60, b:0.70 },
      { n:'ุฒูู ณ (ููุงุฒ)', a:0.70, b:0.80 },
      { n:'ุฒูู ด (ุขุณุชุงูู)', a:0.80, b:0.90 },
      { n:'ุฒูู ต (ุดุฏุช ุจุงูุง)', a:0.90, b:1.00 }
    ];

    const fmt = (x) => toPersianNum(Math.round(x));

    const simple = zones.map(z => {
      const lo = max * z.a;
      const hi = max * z.b;
      return `<div class="flex justify-between"><span>${z.n}</span><span dir="ltr">${fmt(lo)}-${fmt(hi)} bpm</span></div>`;
    }).join('');

    let karvonen = '';
    if (hasRest) {
      const hrr = max - rest;
      karvonen = `
        <div class="mt-3 text-xs text-gray-300">ูุญุงุณุจู ุฏููโุชุฑ ุจุง HR Rest (ฺฉุงุฑูููู):</div>
        ${zones.map(z=>{
          const lo = rest + hrr*z.a;
          const hi = rest + hrr*z.b;
          return `<div class="flex justify-between"><span>${z.n}</span><span dir="ltr">${fmt(lo)}-${fmt(hi)} bpm</span></div>`;
        }).join('')}
      `;
    }

    out.innerHTML = `
      <div class="mb-2"><span class="font-bold">ุญุฏุงฺฉุซุฑ ุถุฑุจุงู ุชูุฑุจ:</span> ${fmt(max)} bpm</div>
      <div class="space-y-1 text-sm">${simple}</div>
      ${karvonen}
    `;
    out.classList.remove('hidden');
  }

  // show/hide hip for female
  (function initBodyFatUI(){
    const g = document.getElementById('bf-gender');
    const wrap = document.getElementById('bf-hip-wrap');
    if (!g || !wrap) return;
    const refresh = () => wrap.classList.toggle('hidden', g.value !== 'female');
    g.addEventListener('change', refresh);
    refresh();
  })();

// ===================== HEALTH: Lab interpretation =====================
  
  // ===================== HEALTH: Lab interpretation (advanced) =====================
  function interpretLabs() {
    const fbs = parseFloat(document.getElementById('lab-fbs').value);
    const a1c = parseFloat(document.getElementById('lab-a1c').value);
    const tc  = parseFloat(document.getElementById('lab-tc').value);
    const tg  = parseFloat(document.getElementById('lab-tg').value);
    const hdl = parseFloat(document.getElementById('lab-hdl').value);
    const ldl = parseFloat(document.getElementById('lab-ldl').value);
    const cr  = parseFloat(document.getElementById('lab-cr').value);
    const alt = parseFloat(document.getElementById('lab-alt').value);
    const ast = parseFloat(document.getElementById('lab-ast').value);
    const tsh = parseFloat(document.getElementById('lab-tsh').value);
    const vitd= parseFloat(document.getElementById('lab-vitd').value);
    const sys = parseFloat(document.getElementById('lab-sys').value);
    const dia = parseFloat(document.getElementById('lab-dia').value);

    const out = document.getElementById('lab-result');
    const sections = [];

    const badge = (txt, tone) => {
      const cls = tone === 'good' ? 'bg-green-500/15 text-green-200 border-green-500/20'
                : tone === 'warn' ? 'bg-amber-500/15 text-amber-200 border-amber-500/20'
                : tone === 'bad'  ? 'bg-red-500/15 text-red-200 border-red-500/20'
                : 'bg-white/10 text-gray-200 border-white/10';
      return `<span class="inline-flex items-center px-2 py-0.5 rounded-lg border ${cls} text-xs mr-1">${txt}</span>`;
    };

    const row = (title, msg, tone) =>
      `<div class="mb-2"><div class="flex items-center justify-between gap-2">
        <div class="font-bold">${title}</div>
        <div>${badge(tone==='good'?'ุฎูุจ':tone==='warn'?'ูุฑุฒ':tone==='bad'?'ุจุงูุง/ุบุฑุทุจุน':'-', tone)}</div>
      </div><div class="text-gray-200">${msg}</div></div>`;

    // ---- Glucose / Diabetes ----
    if (Number.isFinite(fbs) || Number.isFinite(a1c)) {
      let msgs = '';

      if (Number.isFinite(fbs)) {
        if (fbs < 70) msgs += `โข ููุฏ ูุงุดุชุง ${toPersianNum(fbs)}: ูพุงูโุชุฑ ุงุฒ ุญุฏ ูุนููู. <span class="text-gray-300">(ุงฺฏุฑ ุนูุงุฆู ุฏุงุฑุฏ ูพฺฏุฑ ฺฉูุฏ)</span><br>`;
        else if (fbs <= 99) msgs += `โข ููุฏ ูุงุดุชุง ${toPersianNum(fbs)}: ุทุจุน.<br>`;
        else if (fbs <= 125) msgs += `โข ููุฏ ูุงุดุชุง ${toPersianNum(fbs)}: ูพุดโุฏุงุจุช.<br>`;
        else msgs += `โข ููุฏ ูุงุดุชุง ${toPersianNum(fbs)}: ุฏุฑ ูุญุฏูุฏู ุฏุงุจุช (ูุงุฒููุฏ ุจุฑุฑุณ ูพุฒุดฺฉ).<br>`;
      }

      if (Number.isFinite(a1c)) {
        if (a1c < 5.7) msgs += `โข HbA1c ${toPersianNum(a1c.toFixed(1))}%: ุทุจุน.<br>`;
        else if (a1c < 6.5) msgs += `โข HbA1c ${toPersianNum(a1c.toFixed(1))}%: ูพุดโุฏุงุจุช.<br>`;
        else msgs += `โข HbA1c ${toPersianNum(a1c.toFixed(1))}%: ุฏุฑ ูุญุฏูุฏู ุฏุงุจุช (ูุงุฒููุฏ ูพฺฏุฑ).<br>`;
      }

      let tone = 'info';
      if ((Number.isFinite(fbs) && fbs >= 126) || (Number.isFinite(a1c) && a1c >= 6.5)) tone = 'bad';
      else if ((Number.isFinite(fbs) && fbs >= 100) || (Number.isFinite(a1c) && a1c >= 5.7)) tone = 'warn';
      else tone = 'good';

      sections.push(row('ููุฏ ู ฺฉูุชุฑู ุฏุงุจุช', msgs || 'โ', tone));
    }

    // ---- Lipids ----
    if (Number.isFinite(tc) || Number.isFinite(tg) || Number.isFinite(hdl) || Number.isFinite(ldl)) {
      let msgs = '';

      if (Number.isFinite(tc)) {
        if (tc < 200) msgs += `โข ฺฉูุณุชุฑูู ฺฉู ${toPersianNum(tc)}: ูุทููุจ.<br>`;
        else if (tc <= 239) msgs += `โข ฺฉูุณุชุฑูู ฺฉู ${toPersianNum(tc)}: ูุฑุฒ.<br>`;
        else msgs += `โข ฺฉูุณุชุฑูู ฺฉู ${toPersianNum(tc)}: ุจุงูุง.<br>`;
      }

      if (Number.isFinite(ldl)) {
        let cat = 'ุจููู';
        if (ldl < 100) cat = 'ุจููู';
        else if (ldl <= 129) cat = 'ูุฒุฏฺฉ ุจู ุจููู';
        else if (ldl <= 159) cat = 'ูุฑุฒ ุจุงูุง';
        else if (ldl <= 189) cat = 'ุจุงูุง';
        else cat = 'ุฎู ุจุงูุง';
        msgs += `โข LDL ${toPersianNum(ldl)}: ${cat}.<br>`;
      }

      if (Number.isFinite(hdl)) {
        if (hdl < 40) msgs += `โข HDL ${toPersianNum(hdl)}: ูพุงู (ุฑุณฺฉ ููุจ ุจุดุชุฑ).<br>`;
        else if (hdl < 60) msgs += `โข HDL ${toPersianNum(hdl)}: ูุงุจู ูุจูู.<br>`;
        else msgs += `โข HDL ${toPersianNum(hdl)}: ุนุงู/ูุญุงูุธุช.<br>`;
      }

      if (Number.isFinite(tg)) {
        if (tg < 150) msgs += `โข TG ${toPersianNum(tg)}: ุทุจุน.<br>`;
        else if (tg <= 199) msgs += `โข TG ${toPersianNum(tg)}: ูุฑุฒ.<br>`;
        else if (tg <= 499) msgs += `โข TG ${toPersianNum(tg)}: ุจุงูุง.<br>`;
        else msgs += `โข TG ${toPersianNum(tg)}: ุฎู ุจุงูุง (ูุงุฒููุฏ ูพฺฏุฑ ููุฑ).<br>`;
      }

      // Derived metrics
      if (Number.isFinite(tc) && Number.isFinite(hdl) && hdl > 0) {
        const nonHdl = tc - hdl;
        msgs += `โข NonโHDL: ${toPersianNum(nonHdl.toFixed(0))} mg/dL.<br>`;
      }
      if (Number.isFinite(tg) && Number.isFinite(hdl) && hdl > 0) {
        const ratio = tg / hdl;
        const rTone = ratio < 2 ? 'ุฎูุจ' : ratio < 3.5 ? 'ูุฑุฒ' : 'ุจุงูุง';
        msgs += `โข ูุณุจุช TG/HDL: ${toPersianNum(ratio.toFixed(2))} (${rTone}).<br>`;
      }

      let tone = 'info';
      if ((Number.isFinite(ldl) && ldl >= 160) || (Number.isFinite(tg) && tg >= 200) || (Number.isFinite(tc) && tc >= 240)) tone = 'bad';
      else if ((Number.isFinite(ldl) && ldl >= 130) || (Number.isFinite(tg) && tg >= 150) || (Number.isFinite(tc) && tc >= 200) || (Number.isFinite(hdl) && hdl < 40)) tone = 'warn';
      else tone = 'good';

      sections.push(row('ฺุฑุจ ุฎูู', msgs || 'โ', tone));
    }

    // ---- Blood Pressure ----
    if (Number.isFinite(sys) && Number.isFinite(dia)) {
      const bp = `${toPersianNum(sys)}/${toPersianNum(dia)}`;
      let tone = 'good';
      let msg = `${bp} ุทุจุน ุงุณุช.`;
      if (sys < 120 && dia < 80) { tone='good'; msg = `${bp} ุทุจุน ุงุณุช.`; }
      else if (sys < 130 && dia < 80) { tone='warn'; msg = `${bp} ุจุงูุงุชุฑ ุงุฒ ุญุงูุช ุงุฏูโุขู (Elevated).`; }
      else if (sys < 140 || dia < 90) { tone='warn'; msg = `${bp} ูุฑุญูู ฑ. ูพฺฏุฑ ู ุงุตูุงุญ ุณุจฺฉ ุฒูุฏฺฏ ุชูุตู ูโุดูุฏ.`; }
      else { tone='bad'; msg = `${bp} ูุฑุญูู ฒ. ุจูุชุฑ ุงุณุช ุจุง ูพุฒุดฺฉ ูุดูุฑุช ฺฉูุฏ.`; }
      sections.push(row('ูุดุงุฑ ุฎูู', msg, tone));
    }

    // ---- Kidney (Creatinine) ----
    if (Number.isFinite(cr)) {
      // ูุญุฏูุฏูโูุง ุจู ุฌูุณ/ุนุถูู ูุงุจุณุชู ุงุณุชุ ุงูุฌุง ููุท ูุดุฏุงุฑ ุนููู
      let tone='good', msg=`ฺฉุฑุงุชูู ${toPersianNum(cr.toFixed(2))} mg/dL.`;
      if (cr < 0.6) { tone='warn'; msg += ' ูพุงูโุชุฑ ุงุฒ ุญุฏ ูุนููู (ููฺฉู ุงุณุช ุจุง ุชูุฏู ุนุถูุงู ฺฉู ูุฑุชุจุท ุจุงุดุฏ).'; }
      else if (cr > 1.3) { tone='warn'; msg += ' ุจุงูุงุชุฑ ุงุฒ ุญุฏ ูุนููู (ููฺฉู ุงุณุช ูุงุฒ ุจู ุจุฑุฑุณ ุนููฺฉุฑุฏ ฺฉูู ุฏุงุดุชู ุจุงุดุฏ).'; }
      sections.push(row('ฺฉูู (ฺฉุฑุงุชูู)', msg, tone));
    }

    // ---- Liver enzymes ----
    if (Number.isFinite(alt) || Number.isFinite(ast)) {
      let msg = '';
      const hiALT = Number.isFinite(alt) && alt > 40;
      const hiAST = Number.isFinite(ast) && ast > 40;
      if (Number.isFinite(alt)) msg += `โข ALT ${toPersianNum(alt)} IU/L ${hiALT ? '(ุจุงูุง)' : '(ุทุจุน)'}<br>`;
      if (Number.isFinite(ast)) msg += `โข AST ${toPersianNum(ast)} IU/L ${hiAST ? '(ุจุงูุง)' : '(ุทุจุน)'}<br>`;
      const tone = (hiALT || hiAST) ? 'warn' : 'good';
      sections.push(row('ฺฉุจุฏ (ALT/AST)', msg || 'โ', tone));
    }

    // ---- Thyroid ----
    if (Number.isFinite(tsh)) {
      let tone='good', msg=`TSH ${toPersianNum(tsh.toFixed(2))} ยตIU/mL.`;
      if (tsh < 0.4) { tone='warn'; msg += ' ูพุงูโุชุฑ ุงุฒ ุญุฏ ูุนููู (ุงุญุชูุงู ูพุฑฺฉุงุฑ).'; }
      else if (tsh > 4.5) { tone='warn'; msg += ' ุจุงูุงุชุฑ ุงุฒ ุญุฏ ูุนููู (ุงุญุชูุงู ฺฉูโฺฉุงุฑ).'; }
      sections.push(row('ุชุฑูุฆุฏ (TSH)', msg, tone));
    }

    // ---- Vitamin D ----
    if (Number.isFinite(vitd)) {
      let tone='good', msg=`ูุชุงูู D ${toPersianNum(vitd)} ng/mL.`;
      if (vitd < 20) { tone='bad'; msg += ' ฺฉูุจูุฏ.'; }
      else if (vitd < 30) { tone='warn'; msg += ' ูุงฺฉุงู.'; }
      else msg += ' ููุงุณุจ.';
      sections.push(row('ูุชุงูู D', msg, tone));
    }

    if (sections.length === 0) {
      out.innerHTML = '<div class="text-gray-300">ูุทูุงู ุญุฏุงูู ฺฉ ููุฏุงุฑ ูุงุฑุฏ ฺฉูุฏ.</div>';
      out.classList.remove('hidden');
      return;
    }

    // ---- General recommendations (context-free) ----
    const advice = `
      <div class="mt-3 pt-3 border-t border-white/10 text-xs text-gray-300 leading-relaxed">
        <div class="font-bold mb-1">ูพุดููุงุฏูุง ุนููู (ุบุฑุชุฌูุฒ):</div>
        <div>โข ฑตฐ ุฏููู ูุนุงูุช ููุงุฒ ุฏุฑ ููุชู + ฒ ุฌูุณู ุชูุฑู ูุฏุฑุช</div>
        <div>โข ฺฉุงูุด ููุฏูุง ุณุงุฏูุ ููุดุฏู ุดุฑูุ ฺุฑุจ ุชุฑุงูุณุ ุงูุฒุงุด ูุจุฑ (ุณุจุฒ/ุญุจูุจุงุช)</div>
        <div>โข ุฎูุงุจ ท-ธ ุณุงุนุช ู ูุฏุฑุช ุงุณุชุฑุณ</div>
        <div>โข ุงฺฏุฑ ุนุฏุฏูุง ุฎู ุจุงูุง/ุบุฑุทุจุน ูุณุชูุฏ ุง ุนูุงุฆู ุฏุงุฑุฏุ ุงุฑุฒุงุจ ูพุฒุดฺฉ ูุงุฒู ุงุณุช</div>
      </div>
    `;

    out.innerHTML = sections.join('') + advice;
    out.classList.remove('hidden');
  }


  // ===================== ELEMENT SDK (unchanged) =====================
  const defaultConfig = { site_title: 'Codeisa' };
  let config = { ...defaultConfig };

  async function onConfigChange(newConfig) {
    config = { ...config, ...newConfig };
    const titleEl = document.getElementById('site-title');
    if (titleEl) titleEl.textContent = config.site_title || defaultConfig.site_title;
    document.title = config.site_title || defaultConfig.site_title;
  }

  function mapToCapabilities(config) {
    return { recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined };
  }

  function mapToEditPanelValues(config) {
    return new Map([['site_title', config.site_title || defaultConfig.site_title]]);
  }

  if (window.elementSdk) {
    window.elementSdk.init({ defaultConfig, onConfigChange, mapToCapabilities, mapToEditPanelValues });
  }

  // Start the app
  loadCrypto();
  updateDateTime();
  setInterval(updateDateTime, 1000);
  setInterval(loadCrypto, 60000);
</script>
</body>
</html>
